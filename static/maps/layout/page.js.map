{"version":3,"sources":["layout/page.js"],"names":["View","Backbone","extend","el","className","_panelids","initialize","options","self","config","_","defaults","message_box_visible","message_box_content","message_box_class","show_inactivity_warning","inactivity_box_content","Galaxy","modal","display","view","title","setWindowTitle","allow_title_display","center","router","Router","masthead","CenterPanel","$el","attr","html","_template","$","replaceWith","append","frame","$messagebox","$inactivebox","panels","each","panel_class_name","panel_id","charAt","toUpperCase","slice","panel_class","panel_instance","toString","SidePanel","id","render","history","start","root","pushState","remove","renderMessageBox","renderInactivityBox","renderPanels","_checkCommunicationServerOnline","content","level","addClass","toggle","show","removeClass","hide","verificationLink","text","panel","css","join","host","window","communication_server_host","port","communication_server_port","preferences","user","attributes","$chat_icon_element","indexOf","communication_server","ajax","url","success","error"],"mappings":"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","file":"../../scripts/layout/page.js","sourcesContent":["import Masthead from \"layout/masthead\";\nimport Panel from \"layout/panel\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Utils from \"utils/utils\";\n\nvar View = Backbone.View.extend({\n    el: \"body\",\n    className: \"full-content\",\n    _panelids: [\"left\", \"right\"],\n\n    initialize: function(options) {\n        var self = this;\n        this.config = _.defaults(options.config || {}, {\n            message_box_visible: false,\n            message_box_content: \"\",\n            message_box_class: \"info\",\n            show_inactivity_warning: false,\n            inactivity_box_content: \"\"\n        });\n\n        // attach global objects, build mastheads\n        Galaxy.modal = this.modal = new Modal.View();\n        Galaxy.display = this.display = view => {\n            if (view.title) {\n                Utils.setWindowTitle(view.title);\n                view.allow_title_display = false;\n            } else {\n                Utils.setWindowTitle();\n                view.allow_title_display = true;\n            }\n            self.center.display(view);\n        };\n        Galaxy.router = this.router = options.Router && new options.Router(self, options);\n        this.masthead = new Masthead.View(this.config);\n        this.center = new Panel.CenterPanel();\n\n        // build page template\n        this.$el.attr(\"scroll\", \"no\");\n        this.$el.html(this._template());\n        this.$(\"#masthead\").replaceWith(this.masthead.$el);\n        this.$(\"#center\").append(this.center.$el);\n        this.$el.append(this.masthead.frame.$el);\n        this.$el.append(this.modal.$el);\n        this.$messagebox = this.$(\"#messagebox\");\n        this.$inactivebox = this.$(\"#inactivebox\");\n\n        // build panels\n        this.panels = {};\n        _.each(this._panelids, panel_id => {\n            var panel_class_name = panel_id.charAt(0).toUpperCase() + panel_id.slice(1);\n            var panel_class = options[panel_class_name];\n            if (panel_class) {\n                var panel_instance = new panel_class(self, options);\n                self[panel_instance.toString()] = panel_instance;\n                self.panels[panel_id] = new Panel.SidePanel({\n                    id: panel_id,\n                    el: self.$(`#${panel_id}`),\n                    view: panel_instance\n                });\n            }\n        });\n        this.render();\n\n        // start the router\n        if (this.router) {\n            Backbone.history.start({\n                root: Galaxy.root,\n                pushState: true\n            });\n        }\n    },\n\n    render: function() {\n        // TODO: Remove this line after select2 update\n        $(\".select2-hidden-accessible\").remove();\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        this._checkCommunicationServerOnline();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox: function() {\n        if (this.config.message_box_visible) {\n            var content = this.config.message_box_content || \"\";\n            var level = this.config.message_box_class || \"info\";\n            this.$el.addClass(\"has-message-box\");\n            this.$messagebox\n                .attr(\"class\", `panel-${level}-message`)\n                .html(content)\n                .toggle(!!content)\n                .show();\n        } else {\n            this.$el.removeClass(\"has-message-box\");\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox: function() {\n        if (this.config.show_inactivity_warning) {\n            var content = this.config.inactivity_box_content || \"\";\n            var verificationLink = $(\"<a/>\")\n                .attr(\"href\", `${Galaxy.root}user/resend_verification`)\n                .text(\"Resend verification\");\n            this.$el.addClass(\"has-inactivity-box\");\n            this.$inactivebox\n                .html(`${content} `)\n                .append(verificationLink)\n                .toggle(!!content)\n                .show();\n        } else {\n            this.$el.removeClass(\"has-inactivity-box\");\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels: function() {\n        var self = this;\n        _.each(this._panelids, panel_id => {\n            var panel = self.panels[panel_id];\n            if (panel) {\n                panel.render();\n            } else {\n                self.$(\"#center\").css(panel_id, 0);\n                self.$(`#${panel_id}`).hide();\n            }\n        });\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            '<div id=\"everything\">',\n            '<div id=\"background\"/>',\n            '<div id=\"masthead\"/>',\n            '<div id=\"messagebox\"/>',\n            '<div id=\"inactivebox\" class=\"panel-warning-message\" />',\n            '<div id=\"left\" />',\n            '<div id=\"center\" />',\n            '<div id=\"right\" />',\n            \"</div>\",\n            '<div id=\"dd-helper\" />'\n        ].join(\"\");\n    },\n\n    toString: function() {\n        return \"PageLayoutView\";\n    },\n\n    /** Check if the communication server is online and show the icon otherwise hide the icon */\n    _checkCommunicationServerOnline: function() {\n        var host = window.Galaxy.config.communication_server_host;\n        var port = window.Galaxy.config.communication_server_port;\n        var preferences = window.Galaxy.user.attributes.preferences;\n        var $chat_icon_element = $(\"#show-chat-online\");\n        /** Check if the user has deactivated the communication in it's personal settings */\n        if (preferences && [\"1\", \"true\"].indexOf(preferences.communication_server) != -1) {\n            // See if the configured communication server is available\n            $.ajax({\n                url: `${host}:${port}`\n            })\n                .success(data => {\n                    // enable communication only when a user is logged in\n                    if (window.Galaxy.user.id !== null) {\n                        if ($chat_icon_element.css(\"visibility\") === \"hidden\") {\n                            $chat_icon_element.css(\"visibility\", \"visible\");\n                        }\n                    }\n                })\n                .error(data => {\n                    // hide the communication icon if the communication server is not available\n                    $chat_icon_element.css(\"visibility\", \"hidden\");\n                });\n        } else {\n            $chat_icon_element.css(\"visibility\", \"hidden\");\n        }\n    }\n});\n\nexport default { View: View };\n"]}
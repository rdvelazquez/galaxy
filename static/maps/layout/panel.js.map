{"version":3,"sources":["layout/panel.js"],"names":["_","Backbone","MIN_PANEL_WIDTH","MAX_PANEL_WIDTH","SidePanel","View","extend","initialize","options","view","hidden","saved_size","hiddenByTool","$center","$el","siblings","$toggleButton","$","render","self","panel","components","model","attributes","html","_templatePanel","id","each","buttons","append","button","addClass","cls","escape","title","_templateHeader","_templateBody","_templateFooter","join","data","events","_mousedownDragHandler","ev","draggingLeft","prevX","pageX","move","e","delta","oldWidth","width","newWidth","Math","min","max","resize","show","on","one","hide","off","newSize","css","animation","whichSide","animate","removeClass","toggle","handle_minwidth_hint","hint","space","force_panel","op","toString","LeftPanel","RightPanel","CenterPanel","setElement","template","$frame","$panel","bind","_iframeChangeHandler","iframe","currentTarget","location","contentWindow","host","empty","Galaxy","trigger","fullpath","pathname","search","hash","display","message","onbeforeunload","confirm","undefined","attr","scrollTop"],"mappings":"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","file":"../../scripts/layout/panel.js","sourcesContent":["import $ from \"jquery\";\nimport * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\n\nvar MIN_PANEL_WIDTH = 160;\nvar MAX_PANEL_WIDTH = 800;\n\n/** View for left/right panels used by Page view */\nvar SidePanel = Backbone.View.extend({\n    initialize: function(options) {\n        this.view = options.view;\n        this.hidden = false;\n        this.saved_size = null;\n        this.hiddenByTool = false;\n    },\n\n    $center: function() {\n        return this.$el.siblings(\"#center\");\n    },\n\n    $toggleButton: function() {\n        return this.$(\".unified-panel-footer > .panel-collapse\");\n    },\n\n    render: function() {\n        var self = this;\n        var panel = this.view;\n        var components = this.view.model.attributes || {};\n        this.$el.html(this._templatePanel(this.id));\n        _.each(components.buttons, button => {\n            self.$(\".panel-header-buttons\").append(button.$el);\n        });\n        this.$el.addClass(components.cls);\n        this.$(\".panel-header-text\").html(_.escape(components.title));\n        this.$(\".unified-panel-body\").append(panel.$el);\n        panel.render();\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templatePanel: function() {\n        return [this._templateHeader(), this._templateBody(), this._templateFooter()].join(\"\");\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateHeader: function(data) {\n        return [\n            '<div class=\"unified-panel-header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\">',\n            '<div class=\"panel-header-buttons\" style=\"float: right\"/>',\n            '<div class=\"panel-header-text\"/>',\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateBody: function(data) {\n        return '<div class=\"unified-panel-body\"/>';\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateFooter: function(data) {\n        return [\n            '<div class=\"unified-panel-footer\">',\n            '<div class=\"panel-collapse ',\n            _.escape(this.id),\n            '\"/>',\n            '<div class=\"drag\"/>',\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    events: {\n        \"mousedown .unified-panel-footer > .drag\": \"_mousedownDragHandler\",\n        \"click .unified-panel-footer > .panel-collapse\": \"toggle\"\n    },\n\n    _mousedownDragHandler: function(ev) {\n        var self = this;\n        var draggingLeft = this.id === \"left\";\n        var prevX = ev.pageX;\n\n        function move(e) {\n            var delta = e.pageX - prevX;\n            prevX = e.pageX;\n            var oldWidth = self.$el.width();\n            var newWidth = draggingLeft ? oldWidth + delta : oldWidth - delta;\n            // Limit range\n            newWidth = Math.min(MAX_PANEL_WIDTH, Math.max(MIN_PANEL_WIDTH, newWidth));\n            self.resize(newWidth);\n        }\n\n        // this is a page wide overlay that assists in capturing the move and release of the mouse\n        // if not provided, progress and end wouldn't fire if the mouse moved out of the drag button area\n        $(\"#dd-helper\")\n            .show()\n            .on(\"mousemove\", move)\n            .one(\"mouseup\", function(e) {\n                $(this)\n                    .hide()\n                    .off(\"mousemove\", move);\n            });\n    },\n\n    // TODO: the following three could be simplified I think\n    // if panel is 'right' (this.id), move center right newSize number of pixels\n    resize: function(newSize) {\n        this.$el.css(\"width\", newSize);\n        this.$center().css(this.id, newSize);\n        return this;\n    },\n\n    show: function() {\n        if (!this.hidden) {\n            return;\n        }\n        var self = this;\n        var animation = {};\n        var whichSide = this.id;\n        animation[whichSide] = 0;\n        self.$el\n            .css(whichSide, -this.saved_size)\n            .show()\n            .animate(animation, \"fast\", () => {\n                self.resize(self.saved_size);\n            });\n        self.hidden = false;\n        self.$toggleButton().removeClass(\"hidden\");\n        return this;\n    },\n\n    hide: function() {\n        if (this.hidden) {\n            return;\n        }\n        var animation = {};\n        var whichSide = this.id;\n        this.saved_size = this.$el.width();\n        animation[whichSide] = -this.saved_size;\n        this.$el.animate(animation, \"fast\");\n        this.$center().css(whichSide, 0);\n        this.hidden = true;\n        this.$toggleButton().addClass(\"hidden\");\n        return this;\n    },\n\n    toggle: function(ev) {\n        this.hidden ? this.show() : this.hide();\n        this.hiddenByTool = false;\n        return this;\n    },\n\n    // ..............................................................\n    //TODO: only used in message.mako?\n    /**   */\n    handle_minwidth_hint: function(hint) {\n        var space = this.$center().width() - (this.hidden ? this.saved_size : 0);\n        if (space < hint) {\n            if (!this.hidden) {\n                this.toggle();\n                this.hiddenByTool = true;\n            }\n        } else {\n            if (this.hiddenByTool) {\n                this.toggle();\n                this.hiddenByTool = false;\n            }\n        }\n        return self;\n    },\n\n    /**   */\n    force_panel: function(op) {\n        if (op == \"show\") {\n            return this.show();\n        }\n        if (op == \"hide\") {\n            return this.hide();\n        }\n        return self;\n    },\n\n    toString: function() {\n        return `SidePanel(${this.id})`;\n    }\n});\n\n// ----------------------------------------------------------------------------\n// TODO: side should be defined by page - not here\nvar LeftPanel = SidePanel.extend({\n    id: \"left\"\n});\n\nvar RightPanel = SidePanel.extend({\n    id: \"right\"\n});\n\n/** Center panel with the ability to switch between iframe and view */\nvar CenterPanel = Backbone.View.extend({\n    initialize: function(options) {\n        this.setElement($(this.template()));\n        this.$frame = this.$(\".center-frame\");\n        this.$panel = this.$(\".center-panel\");\n        this.$frame.on(\"load\", _.bind(this._iframeChangeHandler, this));\n    },\n\n    /** Display iframe if its target url changes, hide center panel */\n    _iframeChangeHandler: function(ev) {\n        var iframe = ev.currentTarget;\n        var location = iframe.contentWindow && iframe.contentWindow.location;\n        if (location && location.host) {\n            $(iframe).show();\n            this.$panel.empty().hide();\n            Galaxy.trigger(\"center-frame:load\", {\n                fullpath: location.pathname + location.search + location.hash,\n                pathname: location.pathname,\n                search: location.search,\n                hash: location.hash\n            });\n        }\n    },\n\n    /** Display a view in the center panel, hide iframe */\n    display: function(view) {\n        var contentWindow = this.$frame[0].contentWindow || {};\n        var message = contentWindow.onbeforeunload && contentWindow.onbeforeunload();\n        if (!message || confirm(message)) {\n            contentWindow.onbeforeunload = undefined;\n            this.$frame.attr(\"src\", \"about:blank\").hide();\n            this.$panel\n                .empty()\n                .scrollTop(0)\n                .append(view.$el || view)\n                .show();\n            Galaxy.trigger(\"center-panel:load\", view);\n        }\n    },\n\n    template: function() {\n        return (\n            '<div class=\"center-container\">' +\n            '<iframe id=\"galaxy_main\" name=\"galaxy_main\" frameborder=\"0\" class=\"center-frame\" />' +\n            '<div class=\"center-panel\" />' +\n            \"</div>\"\n        );\n    },\n\n    toString: function() {\n        return \"CenterPanel\";\n    }\n});\n\nexport default {\n    SidePanel: SidePanel,\n    LeftPanel: LeftPanel,\n    RightPanel: RightPanel,\n    CenterPanel: CenterPanel\n};\n"]}
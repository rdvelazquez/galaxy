{"version":3,"sources":["mvc/form/form-input.js"],"names":["Backbone","View","extend","initialize","app","options","app_options","model","attributes","field","Model","text_enable","text_disable","cls_enable","cls_disable","always_refresh","set","setElement","_template","$field","$","$info","$preview","$collapsible","$collapsible_text","$collapsible_icon","$title","$title_text","$error_text","$error","$backdrop","prepend","$el","collapsible_value","get","collapsed","undefined","JSON","stringify","listenTo","render","self","on","trigger","reset","backdrop","error","text","hide","help_text","help_argument","indexOf","html","_","escape","error_text","show","color","style","collapsible_state","removeClass","addClass","attr","tooltip","placement","append"],"mappings":"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","file":"../../../scripts/mvc/form/form-input.js","sourcesContent":["/**\n    This class creates a form input element wrapper\n*/\n\nexport default Backbone.View.extend({\n    initialize: function(app, options) {\n        this.app = app;\n        this.app_options = app.model ? app.model.attributes : {};\n        this.field = (options && options.field) || new Backbone.View();\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                text_enable: this.app_options.text_enable || \"Enable\",\n                text_disable: this.app_options.text_disable || \"Disable\",\n                cls_enable: this.app_options.cls_enable || \"fa fa-caret-square-o-down\",\n                cls_disable: this.app_options.cls_disable || \"fa fa-caret-square-o-up\",\n                always_refresh: this.app_options.always_refresh\n            }).set(options);\n\n        // set element and link components\n        this.setElement(this._template());\n        this.$field = this.$(\".ui-form-field\");\n        this.$info = this.$(\".ui-form-info\");\n        this.$preview = this.$(\".ui-form-preview\");\n        this.$collapsible = this.$(\".ui-form-collapsible\");\n        this.$collapsible_text = this.$(\".ui-form-collapsible-text\");\n        this.$collapsible_icon = this.$(\".ui-form-collapsible-icon\");\n        this.$title = this.$(\".ui-form-title\");\n        this.$title_text = this.$(\".ui-form-title-text\");\n        this.$error_text = this.$(\".ui-form-error-text\");\n        this.$error = this.$(\".ui-form-error\");\n        this.$backdrop = this.$(\".ui-form-backdrop\");\n\n        // add field element\n        this.$field.prepend(this.field.$el);\n\n        // decide wether to expand or collapse fields\n        var collapsible_value = this.model.get(\"collapsible_value\");\n        this.field.collapsed =\n            collapsible_value !== undefined &&\n            JSON.stringify(this.model.get(\"value\")) == JSON.stringify(collapsible_value);\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n\n        // add click handler\n        var self = this;\n        this.$collapsible.on(\"click\", () => {\n            self.field.collapsed = !self.field.collapsed;\n            app.trigger && app.trigger(\"change\");\n            self.render();\n        });\n\n        // hide error on value change\n        if (this.field.model && !this.model.get(\"always_refresh\")) {\n            this.listenTo(this.field.model, \"change:value\", () => {\n                self.reset();\n            });\n        }\n    },\n\n    /** Set backdrop for input element */\n    backdrop: function() {\n        this.model.set(\"backdrop\", true);\n    },\n\n    /** Set error text */\n    error: function(text) {\n        this.model.set(\"error_text\", text);\n    },\n\n    /** Reset this view */\n    reset: function() {\n        !this.model.get(\"fixed\") && this.model.set(\"error_text\", null);\n    },\n\n    render: function() {\n        // render help\n        $(\".tooltip\").hide();\n        var help_text = this.model.get(\"help\", \"\");\n        var help_argument = this.model.get(\"argument\");\n        if (help_argument && help_text.indexOf(`(${help_argument})`) == -1) {\n            help_text += ` (${help_argument})`;\n        }\n        this.$info.html(help_text);\n        // render visibility\n        this.$el[this.model.get(\"hidden\") ? \"hide\" : \"show\"]();\n        // render preview view for collapsed fields\n        this.$preview[\n            (this.field.collapsed && this.model.get(\"collapsible_preview\")) || this.model.get(\"disabled\")\n                ? \"show\"\n                : \"hide\"\n        ]().html(_.escape(this.model.get(\"text_value\")));\n        // render error messages\n        var error_text = this.model.get(\"error_text\");\n        this.$error[error_text ? \"show\" : \"hide\"]();\n        this.$el[error_text ? \"addClass\" : \"removeClass\"](\"ui-error\");\n        this.$error_text.html(error_text);\n        // render backdrop\n        this.$backdrop[this.model.get(\"backdrop\") ? \"show\" : \"hide\"]();\n        // render input field\n        this.field.collapsed || this.model.get(\"disabled\") ? this.$field.hide() : this.$field.show();\n        // render input field color and style\n        this.field.model &&\n            this.field.model.set({\n                color: this.model.get(\"color\"),\n                style: this.model.get(\"style\")\n            });\n        // render collapsible options\n        if (!this.model.get(\"disabled\") && this.model.get(\"collapsible_value\") !== undefined) {\n            var collapsible_state = this.field.collapsed ? \"enable\" : \"disable\";\n            this.$title_text.hide();\n            this.$collapsible.show();\n            this.$collapsible_text.text(this.model.get(\"label\"));\n            this.$collapsible_icon\n                .removeClass()\n                .addClass(\"icon\")\n                .addClass(this.model.get(`cls_${collapsible_state}`))\n                .attr(\"data-original-title\", this.model.get(`text_${collapsible_state}`))\n                .tooltip({ placement: \"bottom\" });\n        } else {\n            this.$title_text.show().text(this.model.get(\"label\"));\n            this.$collapsible.hide();\n        }\n    },\n\n    _template: function() {\n        return $(\"<div/>\")\n            .addClass(\"ui-form-element\")\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-error ui-error\")\n                    .append($(\"<span/>\").addClass(\"fa fa-arrow-down\"))\n                    .append($(\"<span/>\").addClass(\"ui-form-error-text\"))\n            )\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-title\")\n                    .append(\n                        $(\"<div/>\")\n                            .addClass(\"ui-form-collapsible\")\n                            .append($(\"<i/>\").addClass(\"ui-form-collapsible-icon\"))\n                            .append($(\"<span/>\").addClass(\"ui-form-collapsible-text\"))\n                    )\n                    .append($(\"<span/>\").addClass(\"ui-form-title-text\"))\n            )\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-field\")\n                    .append($(\"<span/>\").addClass(\"ui-form-info\"))\n                    .append($(\"<div/>\").addClass(\"ui-form-backdrop\"))\n            )\n            .append($(\"<div/>\").addClass(\"ui-form-preview\"));\n    }\n});\n"]}
{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["View","Backbone","extend","initialize","options","model","Model","url","get","redirect","setElement","render","self","$","ajax","Galaxy","root","type","done","attributes","response","form","title","message","status","icon","initial_errors","errors","inputs","buttons","submit","Button","tooltip","submit_tooltip","submit_title","submit_icon","cls","onclick","_submit","$el","empty","append","fail","Message","persistent","data","JSON","stringify","create","contentType","params","id","window","location","param","matchModel","input","input_id","field_list","value","_showMessage","success_message","responseJSON","err_msg","$panel","parents","filter","indexOf","css","first","animate","scrollTop","update"],"mappings":"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","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        })\n            .done(response => {\n                var options = $.extend({}, self.model.attributes, response);\n                var form = new Form({\n                    title: options.title,\n                    message: options.message,\n                    status: options.status || \"warning\",\n                    icon: options.icon,\n                    initial_errors: true,\n                    errors: options.errors,\n                    inputs: options.inputs,\n                    buttons: {\n                        submit: new Ui.Button({\n                            tooltip: options.submit_tooltip,\n                            title: options.submit_title || \"Save\",\n                            icon: options.submit_icon || \"fa-save\",\n                            cls: \"btn btn-primary ui-clear-float\",\n                            onclick: function() {\n                                self._submit(form);\n                            }\n                        })\n                    }\n                });\n                self.$el.empty().append(form.$el);\n            })\n            .fail(response => {\n                self.$el.empty().append(\n                    new Ui.Message({\n                        message: `Failed to load resource ${self.url}.`,\n                        status: \"danger\",\n                        persistent: true\n                    }).$el\n                );\n            });\n    },\n\n    _submit: function(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        })\n            .done(response => {\n                var params = {};\n                if (response.id) {\n                    params.id = response.id;\n                } else {\n                    params = {\n                        message: response.message,\n                        status: \"success\",\n                        persistent: false\n                    };\n                }\n                if (self.redirect) {\n                    window.location = `${Galaxy.root + self.redirect}?${$.param(params)}`;\n                } else {\n                    form.data.matchModel(response, (input, input_id) => {\n                        form.field_list[input_id].value(input.value);\n                    });\n                    self._showMessage(form, success_message);\n                }\n            })\n            .fail(response => {\n                self._showMessage(form, {\n                    message: response.responseJSON.err_msg,\n                    status: \"danger\",\n                    persistent: false\n                });\n            });\n    },\n\n    _showMessage: function(form, options) {\n        var $panel = form.$el\n            .parents()\n            .filter(function() {\n                return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n            })\n            .first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexport default {\n    View: View\n};\n"]}
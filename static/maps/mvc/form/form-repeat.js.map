{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["View","Backbone","extend","initialize","options","list","merge","title","empty_text","max","min","button_new","ButtonIcon","icon","tooltip","cls","onclick","onnew","setElement","$","append","$list","$el","size","_","add","id","Galaxy","emit","debug","button_delete","ondel","portlet","operations","addClass","hide","fadeIn","disable","_refresh","del","find","remove","enable","delAll","hideOptions","each","hideOperation","isEmpty","html","index"],"mappings":"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","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["import _l from \"utils/localization\";\n/** This class creates a ui component which enables the dynamic creation of portlets */\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\n\nexport var View = Backbone.View.extend({\n    initialize: function(options) {\n        this.list = {};\n        this.options = Utils.merge(options, {\n            title: _l(\"Repeat\"),\n            empty_text: \"Not available.\",\n            max: null,\n            min: null\n        });\n        this.button_new = new Ui.ButtonIcon({\n            icon: \"fa-plus\",\n            title: `Insert ${this.options.title}`,\n            tooltip: `Add new ${this.options.title} block`,\n            cls: \"ui-button-icon ui-clear-float form-repeat-add\",\n            onclick: function() {\n                if (options.onnew) {\n                    options.onnew();\n                }\n            }\n        });\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$list = $(\"<div/>\")))\n                .append($(\"<div/>\").append(this.button_new.$el))\n        );\n    },\n\n    /** Number of repeat blocks */\n    size: function() {\n        return _.size(this.list);\n    },\n\n    /** Add new repeat block */\n    add: function(options) {\n        if (!options.id || this.list[options.id]) {\n            Galaxy.emit.debug(\"form-repeat::add()\", \"Duplicate or invalid repeat block id.\");\n            return;\n        }\n        var button_delete = new Ui.ButtonIcon({\n            icon: \"fa-trash-o\",\n            tooltip: _l(\"Delete this repeat block\"),\n            cls: \"ui-button-icon-plain form-repeat-delete\",\n            onclick: function() {\n                if (options.ondel) {\n                    options.ondel();\n                }\n            }\n        });\n        var portlet = new Portlet.View({\n            id: options.id,\n            title: _l(\"placeholder\"),\n            cls: options.cls || \"ui-portlet-repeat\",\n            operations: { button_delete: button_delete }\n        });\n        portlet.append(options.$el);\n        portlet.$el.addClass(\"section-row\").hide();\n        this.list[options.id] = portlet;\n        this.$list.append(portlet.$el.fadeIn(\"fast\"));\n        if (this.options.max > 0 && this.size() >= this.options.max) {\n            this.button_new.disable();\n        }\n        this._refresh();\n    },\n\n    /** Delete repeat block */\n    del: function(id) {\n        if (!this.list[id]) {\n            Galaxy.emit.debug(\"form-repeat::del()\", \"Invalid repeat block id.\");\n            return;\n        }\n        this.$list.find(`#${id}`).remove();\n        delete this.list[id];\n        this.button_new.enable();\n        this._refresh();\n    },\n\n    /** Remove all */\n    delAll: function() {\n        for (var id in this.list) {\n            this.del(id);\n        }\n    },\n\n    /** Hides add/del options */\n    hideOptions: function() {\n        this.button_new.$el.hide();\n        _.each(this.list, portlet => {\n            portlet.hideOperation(\"button_delete\");\n        });\n        if (_.isEmpty(this.list)) {\n            this.$el.append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-info\")\n                    .html(this.options.empty_text)\n            );\n        }\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        var index = 0;\n        for (var id in this.list) {\n            var portlet = this.list[id];\n            portlet.title(`${++index}: ${this.options.title}`);\n            portlet[this.size() > this.options.min ? \"showOperation\" : \"hideOperation\"](\"button_delete\");\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}
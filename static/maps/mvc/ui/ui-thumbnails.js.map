{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["View","Backbone","extend","events","initialize","options","model","Model","collection","Collection","get","tabs","setElement","$el","addClass","render","listenTo","first","delAll","_renderDefault","_renderList","title_length","$","each","indexOf","title","append","_templateThumbnailItem","id","length","substr","title_icon","image_src","tooltip","placement","children","add","uid","self","_templateRegularItem","attributes","value","new_value","undefined","before","attr","removeClass","after","change_handler","_onclick","e","target","closest","_ondblclick","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\n\nexport var View = Backbone.View.extend({\n    events: {\n        \"click .ui-thumbnails-item\": \"_onclick\",\n        \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n    },\n\n    initialize: function(options) {\n        this.model = options.model || new Backbone.Model(options);\n        this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n        this.tabs = new Tabs.View({});\n        this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"reset change add remove\", this.render, this);\n    },\n\n    render: function() {\n        this.first = null;\n        this.tabs.delAll();\n        this._renderDefault();\n        this._renderList();\n    },\n\n    _renderDefault: function() {\n        var title_length = 20;\n        var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n        this.collection.each(model => {\n            if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                var title = model.get(\"title\");\n                $el.append(\n                    $(\n                        this._templateThumbnailItem({\n                            id: model.id,\n                            title: title.length < title_length ? title : `${title.substr(0, title_length)}...`,\n                            title_icon: model.get(\"title_icon\"),\n                            image_src: model.get(\"image_src\")\n                        })\n                    ).tooltip({\n                        title: model.get(\"description\"),\n                        placement: \"bottom\"\n                    })\n                );\n            }\n        });\n        if ($el.children().length > 0) {\n            this.tabs.add({\n                id: Utils.uid(),\n                title: this.model.get(\"title_default\"),\n                $el: $el\n            });\n        }\n    },\n\n    _renderList: function() {\n        var self = this;\n        if (this.collection.length > 0) {\n            this.first = this.first || this.collection.first().id;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(model => {\n                $el.append(self._templateRegularItem(model.attributes));\n            });\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_list\"),\n                $el: $el\n            });\n        }\n    },\n\n    /** Set/Get value */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            new_value = new_value == \"__first\" ? this.first : new_value;\n            var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n            this.$(`[value=\"${new_value}\"]`).addClass(\"ui-thumbnail-current\");\n            var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            var change_handler = this.model.get(\"onchange\");\n            if (after != before && change_handler) {\n                change_handler(after);\n            }\n        }\n        return this.$(\".ui-thumbnail-current\").attr(\"value\");\n    },\n\n    /** Add click handler */\n    _onclick: function(e) {\n        this.value(\n            $(e.target)\n                .closest(\".ui-thumbnails-item\")\n                .attr(\"value\")\n        );\n    },\n\n    /** Add double click handler */\n    _ondblclick: function() {\n        if (this.model.get(\"ondblclick\")) {\n            this.model.get(\"ondblclick\")(this.value());\n        }\n    },\n\n    /* Thumbnail template with image */\n    _templateThumbnailItem: function(options) {\n        return `<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"${\n            options.id\n        }\"><img class=\"ui-thumbnails-image\" src=\"${\n            options.image_src\n        }\"><div class=\"ui-thumbnails-title ui-form-info\"><span class=\"fa ${options.title_icon}\"/>${\n            options.title\n        }</div><div>`;\n    },\n\n    /* Thumbnail template with image and description */\n    _templateRegularItem: function(options) {\n        return `<div class=\"ui-thumbnails-item\" value=\"${\n            options.id\n        }\"><table><tr><td><img class=\"ui-thumbnails-image\" src=\"${\n            options.image_src\n        }\"></td><td><div class=\"ui-thumbnails-description-title ui-form-info\">${\n            options.title\n        }</div><div class=\"ui-thumbnails-description-text ui-form-info\">${options.description}</div></td></tr><div>`;\n    }\n});\n\nexport default { View: View };\n"]}
{"version":3,"sources":["mvc/ui/ui-slider.js"],"names":["View","Backbone","extend","initialize","options","self","model","Model","id","uid","min","max","step","precise","split","value","onchange","set","setElement","_template","$el","attr","$text","$","$slider","pressed","on","val","e","which","v","get","event","preventDefault","indexOf","_isParameter","opts","attributes","has_slider","addClass","slider","ui","hide","listenTo","render","new_val","undefined","isNaN","Math","round","trigger","String","substring"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-slider.js","sourcesContent":["import Utils from \"utils/utils\";\n\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                min: null,\n                max: null,\n                step: null,\n                precise: false,\n                split: 10000,\n                value: null,\n                onchange: function() {}\n            }).set(options);\n\n        // create new element\n        this.setElement(this._template());\n        this.$el.attr(\"id\", this.model.id);\n        this.$text = this.$(\".ui-form-slider-text\");\n        this.$slider = this.$(\".ui-form-slider-element\");\n\n        // add text field event\n        var pressed = [];\n        this.$text\n            .on(\"change\", function() {\n                self.value($(this).val());\n            })\n            .on(\"keyup\", e => {\n                pressed[e.which] = false;\n            })\n            .on(\"keydown\", function(e) {\n                var v = e.which;\n                pressed[v] = true;\n                if (self.model.get(\"is_workflow\") && pressed[16] && v == 52) {\n                    self.value(\"$\");\n                    event.preventDefault();\n                } else if (\n                    !(\n                        v == 8 ||\n                        v == 9 ||\n                        v == 13 ||\n                        v == 37 ||\n                        v == 39 ||\n                        (v >= 48 && v <= 57 && !pressed[16]) ||\n                        (v >= 96 && v <= 105) ||\n                        ((v == 190 || v == 110) &&\n                            $(this)\n                                .val()\n                                .indexOf(\".\") == -1 &&\n                            self.model.get(\"precise\")) ||\n                        ((v == 189 || v == 109) &&\n                            $(this)\n                                .val()\n                                .indexOf(\"-\") == -1) ||\n                        self._isParameter($(this).val()) ||\n                        pressed[91] ||\n                        pressed[17]\n                    )\n                ) {\n                    event.preventDefault();\n                }\n            });\n\n        // build slider, cannot be rebuild in render\n        var opts = this.model.attributes;\n        this.has_slider = opts.max !== null && opts.min !== null && opts.max > opts.min;\n        var step = opts.step;\n        if (!step) {\n            if (opts.precise && this.has_slider) {\n                step = (opts.max - opts.min) / opts.split;\n            } else {\n                step = 1.0;\n            }\n        }\n        if (this.has_slider) {\n            this.$text.addClass(\"ui-form-slider-left\");\n            this.$slider.slider({ min: opts.min, max: opts.max, step: step }).on(\"slide\", (event, ui) => {\n                self.value(ui.value);\n            });\n        } else {\n            this.$slider.hide();\n        }\n\n        // add listeners\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        var value = this.model.get(\"value\");\n        this.has_slider && this.$slider.slider(\"value\", value);\n        value !== this.$text.val() && this.$text.val(value);\n    },\n\n    /** Set and return the current value */\n    value: function(new_val) {\n        var options = this.model.attributes;\n        if (new_val !== undefined) {\n            if (new_val !== null && new_val !== \"\" && !this._isParameter(new_val)) {\n                isNaN(new_val) && (new_val = 0);\n                !options.precise && (new_val = Math.round(new_val));\n                options.max !== null && (new_val = Math.min(new_val, options.max));\n                options.min !== null && (new_val = Math.max(new_val, options.min));\n            }\n            this.model.set(\"value\", new_val);\n            this.model.trigger(\"change\");\n            options.onchange(new_val);\n        }\n        return this.model.get(\"value\");\n    },\n\n    /** Return true if the field contains a workflow parameter i.e. $('name') */\n    _isParameter: function(value) {\n        return this.model.get(\"is_workflow\") && String(value).substring(0, 1) === \"$\";\n    },\n\n    /** Slider template */\n    _template: function() {\n        return (\n            '<div class=\"ui-form-slider\">' +\n            '<input class=\"ui-form-slider-text\" type=\"text\"/>' +\n            '<div class=\"ui-form-slider-element\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n"]}
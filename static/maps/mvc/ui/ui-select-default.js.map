{"version":3,"sources":["mvc/ui/ui-select-default.js"],"names":["View","Backbone","extend","initialize","options","data","data2","model","Model","id","uid","cls","error_text","empty_text","visible","wait","multiple","searchable","optional","disabled","readonly","onchange","value","individual","pagesize","set","on","get","listenTo","_changeData","_changeDisabled","_changeWait","_changeVisible","_changeValue","render","_renderSearchable","_renderClassic","$el","addClass","attr","$select","empty","prop","_getValue","trigger","append","$","$dropdown","$resize","$resize_icon","hide","show","removeClass","off","currentY","event","pageY","currentHeight","height","minHeight","Math","max","select2","all_button","ButtonCheck","onclick","new_value","_","each","push","option","prepend","_match","term","text","String","toUpperCase","indexOf","label","length","index","order","tags","matched_tags","closeOnSelect","query","results","filter","found","e","q","tag","callback","slice","page","more","formatResult","extraTagWarning","filteredTags","result","hasOwnProperty","t","escape","reduce","memo","find","remove","html","_setValue","isArray","first","undefined","exists","findWhere","v","d","unwait","enable","disable","add","sorter","keep","sort","update","setOnChange","val","selected","a","b","isEmpty"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-select-default.js","sourcesContent":["/**\n *  This class creates/wraps a default html select field as backbone class.\n */\nimport Utils from \"utils/utils\";\nimport Buttons from \"mvc/ui/ui-buttons\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.data = [];\n        this.data2 = [];\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                id: Utils.uid(),\n                cls: \"ui-select\",\n                error_text: \"No options available\",\n                empty_text: \"Nothing selected\",\n                visible: true,\n                wait: false,\n                multiple: false,\n                searchable: true,\n                optional: false,\n                disabled: false,\n                readonly: false,\n                onchange: function() {},\n                value: null,\n                individual: false,\n                pagesize: 20\n            }).set(options);\n        this.on(\"change\", () => {\n            if (this.model.get(\"onchange\")) {\n                this.model.get(\"onchange\")(this.value());\n            }\n        });\n        this.listenTo(this.model, \"change:data\", this._changeData, this);\n        this.listenTo(this.model, \"change:disabled\", this._changeDisabled, this);\n        this.listenTo(this.model, \"change:wait\", this._changeWait, this);\n        this.listenTo(this.model, \"change:visible\", this._changeVisible, this);\n        this.listenTo(this.model, \"change:value\", this._changeValue, this);\n        this.listenTo(this.model, \"change:multiple change:searchable change:cls change:id\", this.render, this);\n        this.render();\n    },\n\n    render: function() {\n        if (this.model.get(\"searchable\")) {\n            this._renderSearchable();\n        } else {\n            this._renderClassic();\n        }\n        this.$el.addClass(this.model.get(\"cls\")).attr(\"id\", this.model.get(\"id\"));\n        this.$select\n            .empty()\n            .addClass(\"select\")\n            .attr(\"id\", `${this.model.get(\"id\")}_select`)\n            .prop(\"multiple\", this.model.get(\"multiple\"))\n            .on(\"change\", () => {\n                this.value(this._getValue());\n                this.trigger(\"change\");\n            });\n        this._changeData();\n        this._changeWait();\n        this._changeVisible();\n        this._changeDisabled();\n    },\n\n    /** Renders the classic selection field */\n    _renderClassic: function() {\n        this.$el\n            .addClass(this.model.get(\"multiple\") ? \"ui-select-multiple\" : \"ui-select\")\n            .append((this.$select = $(\"<select/>\")))\n            .append((this.$dropdown = $(\"<div/>\")))\n            .append((this.$resize = $(\"<div/>\").append((this.$resize_icon = $(\"<i/>\")))));\n        if (this.model.get(\"multiple\")) {\n            this.$dropdown.hide();\n            this.$resize_icon.addClass(\"fa fa-angle-double-right fa-rotate-45\").show();\n            this.$resize\n                .removeClass()\n                .addClass(\"icon-resize\")\n                .show()\n                .off(\"mousedown\")\n                .on(\"mousedown\", event => {\n                    var currentY = event.pageY;\n                    var currentHeight = this.$select.height();\n                    this.minHeight = this.minHeight || currentHeight;\n                    $(\"#dd-helper\")\n                        .show()\n                        .on(\"mousemove\", event => {\n                            this.$select.height(Math.max(currentHeight + (event.pageY - currentY), this.minHeight));\n                        })\n                        .on(\"mouseup mouseleave\", () => {\n                            $(\"#dd-helper\")\n                                .hide()\n                                .off();\n                        });\n                });\n        } else {\n            this.$dropdown.show();\n            this.$resize.hide();\n            this.$resize_icon.hide();\n        }\n    },\n\n    /** Renders the default select2 field */\n    _renderSearchable: function() {\n        this.$el.append((this.$select = $(\"<div/>\"))).append((this.$dropdown = $(\"<div/>\")));\n        this.$dropdown.hide();\n        if (!this.model.get(\"multiple\")) {\n            this.$dropdown.show().on(\"click\", () => {\n                if (this.$select.select2) {\n                    this.$select.select2(\"open\");\n                }\n            });\n        }\n        this.all_button = null;\n        if (this.model.get(\"multiple\") && !this.model.get(\"individual\") && !this.model.get(\"readonly\")) {\n            this.all_button = new Buttons.ButtonCheck({\n                onclick: () => {\n                    var new_value = [];\n                    if (this.all_button.value() !== 0) {\n                        _.each(this.model.get(\"data\"), option => {\n                            new_value.push(option.value);\n                        });\n                    }\n                    this.value(new_value);\n                    this.trigger(\"change\");\n                }\n            });\n            this.$el.prepend(this.all_button.$el);\n        }\n    },\n\n    /** Matches a search term with a given text */\n    _match: function(term, text) {\n        return (\n            !term ||\n            term === \"\" ||\n            String(text)\n                .toUpperCase()\n                .indexOf(term.toUpperCase()) >= 0\n        );\n    },\n\n    /** Updates the selection options */\n    _changeData: function() {\n        this.data = [];\n        if (!this.model.get(\"multiple\") && this.model.get(\"optional\")) {\n            this.data.push({\n                value: \"__null__\",\n                label: this.model.get(\"empty_text\")\n            });\n        }\n        _.each(this.model.get(\"data\"), option => {\n            this.data.push(option);\n        });\n        if (this.length() === 0) {\n            this.data.push({\n                value: \"__null__\",\n                label: this.model.get(\"error_text\")\n            });\n        }\n        if (this.model.get(\"searchable\")) {\n            this.data2 = [];\n            _.each(this.data, (option, index) => {\n                this.data2.push({\n                    order: index,\n                    id: option.value,\n                    text: option.label,\n                    tags: option.tags\n                });\n            });\n            if (this.$select.data(\"select2\")) {\n                this.$select.select2(\"destroy\");\n            }\n            this.matched_tags = {};\n            this.$select.select2({\n                data: this.data2,\n                closeOnSelect: !this.model.get(\"multiple\"),\n                multiple: this.model.get(\"multiple\"),\n                query: q => {\n                    this.matched_tags = {};\n                    var pagesize = this.model.get(\"pagesize\");\n                    var results = _.filter(this.data2, e => {\n                        var found = false;\n                        _.each(e.tags, tag => {\n                            if (this._match(q.term, tag)) {\n                                found = this.matched_tags[tag] = true;\n                            }\n                        });\n                        return found || this._match(q.term, e.text);\n                    });\n                    q.callback({\n                        results: results.slice((q.page - 1) * pagesize, q.page * pagesize),\n                        more: results.length >= q.page * pagesize\n                    });\n                },\n                formatResult: result => {\n                    let extraTagWarning = \"\";\n                    let filteredTags = _.filter(result.tags, t => this.matched_tags.hasOwnProperty(t));\n                    if (filteredTags.length > 5) {\n                        extraTagWarning = `&nbsp;<div class=\"label label-warning\">${filteredTags.length -\n                            5} more tags</div>`;\n                    }\n                    return `\n                    ${_.escape(result.text)}\n                    <div class=\"ui-tags\">\n                        ${_.reduce(\n                            filteredTags.slice(0, 5),\n                            (memo, tag) => {\n                                return `${memo}&nbsp;<div class=\"label label-info\">${_.escape(tag)}</div>`;\n                            },\n                            \"\"\n                        )}\n                        ${extraTagWarning}\n                   </div>`;\n                }\n            });\n            this.$(\".select2-container .select2-search input\").off(\"blur\");\n        } else {\n            this.$select.find(\"option\").remove();\n            _.each(this.data, option => {\n                this.$select.append(\n                    $(\"<option/>\")\n                        .attr(\"value\", option.value)\n                        .html(_.escape(option.label))\n                );\n            });\n        }\n        this.model.set(\"disabled\", this.model.get(\"readonly\") || this.length() === 0);\n        this._changeValue();\n    },\n\n    /** Handles field enabling/disabling, usually used when no options are available */\n    _changeDisabled: function() {\n        if (this.model.get(\"searchable\")) {\n            this.$select.select2(this.model.get(\"disabled\") ? \"disable\" : \"enable\");\n        } else {\n            this.$select.prop(\"disabled\", this.model.get(\"disabled\"));\n        }\n    },\n\n    /** Searchable fields may display a spinner e.g. while waiting for a server response */\n    _changeWait: function() {\n        this.$dropdown\n            .removeClass()\n            .addClass(\"icon-dropdown fa\")\n            .addClass(this.model.get(\"wait\") ? \"fa-spinner fa-spin\" : \"fa-caret-down\");\n    },\n\n    /** Handles field visibility */\n    _changeVisible: function() {\n        this.$el[this.model.get(\"visible\") ? \"show\" : \"hide\"]();\n        this.$select[this.model.get(\"visible\") ? \"show\" : \"hide\"]();\n    },\n\n    /** Synchronizes the model value with the actually selected field value */\n    _changeValue: function() {\n        this._setValue(this.model.get(\"value\"));\n        if (this.model.get(\"multiple\")) {\n            if (this.all_button) {\n                var value = this._getValue();\n                this.all_button.value($.isArray(value) ? value.length : 0, this.length());\n            }\n        } else if (this._getValue() === null && !this.model.get(\"optional\")) {\n            this._setValue(this.first());\n        }\n    },\n\n    /** Return/Set current selection */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            this.model.set(\"value\", new_value);\n        }\n        return this._getValue();\n    },\n\n    /** Return the first select option */\n    first: function() {\n        return this.data.length > 0 ? this.data[0].value : null;\n    },\n\n    /** Check if a value is an existing option */\n    exists: function(value) {\n        return _.findWhere(this.data, { value: value });\n    },\n\n    /** Return the label/text of the current selection */\n    text: function() {\n        var v = this._getValue();\n        var d = this.exists($.isArray(v) ? v[0] : v);\n        return d ? d.label : \"\";\n    },\n\n    /** Show the select field */\n    show: function() {\n        this.model.set(\"visible\", true);\n    },\n\n    /** Hide the select field */\n    hide: function() {\n        this.model.set(\"visible\", false);\n    },\n\n    /** Show a spinner indicating that the select options are currently loaded */\n    wait: function() {\n        this.model.set(\"wait\", true);\n    },\n\n    /** Hide spinner indicating that the request has been completed */\n    unwait: function() {\n        this.model.set(\"wait\", false);\n    },\n\n    /** Returns true if the field is disabled */\n    disabled: function() {\n        return this.model.get(\"disabled\");\n    },\n\n    /** Enable the select field */\n    enable: function() {\n        this.model.set(\"disabled\", false);\n    },\n\n    /** Disable the select field */\n    disable: function() {\n        this.model.set(\"disabled\", true);\n    },\n\n    /** Update all available options at once */\n    add: function(options, sorter) {\n        _.each(this.model.get(\"data\"), v => {\n            if (v.keep && !_.findWhere(options, { value: v.value })) {\n                options.push(v);\n            }\n        });\n        if (sorter && options) {\n            options.sort(sorter);\n        }\n        this.model.set(\"data\", options);\n    },\n\n    /** Update available options */\n    update: function(options) {\n        this.model.set(\"data\", options);\n    },\n\n    /** Set the custom onchange callback function */\n    setOnChange: function(callback) {\n        this.model.set(\"onchange\", callback);\n    },\n\n    /** Number of available options */\n    length: function() {\n        return $.isArray(this.model.get(\"data\")) ? this.model.get(\"data\").length : 0;\n    },\n\n    /** Set value to dom */\n    _setValue: function(new_value) {\n        if (new_value === null || new_value === undefined) {\n            new_value = \"__null__\";\n        }\n        if (this.model.get(\"multiple\")) {\n            new_value = $.isArray(new_value) ? new_value : [new_value];\n        } else if ($.isArray(new_value)) {\n            if (new_value.length > 0) {\n                new_value = new_value[0];\n            } else {\n                new_value = \"__null__\";\n            }\n        }\n        if (this.model.get(\"searchable\")) {\n            if ($.isArray(new_value)) {\n                var val = [];\n                _.each(new_value, v => {\n                    var d = _.findWhere(this.data2, { id: v });\n                    if (d) {\n                        val.push(d);\n                    }\n                });\n                new_value = val;\n            } else {\n                var d = _.findWhere(this.data2, { id: new_value });\n                new_value = d;\n            }\n            this.$select.select2(\"data\", new_value);\n        } else {\n            this.$select.val(new_value);\n        }\n    },\n\n    /** Get value from dom */\n    _getValue: function() {\n        var val = null;\n        if (this.model.get(\"searchable\")) {\n            var selected = this.$select.select2(\"data\");\n            if (selected) {\n                if ($.isArray(selected)) {\n                    val = [];\n                    selected.sort((a, b) => a.order - b.order);\n                    _.each(selected, v => {\n                        val.push(v.id);\n                    });\n                } else {\n                    val = selected.id;\n                }\n            }\n        } else {\n            val = this.$select.val();\n        }\n        return Utils.isEmpty(val) ? null : val;\n    }\n});\n\nexport default {\n    View: View\n};\n"]}
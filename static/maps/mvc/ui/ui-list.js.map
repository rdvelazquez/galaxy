{"version":3,"sources":["mvc/ui/ui-list.js"],"names":["View","Backbone","extend","initialize","options","self","name","multiple","message","Message","portlet","cls","select","Select","optional","button","ButtonIcon","icon","tooltip","onclick","add","id","value","text","setElement","_template","$","append","$el","val","undefined","empty","isArray","i","v","v_id","v_name","type","_refresh","lst","each","push","prop","find","html","length","isEmpty","_templateRow","on","remove","addClass","removeClass","update","status","disable","show","enable","hide","onchange"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-list.js","sourcesContent":["// dependencies\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\n// ui list element\nvar View = Backbone.View.extend({\n    // create portlet to keep track of selected list elements\n    initialize: function(options) {\n        // link this\n        var self = this;\n\n        // initialize options\n        this.options = options;\n        this.name = options.name || \"element\";\n        this.multiple = options.multiple || false;\n\n        // create message handler\n        this.message = new Ui.Message();\n\n        // create portlet\n        this.portlet = new Portlet.View({ cls: \"ui-portlet-section\" });\n\n        // create select field containing the options which can be inserted into the list\n        this.select = new Ui.Select.View({ optional: options.optional });\n\n        // create insert new list element button\n        this.button = new Ui.ButtonIcon({\n            icon: \"fa fa-sign-in\",\n            tooltip: `Insert new ${this.name}`,\n            onclick: function() {\n                self.add({\n                    id: self.select.value(),\n                    name: self.select.text()\n                });\n            }\n        });\n\n        // build main element\n        this.setElement(this._template(options));\n        this.$(\".ui-list-message\").append(this.message.$el);\n        this.$(\".ui-list-portlet\").append(this.portlet.$el);\n        this.$(\".ui-list-button\").append(this.button.$el);\n        this.$(\".ui-list-select\").append(this.select.$el);\n    },\n\n    /** Return/Set currently selected list elements */\n    value: function(val) {\n        // set new value\n        if (val !== undefined) {\n            this.portlet.empty();\n            if ($.isArray(val)) {\n                for (var i in val) {\n                    var v = val[i];\n                    var v_id = null;\n                    var v_name = null;\n                    if ($.type(v) != \"string\") {\n                        v_id = v.id;\n                        v_name = v.name;\n                    } else {\n                        v_id = v_name = v;\n                    }\n                    if (v_id != null) {\n                        this.add({\n                            id: v_id,\n                            name: v_name\n                        });\n                    }\n                }\n            }\n            this._refresh();\n        }\n        // get current value\n        var lst = [];\n        this.$(\".ui-list-id\").each(function() {\n            lst.push({\n                id: $(this).prop(\"id\"),\n                name: $(this)\n                    .find(\".ui-list-name\")\n                    .html()\n            });\n        });\n        if (lst.length == 0) {\n            return null;\n        }\n        return lst;\n    },\n\n    /** Add row */\n    add: function(options) {\n        var self = this;\n        if (this.$(`[id=\"${options.id}\"]`).length === 0) {\n            if (!Utils.isEmpty(options.id)) {\n                var $el = $(\n                    this._templateRow({\n                        id: options.id,\n                        name: options.name\n                    })\n                );\n                $el.on(\"click\", () => {\n                    $el.remove();\n                    self._refresh();\n                });\n                $el.on(\"mouseover\", () => {\n                    $el.addClass(\"portlet-highlight\");\n                });\n                $el.on(\"mouseout\", () => {\n                    $el.removeClass(\"portlet-highlight\");\n                });\n                this.portlet.append($el);\n                this._refresh();\n            } else {\n                this.message.update({\n                    message: `Please select a valid ${this.name}.`,\n                    status: \"danger\"\n                });\n            }\n        } else {\n            this.message.update({\n                message: `This ${this.name} is already in the list.`\n            });\n        }\n    },\n\n    /** Update available options */\n    update: function(options) {\n        this.select.update(options);\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        if (this.$(\".ui-list-id\").length > 0) {\n            !this.multiple && this.button.disable();\n            this.$(\".ui-list-portlet\").show();\n        } else {\n            this.button.enable();\n            this.$(\".ui-list-portlet\").hide();\n        }\n        this.options.onchange && this.options.onchange();\n    },\n\n    /** Main Template */\n    _template: function(options) {\n        return (\n            '<div class=\"ui-list\">' +\n            '<div class=\"ui-margin-top\">' +\n            '<span class=\"ui-list-button\"/>' +\n            '<span class=\"ui-list-select\"/>' +\n            \"</div>\" +\n            '<div class=\"ui-list-message\"/>' +\n            '<div class=\"ui-list-portlet\"/>' +\n            \"</div>\"\n        );\n    },\n\n    /** Row Template */\n    _templateRow: function(options) {\n        return `<div id=\"${\n            options.id\n        }\" class=\"ui-list-id\"><span class=\"ui-list-delete fa fa-trash\"/><span class=\"ui-list-name\">${\n            options.name\n        }</span></div>`;\n    }\n});\n\nexport default {\n    View: View\n};\n"]}
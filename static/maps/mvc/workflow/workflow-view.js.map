{"version":3,"sources":["mvc/workflow/workflow-view.js"],"names":["Toastr","window","workflow_globals","reset_tool_search","initValue","tool_menu_frame","$","contents","length","document","removeClass","find","hide","show","each","attr","hasClass","search_input","val","add_node_icon","$to_el","nodeType","iconStyle","$icon","addClass","before","Backbone","View","extend","initialize","options","self","app","urls","close_editor","workflow","check_changes_in_active_form","has_changes","do_close","onbeforeunload","undefined","location","workflow_index","show_modal","Cancel","hide_modal","save_current_workflow","eventObj","success_callback","show_message","rectify_workflow_outputs","request","url","Galaxy","root","id","type","data","to_simple","success","body","text","message","errors","errlist","i","v","appendTo","append","name","stored","showWorkflowParameters","Ok","error","response","err_msg","click","focus","select","keyup","css","value","lastValue","q","timer","clearTimeout","setTimeout","get","tool_search","s","map","n","index","parent","this_label","next","no_visible_tools","is","canvas_manager","reset","datatypes","JSON","parse","ajax","async","responseText","datatypes_mapping","ext_to_type","ext_to_class_name","type_to_type","class_to_classes","_workflowLoadAjax","from_simple","fit_canvas_to_nodes","scroll_to_nodes","draw_overview","upgrade_message","_","steps","step","step_id","details","upgrade_messages","m","parseInt","nodes","Continue","beforeSubmit","make_popupmenu","Save","workflow_save_as","Run","clear_active_node","layout_editor","Close","OK","rename_name","rename_annotation","workflow_name","workflow_annotation","workflow_data","stringify","done","fail","alert","edit_workflow_outputs","new_content","node_key","node","indexOf","ot_key","output_terminals","output","isWorkflowOutput","html","bind","node_id","split","workflowNode","output_name","checked","addWorkflowOutput","removeWorkflowOutput","layout","overview_size","jStorage","width","height","hide_overview","show_overview","e","d","op","offsetParent","opo","offset","new_size","Math","max","offsetX","left","offsetY","top","set","workflows","_buildToolPanelWorkflows","wrap","last_expanded","slideUp","slideDown","rename_async","annotate_async","$section","copy","ButtonIcon","icon","cls","tooltip","onclick","step_count","copy_into_workflow","modal","title","buttons","Copy","$add","on","add_node_for_subworkflow","latest_id","$el","workflowId","k","vv","remove_all","cv","cc","merge","load_workflow","dataType","cache","_moduleInitAjax","request_data","init_field_data","update_field_data","activate_node","add_node_for_tool","create_node","tool_id","content_id","add_node_for_module","display_file_list","addlist","out_terminal","parameter_re","workflow_parameters","wf_parm_container","wf_parm_box","new_parameter_content","matches","config_form","inputs","deepeach","form_matches","match","concat","post_job_actions","pja","action_arguments","action_argument","arg_matches","element","inArray","push","substring","showAttributes","showForm","content","$container","form_type","form","emit","debug","scrollTop","isSubType","child","prebuildNode","title_text","$f","$title","scrollLeft","tmp","clone","destroy","o","position","p","prependTo","node_changed","po","x","y","terminal","redraw"],"mappings":"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","file":"../../../scripts/mvc/workflow/workflow-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nimport Workflow from \"mvc/workflow/workflow-manager\";\nimport WorkflowCanvas from \"mvc/workflow/workflow-canvas\";\nimport Node from \"mvc/workflow/workflow-node\";\nimport WorkflowIcons from \"mvc/workflow/workflow-icons\";\nimport FormWrappers from \"mvc/workflow/workflow-forms\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport async_save_text from \"utils/async-save-text\";\nimport * as Toastr from \"libs/toastr\";\nimport \"ui/editable-text\";\n\n// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\n// Reset tool search to start state.\nfunction reset_tool_search(initValue) {\n    // Function may be called in top frame or in tool_menu_frame;\n    // in either case, get the tool menu frame.\n    var tool_menu_frame = $(\"#galaxy_tools\").contents();\n    if (tool_menu_frame.length === 0) {\n        tool_menu_frame = $(document);\n        // Remove classes that indicate searching is active.\n        $(this).removeClass(\"search_active\");\n        tool_menu_frame.find(\".toolTitle\").removeClass(\"search_match\");\n\n        // Reset visibility of tools and labels.\n        tool_menu_frame.find(\".toolSectionBody\").hide();\n        tool_menu_frame.find(\".toolTitle\").show();\n        tool_menu_frame.find(\".toolPanelLabel\").show();\n        tool_menu_frame.find(\".toolSectionWrapper\").each(function() {\n            if ($(this).attr(\"id\") !== \"recently_used_wrapper\") {\n                // Default action.\n                $(this).show();\n            } else if ($(this).hasClass(\"user_pref_visible\")) {\n                $(this).show();\n            }\n        });\n        tool_menu_frame.find(\"#search-no-results\").hide();\n\n        // Reset search input.\n        tool_menu_frame.find(\"#search-spinner\").hide();\n        if (initValue) {\n            var search_input = tool_menu_frame.find(\"#tool-search-query\");\n            search_input.val(\"search tools\");\n        }\n    }\n}\n\nfunction add_node_icon($to_el, nodeType) {\n    var iconStyle = WorkflowIcons[nodeType];\n    if (iconStyle) {\n        var $icon = $('<i class=\"icon fa\">&nbsp;</i>').addClass(iconStyle);\n        $to_el.before($icon);\n    }\n}\n\n// create form view\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        var self = (window.workflow_globals.app = this);\n        this.options = options;\n        this.urls = (options && options.urls) || {};\n        var close_editor = () => {\n            self.workflow.check_changes_in_active_form();\n            if (workflow && self.workflow.has_changes) {\n                var do_close = () => {\n                    window.onbeforeunload = undefined;\n                    window.document.location = self.urls.workflow_index;\n                };\n                window.show_modal(\n                    \"Close workflow editor\",\n                    \"There are unsaved changes to your workflow which will be lost.\",\n                    {\n                        Cancel: hide_modal,\n                        \"Save Changes\": function() {\n                            save_current_workflow(null, do_close);\n                        }\n                    },\n                    {\n                        \"Don't Save\": do_close\n                    }\n                );\n            } else {\n                window.document.location = self.urls.workflow_index;\n            }\n        };\n        var save_current_workflow = (eventObj, success_callback) => {\n            show_message(\"Saving workflow\", \"progress\");\n            self.workflow.check_changes_in_active_form();\n            if (!self.workflow.has_changes) {\n                hide_modal();\n                if (success_callback) {\n                    success_callback();\n                }\n                return;\n            }\n            self.workflow.rectify_workflow_outputs();\n            Utils.request({\n                url: `${Galaxy.root}api/workflows/${self.options.id}`,\n                type: \"PUT\",\n                data: { workflow: self.workflow.to_simple() },\n                success: function(data) {\n                    var body = $(\"<div/>\").text(data.message);\n                    if (data.errors) {\n                        body.addClass(\"warningmark\");\n                        var errlist = $(\"<ul/>\");\n                        $.each(data.errors, (i, v) => {\n                            $(\"<li/>\")\n                                .text(v)\n                                .appendTo(errlist);\n                        });\n                        body.append(errlist);\n                    } else {\n                        body.addClass(\"donemark\");\n                    }\n                    self.workflow.name = data.name;\n                    self.workflow.has_changes = false;\n                    self.workflow.stored = true;\n                    self.showWorkflowParameters();\n                    if (data.errors) {\n                        window.show_modal(\"Saving workflow\", body, {\n                            Ok: hide_modal\n                        });\n                    } else {\n                        success_callback && success_callback();\n                        hide_modal();\n                    }\n                },\n                error: function(response) {\n                    window.show_modal(\"Saving workflow failed.\", response.err_msg, { Ok: hide_modal });\n                }\n            });\n        };\n\n        // Init searching.\n        $(\"#tool-search-query\")\n            .click(function() {\n                $(this).focus();\n                $(this).select();\n            })\n            .keyup(function() {\n                // Remove italics.\n                $(this).css(\"font-style\", \"normal\");\n                // Don't update if same value as last time\n                if (this.value.length < 3) {\n                    reset_tool_search(false);\n                } else if (this.value != this.lastValue) {\n                    // Add class to denote that searching is active.\n                    $(this).addClass(\"search_active\");\n                    // input.addClass(config.loadingClass);\n                    // Add '*' to facilitate partial matching.\n                    var q = this.value;\n                    // Stop previous ajax-request\n                    if (this.timer) {\n                        clearTimeout(this.timer);\n                    }\n                    // Start a new ajax-request in X ms\n                    $(\"#search-spinner\").show();\n                    this.timer = setTimeout(() => {\n                        $.get(\n                            self.urls.tool_search,\n                            { q: q },\n                            data => {\n                                // input.removeClass(config.loadingClass);\n                                // Show live-search if results and search-term aren't empty\n                                $(\"#search-no-results\").hide();\n                                // Hide all tool sections.\n                                $(\".toolSectionWrapper\").hide();\n                                // This hides all tools but not workflows link (which is in a .toolTitle div).\n                                $(\".toolSectionWrapper\")\n                                    .find(\".toolTitle\")\n                                    .hide();\n                                if (data.length != 0) {\n                                    // Map tool ids to element ids and join them.\n                                    var s = $.map(data, (n, i) => `link-${n}`);\n                                    // First pass to show matching tools and their parents.\n                                    $(s).each((index, id) => {\n                                        // Add class to denote match.\n                                        $(`[id='${id}']`)\n                                            .parent()\n                                            .addClass(\"search_match\");\n                                        $(`[id='${id}']`)\n                                            .parent()\n                                            .show()\n                                            .parent()\n                                            .parent()\n                                            .show()\n                                            .parent()\n                                            .show();\n                                    });\n                                    // Hide labels that have no visible children.\n                                    $(\".toolPanelLabel\").each(function() {\n                                        var this_label = $(this);\n                                        var next = this_label.next();\n                                        var no_visible_tools = true;\n                                        // Look through tools following label and, if none are visible, hide label.\n                                        while (next.length !== 0 && next.hasClass(\"toolTitle\")) {\n                                            if (next.is(\":visible\")) {\n                                                no_visible_tools = false;\n                                                break;\n                                            } else {\n                                                next = next.next();\n                                            }\n                                        }\n                                        if (no_visible_tools) {\n                                            this_label.hide();\n                                        }\n                                    });\n                                } else {\n                                    $(\"#search-no-results\").show();\n                                }\n                                $(\"#search-spinner\").hide();\n                            },\n                            \"json\"\n                        );\n                    }, 400);\n                }\n                this.lastValue = this.value;\n            });\n\n        // Canvas overview management\n        this.canvas_manager = window.workflow_globals.canvas_manager = new WorkflowCanvas(\n            this,\n            $(\"#canvas-viewport\"),\n            $(\"#overview\")\n        );\n\n        // Initialize workflow state\n        this.reset();\n\n        // get available datatypes for post job action options\n        this.datatypes = JSON.parse(\n            $.ajax({\n                url: `${Galaxy.root}api/datatypes`,\n                async: false\n            }).responseText\n        );\n\n        // get datatype mapping options\n        this.datatypes_mapping = JSON.parse(\n            $.ajax({\n                url: `${Galaxy.root}api/datatypes/mapping`,\n                async: false\n            }).responseText\n        );\n\n        // set mapping sub lists\n        this.ext_to_type = this.datatypes_mapping.ext_to_class_name;\n        this.type_to_type = this.datatypes_mapping.class_to_classes;\n\n        // Load workflow definition\n        this._workflowLoadAjax(self.options.id, {\n            success: function(data) {\n                self.reset();\n                self.workflow.from_simple(data, true);\n                self.workflow.has_changes = false;\n                self.workflow.fit_canvas_to_nodes();\n                self.scroll_to_nodes();\n                self.canvas_manager.draw_overview();\n                // Determine if any parameters were 'upgraded' and provide message\n                var upgrade_message = \"\";\n                _.each(data.steps, (step, step_id) => {\n                    var details = \"\";\n                    if (step.errors) {\n                        details += `<li>${step.errors}</li>`;\n                    }\n                    _.each(data.upgrade_messages[step_id], m => {\n                        details += `<li>${m}</li>`;\n                    });\n                    if (details) {\n                        upgrade_message += `<li>Step ${parseInt(step_id, 10) + 1}: ${\n                            self.workflow.nodes[step_id].name\n                        }<ul>${details}</ul></li>`;\n                    }\n                });\n                if (upgrade_message) {\n                    window.show_modal(\n                        \"Issues loading this workflow\",\n                        `Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>${upgrade_message}</ul></p>`,\n                        { Continue: hide_modal }\n                    );\n                } else {\n                    hide_modal();\n                }\n                self.showWorkflowParameters();\n            },\n            beforeSubmit: function(data) {\n                show_message(\"Loading workflow\", \"progress\");\n            }\n        });\n\n        window.make_popupmenu &&\n            make_popupmenu($(\"#workflow-options-button\"), {\n                Save: save_current_workflow,\n                \"Save As\": workflow_save_as,\n                Run: function() {\n                    window.location = `${Galaxy.root}workflows/run?id=${self.options.id}`;\n                },\n                \"Edit Attributes\": function() {\n                    self.workflow.clear_active_node();\n                },\n                \"Auto Re-layout\": layout_editor,\n                Close: close_editor\n            });\n\n        /******************************************** Issue 3000*/\n        function workflow_save_as() {\n            var body = $(\n                '<form><label style=\"display:inline-block; width: 100%;\">Save as name: </label><input type=\"text\" id=\"workflow_rename\" style=\"width: 80%;\" autofocus/>' +\n                    '<br><label style=\"display:inline-block; width: 100%;\">Annotation: </label><input type=\"text\" id=\"wf_annotation\" style=\"width: 80%;\" /></form>'\n            );\n            window.show_modal(\"Save As a New Workflow\", body, {\n                OK: function() {\n                    var rename_name =\n                        $(\"#workflow_rename\").val().length > 0\n                            ? $(\"#workflow_rename\").val()\n                            : `SavedAs_${self.workflow.name}`;\n                    var rename_annotation = $(\"#wf_annotation\").val().length > 0 ? $(\"#wf_annotation\").val() : \"\";\n                    $.ajax({\n                        url: self.urls.workflow_save_as,\n                        type: \"POST\",\n                        data: {\n                            workflow_name: rename_name,\n                            workflow_annotation: rename_annotation,\n                            workflow_data: function() {\n                                return JSON.stringify(self.workflow.to_simple());\n                            }\n                        }\n                    })\n                        .done(id => {\n                            window.onbeforeunload = undefined;\n                            window.location = `${Galaxy.root}workflow/editor?id=${id}`;\n                            hide_modal();\n                        })\n                        .fail(() => {\n                            hide_modal();\n                            alert(\"Saving this workflow failed. Please contact this site's administrator.\");\n                        });\n                },\n                Cancel: hide_modal\n            });\n        }\n\n        function edit_workflow_outputs() {\n            self.workflow.clear_active_node();\n            $(\".right-content\").hide();\n            var new_content = \"\";\n            for (var node_key in self.workflow.nodes) {\n                var node = self.workflow.nodes[node_key];\n                if ([\"tool\", \"subworkflow\"].indexOf(node.type) >= 0) {\n                    new_content += `<div class='toolForm' style='margin-bottom:5px;'><div class='toolFormTitle'>Step ${\n                        node.id\n                    } - ${node.name}</div>`;\n                    for (var ot_key in node.output_terminals) {\n                        var output = node.output_terminals[ot_key];\n                        if (node.isWorkflowOutput(output.name)) {\n                            new_content += `<p>${output.name}<input type='checkbox' name='${node.id}|${\n                                output.name\n                            }' checked /></p>`;\n                        } else {\n                            new_content += `<p>${output.name}<input type='checkbox' name='${node.id}|${\n                                output.name\n                            }' /></p>`;\n                        }\n                    }\n                    new_content += \"</div>\";\n                }\n            }\n            $(\"#output-fill-area\").html(new_content);\n            $(\"#output-fill-area input\").bind(\"click\", function() {\n                var node_id = this.name.split(\"|\")[0];\n                var workflowNode = this.workflow.nodes[node_id];\n                var output_name = this.name.split(\"|\")[1];\n                if (this.checked) {\n                    workflowNode.addWorkflowOutput(output_name);\n                } else {\n                    workflowNode.removeWorkflowOutput(output_name);\n                }\n                self.workflow.has_changes = true;\n            });\n            $(\"#workflow-output-area\").show();\n        }\n\n        function layout_editor() {\n            self.workflow.layout();\n            self.workflow.fit_canvas_to_nodes();\n            self.scroll_to_nodes();\n            self.canvas_manager.draw_overview();\n        }\n\n        // On load, set the size to the pref stored in local storage if it exists\n        var overview_size = $.jStorage.get(\"overview-size\");\n        if (overview_size !== undefined) {\n            $(\"#overview-border\").css({\n                width: overview_size,\n                height: overview_size\n            });\n        }\n\n        // Show viewport on load unless pref says it's off\n        if ($.jStorage.get(\"overview-off\")) {\n            hide_overview();\n        } else {\n            show_overview();\n        }\n\n        // Stores the size of the overview into local storage when it's resized\n        $(\"#overview-border\").bind(\"dragend\", function(e, d) {\n            var op = $(this).offsetParent();\n            var opo = op.offset();\n            var new_size = Math.max(op.width() - (d.offsetX - opo.left), op.height() - (d.offsetY - opo.top));\n            $.jStorage.set(\"overview-size\", `${new_size}px`);\n        });\n\n        function show_overview() {\n            $.jStorage.set(\"overview-off\", false);\n            $(\"#overview-border\").css(\"right\", \"0px\");\n            $(\"#close-viewport\").css(\"background-position\", \"0px 0px\");\n        }\n\n        function hide_overview() {\n            $.jStorage.set(\"overview-off\", true);\n            $(\"#overview-border\").css(\"right\", \"20000px\");\n            $(\"#close-viewport\").css(\"background-position\", \"12px 0px\");\n        }\n\n        // Lets the overview be toggled visible and invisible, adjusting the arrows accordingly\n        $(\"#close-viewport\").click(() => {\n            if ($(\"#overview-border\").css(\"right\") === \"0px\") {\n                hide_overview();\n            } else {\n                show_overview();\n            }\n        });\n\n        // Unload handler\n        window.onbeforeunload = () => {\n            if (workflow && self.workflow.has_changes) {\n                return \"There are unsaved changes to your workflow which will be lost.\";\n            }\n        };\n\n        this.options.workflows.length > 0 &&\n            $(\"#left\")\n                .find(\".toolMenu\")\n                .append(this._buildToolPanelWorkflows());\n\n        // Tool menu\n        $(\"div.toolSectionBody\").hide();\n        $(\"div.toolSectionTitle > span\").wrap(\"<a href='#'></a>\");\n        var last_expanded = null;\n        $(\"div.toolSectionTitle\").each(function() {\n            var body = $(this).next(\"div.toolSectionBody\");\n            $(this).click(() => {\n                if (body.is(\":hidden\")) {\n                    if (last_expanded) last_expanded.slideUp(\"fast\");\n                    last_expanded = body;\n                    body.slideDown(\"fast\");\n                } else {\n                    body.slideUp(\"fast\");\n                    last_expanded = null;\n                }\n            });\n        });\n\n        // Rename async.\n        async_save_text(\"workflow-name\", \"workflow-name\", self.urls.rename_async, \"new_name\");\n\n        // Tag async. Simply have the workflow edit element generate a click on the tag element to activate tagging.\n        $(\"#workflow-tag\").click(() => {\n            $(\".tag-area\").click();\n            return false;\n        });\n        // Annotate async.\n        async_save_text(\n            \"workflow-annotation\",\n            \"workflow-annotation\",\n            self.urls.annotate_async,\n            \"new_annotation\",\n            25,\n            true,\n            4\n        );\n    },\n\n    _buildToolPanelWorkflows: function() {\n        var self = this;\n        var $section = $(\n            '<div class=\"toolSectionWrapper\">' +\n                '<div class=\"toolSectionTitle\">' +\n                '<a href=\"#\"><span>Workflows</span></a>' +\n                \"</div>\" +\n                '<div class=\"toolSectionBody\">' +\n                '<div class=\"toolSectionBg\"/>' +\n                \"</div>\" +\n                \"</div>\"\n        );\n        _.each(this.options.workflows, workflow => {\n            if (workflow.id !== self.options.id) {\n                var copy = new Ui.ButtonIcon({\n                    icon: \"fa fa-copy\",\n                    cls: \"ui-button-icon-plain\",\n                    tooltip: _l(\"Copy and insert individual steps\"),\n                    onclick: function() {\n                        if (workflow.step_count < 2) {\n                            self.copy_into_workflow(workflow.id, workflow.name);\n                        } else {\n                            // don't ruin the workflow by adding 50 steps unprompted.\n                            Galaxy.modal.show({\n                                title: _l(\"Warning\"),\n                                body: `This will copy ${workflow.step_count} new steps into your workflow.`,\n                                buttons: {\n                                    Cancel: function() {\n                                        Galaxy.modal.hide();\n                                    },\n                                    Copy: function() {\n                                        Galaxy.modal.hide();\n                                        self.copy_into_workflow(workflow.id, workflow.name);\n                                    }\n                                }\n                            });\n                        }\n                    }\n                });\n                var $add = $(\"<a/>\")\n                    .attr(\"href\", \"#\")\n                    .html(workflow.name)\n                    .on(\"click\", () => {\n                        self.add_node_for_subworkflow(workflow.latest_id, workflow.name);\n                    });\n                $section.find(\".toolSectionBg\").append(\n                    $(\"<div/>\")\n                        .addClass(\"toolTitle\")\n                        .append($add)\n                        .append(copy.$el)\n                );\n            }\n        });\n        return $section;\n    },\n\n    copy_into_workflow: function(workflowId) {\n        // Load workflow definition\n        var self = this;\n        this._workflowLoadAjax(workflowId, {\n            success: function(data) {\n                self.workflow.from_simple(data, false);\n                // Determine if any parameters were 'upgraded' and provide message\n                var upgrade_message = \"\";\n                $.each(data.upgrade_messages, (k, v) => {\n                    upgrade_message += `<li>Step ${parseInt(k, 10) + 1}: ${self.workflow.nodes[k].name}<ul>`;\n                    $.each(v, (i, vv) => {\n                        upgrade_message += `<li>${vv}</li>`;\n                    });\n                    upgrade_message += \"</ul></li>\";\n                });\n                if (upgrade_message) {\n                    window.show_modal(\n                        \"Subworkflow embedded with changes\",\n                        `Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>${upgrade_message}</ul>`,\n                        { Continue: hide_modal }\n                    );\n                } else {\n                    hide_modal();\n                }\n            },\n            beforeSubmit: function(data) {\n                show_message(\"Importing workflow\", \"progress\");\n            }\n        });\n    },\n\n    // Global state for the whole workflow\n    reset: function() {\n        this.workflow && this.workflow.remove_all();\n        this.workflow = window.workflow_globals.workflow = new Workflow(this, $(\"#canvas-container\"));\n    },\n\n    scroll_to_nodes: function() {\n        var cv = $(\"#canvas-viewport\");\n        var cc = $(\"#canvas-container\");\n        var top;\n        var left;\n        if (cc.width() < cv.width()) {\n            left = (cv.width() - cc.width()) / 2;\n        } else {\n            left = 0;\n        }\n        if (cc.height() < cv.height()) {\n            top = (cv.height() - cc.height()) / 2;\n        } else {\n            top = 0;\n        }\n        cc.css({ left: left, top: top });\n    },\n\n    _workflowLoadAjax: function(workflowId, options) {\n        $.ajax(\n            Utils.merge(options, {\n                url: this.urls.load_workflow,\n                data: { id: workflowId, _: \"true\" },\n                dataType: \"json\",\n                cache: false\n            })\n        );\n    },\n\n    _moduleInitAjax: function(node, request_data) {\n        var self = this;\n        Utils.request({\n            type: \"POST\",\n            url: `${Galaxy.root}api/workflows/build_module`,\n            data: request_data,\n            success: function(data) {\n                node.init_field_data(data);\n                node.update_field_data(data);\n                self.workflow.activate_node(node);\n            }\n        });\n    },\n\n    // Add a new step to the workflow by tool id\n    add_node_for_tool: function(id, title) {\n        var node = this.workflow.create_node(\"tool\", title, id);\n        this._moduleInitAjax(node, {\n            type: \"tool\",\n            tool_id: id,\n            _: \"true\"\n        });\n    },\n\n    // Add a new step to the workflow by tool id\n    add_node_for_subworkflow: function(id, title) {\n        var node = this.workflow.create_node(\"subworkflow\", title, id);\n        this._moduleInitAjax(node, {\n            type: \"subworkflow\",\n            content_id: id,\n            _: \"true\"\n        });\n    },\n\n    add_node_for_module: function(type, title) {\n        var node = this.workflow.create_node(type, title);\n        this._moduleInitAjax(node, { type: type, _: \"true\" });\n    },\n\n    display_file_list: function(node) {\n        var addlist = \"<select id='node_data_list' name='node_data_list'>\";\n        for (var out_terminal in node.output_terminals) {\n            addlist += `<option value='${out_terminal}'>${out_terminal}</option>`;\n        }\n        addlist += \"</select>\";\n        return addlist;\n    },\n\n    showWorkflowParameters: function() {\n        var parameter_re = /\\$\\{.+?\\}/g;\n        var workflow_parameters = [];\n        var wf_parm_container = $(\"#workflow-parameters-container\");\n        var wf_parm_box = $(\"#workflow-parameters-box\");\n        var new_parameter_content = \"\";\n        var matches = [];\n        $.each(this.workflow.nodes, (k, node) => {\n            if (node.config_form && node.config_form.inputs) {\n                Utils.deepeach(node.config_form.inputs, d => {\n                    if (typeof d.value == \"string\") {\n                        var form_matches = d.value.match(parameter_re);\n                        if (form_matches) {\n                            matches = matches.concat(form_matches);\n                        }\n                    }\n                });\n            }\n            if (node.post_job_actions) {\n                $.each(node.post_job_actions, (k, pja) => {\n                    if (pja.action_arguments) {\n                        $.each(pja.action_arguments, (k, action_argument) => {\n                            var arg_matches = action_argument.match(parameter_re);\n                            if (arg_matches) {\n                                matches = matches.concat(arg_matches);\n                            }\n                        });\n                    }\n                });\n            }\n            if (matches) {\n                $.each(matches, (k, element) => {\n                    if ($.inArray(element, workflow_parameters) === -1) {\n                        workflow_parameters.push(element);\n                    }\n                });\n            }\n        });\n        if (workflow_parameters && workflow_parameters.length !== 0) {\n            $.each(workflow_parameters, (k, element) => {\n                new_parameter_content += `<div>${element.substring(2, element.length - 1)}</div>`;\n            });\n            wf_parm_container.html(new_parameter_content);\n            wf_parm_box.show();\n        } else {\n            wf_parm_container.html(new_parameter_content);\n            wf_parm_box.hide();\n        }\n    },\n\n    showAttributes: function() {\n        $(\".right-content\").hide();\n        $(\"#edit-attributes\").show();\n    },\n\n    showForm: function(content, node) {\n        var self = this;\n        var cls = \"right-content\";\n        var id = `${cls}-${node.id}`;\n        var $container = $(`#${cls}`);\n        if (content && $container.find(`#${id}`).length == 0) {\n            var $el = $(`<div id=\"${id}\" class=\"${cls}\"/>`);\n            content.node = node;\n            content.workflow = this.workflow;\n            content.datatypes = this.datatypes;\n            content.icon = WorkflowIcons[node.type];\n            content.cls = \"ui-portlet-narrow\";\n            if (node) {\n                var form_type = node.type == \"tool\" ? \"Tool\" : \"Default\";\n                $el.append(new FormWrappers[form_type](content).form.$el);\n                $container.append($el);\n            } else {\n                Galaxy.emit.debug(\"workflow-view::initialize()\", \"Node not found in workflow.\");\n            }\n        }\n        $(`.${cls}`).hide();\n        $container.find(`#${id}`).show();\n        $container.show();\n        $container.scrollTop();\n    },\n\n    isSubType: function(child, parent) {\n        child = this.ext_to_type[child];\n        parent = this.ext_to_type[parent];\n        return this.type_to_type[child] && parent in this.type_to_type[child];\n    },\n\n    prebuildNode: function(type, title_text, content_id) {\n        var self = this;\n        var $f = $(\"<div class='toolForm toolFormInCanvas'/>\");\n        var $title = $(`<div class='toolFormTitle unselectable'><span class='nodeTitle'>${title_text}</div></div>`);\n        add_node_icon($title.find(\".nodeTitle\"), type);\n        $f.append($title);\n        $f.css(\"left\", $(window).scrollLeft() + 20);\n        $f.css(\"top\", $(window).scrollTop() + 20);\n        $f.append($(\"<div class='toolFormBody'></div>\"));\n        var node = new Node(this, { element: $f });\n        node.type = type;\n        node.content_id = content_id;\n        var tmp = `<div><img height='16' align='middle' src='${\n            Galaxy.root\n        }static/images/loading_small_white_bg.gif'/> loading tool info...</div>`;\n        $f.find(\".toolFormBody\").append(tmp);\n        // Fix width to computed width\n        // Now add floats\n        var buttons = $(\"<div class='buttons' style='float: right;'></div>\");\n        if (type !== \"subworkflow\") {\n            buttons.append(\n                $(\"<div/>\")\n                    .addClass(\"fa-icon-button fa fa-files-o\")\n                    .click(e => {\n                        node.clone();\n                    })\n            );\n        }\n        buttons.append(\n            $(\"<div/>\")\n                .addClass(\"fa-icon-button fa fa-times\")\n                .click(e => {\n                    node.destroy();\n                })\n        );\n        // Place inside container\n        $f.appendTo(\"#canvas-container\");\n        // Position in container\n        var o = $(\"#canvas-container\").position();\n        var p = $(\"#canvas-container\").parent();\n        var width = $f.width();\n        var height = $f.height();\n        $f.css({\n            left: -o.left + p.width() / 2 - width / 2,\n            top: -o.top + p.height() / 2 - height / 2\n        });\n        buttons.prependTo($f.find(\".toolFormTitle\"));\n        width += buttons.width() + 10;\n        $f.css(\"width\", width);\n        $f\n            .bind(\"dragstart\", () => {\n                self.workflow.activate_node(node);\n            })\n            .bind(\"dragend\", function() {\n                self.workflow.node_changed(this);\n                self.workflow.fit_canvas_to_nodes();\n                self.canvas_manager.draw_overview();\n            })\n            .bind(\"dragclickonly\", () => {\n                self.workflow.activate_node(node);\n            })\n            .bind(\"drag\", function(e, d) {\n                // Move\n                var po = $(this)\n                    .offsetParent()\n                    .offset();\n\n                var x = d.offsetX - po.left;\n                var y = d.offsetY - po.top;\n                $(this).css({ left: x, top: y });\n                // Redraw\n                $(this)\n                    .find(\".terminal\")\n                    .each(function() {\n                        this.terminal.redraw();\n                    });\n            });\n        return node;\n    }\n});\n"]}
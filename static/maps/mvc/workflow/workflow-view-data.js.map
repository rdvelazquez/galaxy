{"version":3,"sources":["mvc/workflow/workflow-view-data.js"],"names":["window","workflow_globals","DataInputView","Backbone","View","extend","className","initialize","options","input","nodeView","terminalElement","$el","attr","name","html","label","skipResize","css","position","left","top","display","$","append","el","updateMaxWidth","outerWidth","remove","DataOutputView","output","node","isInput","extensions","indexOf","join","calloutView","type","OutputCalloutView","hover","hoverImage","resetImage","detach","redrawWorkflowOutput","tagName","view","Galaxy","root","click","outputName","isWorkflowOutput","removeWorkflowOutput","addWorkflowOutput","workflow","has_changes","canvas_manager","draw_overview","tooltip","delay","title","margin","right","show"],"mappings":"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","file":"../../../scripts/mvc/workflow/workflow-view-data.js","sourcesContent":["// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\nvar DataInputView = Backbone.View.extend({\n    className: \"form-row dataRow input-data-row\",\n\n    initialize: function(options) {\n        this.input = options.input;\n        this.nodeView = options.nodeView;\n        this.terminalElement = options.terminalElement;\n\n        this.$el.attr(\"name\", this.input.name).html(this.input.label);\n\n        if (!options.skipResize) {\n            this.$el.css({\n                position: \"absolute\",\n                left: -1000,\n                top: -1000,\n                display: \"none\"\n            });\n            $(\"body\").append(this.el);\n            this.nodeView.updateMaxWidth(this.$el.outerWidth());\n            this.$el.css({\n                position: \"\",\n                left: \"\",\n                top: \"\",\n                display: \"\"\n            });\n            this.$el.remove();\n        }\n    }\n});\n\nvar DataOutputView = Backbone.View.extend({\n    className: \"form-row dataRow\",\n\n    initialize: function(options) {\n        this.output = options.output;\n        this.terminalElement = options.terminalElement;\n        this.nodeView = options.nodeView;\n\n        var output = this.output;\n        var label = output.name;\n        var node = this.nodeView.node;\n\n        var isInput = output.extensions.indexOf(\"input\") >= 0 || output.extensions.indexOf(\"input_collection\") >= 0;\n        if (!isInput) {\n            label = `${label} (${output.extensions.join(\", \")})`;\n        }\n        this.$el.html(label);\n        this.calloutView = null;\n        if ([\"tool\", \"subworkflow\"].indexOf(node.type) >= 0) {\n            var calloutView = new OutputCalloutView({\n                label: label,\n                output: output,\n                node: node\n            });\n            this.calloutView = calloutView;\n            this.$el.append(calloutView.el);\n            this.$el.hover(\n                () => {\n                    calloutView.hoverImage();\n                },\n                () => {\n                    calloutView.resetImage();\n                }\n            );\n        }\n        this.$el.css({\n            position: \"absolute\",\n            left: -1000,\n            top: -1000,\n            display: \"none\"\n        });\n        $(\"body\").append(this.el);\n        this.nodeView.updateMaxWidth(this.$el.outerWidth() + 17);\n        this.$el\n            .css({\n                position: \"\",\n                left: \"\",\n                top: \"\",\n                display: \"\"\n            })\n            .detach();\n    },\n    redrawWorkflowOutput: function() {\n        if (this.calloutView) {\n            this.calloutView.resetImage();\n        }\n    }\n});\n\nvar OutputCalloutView = Backbone.View.extend({\n    tagName: \"div\",\n\n    initialize: function(options) {\n        this.label = options.label;\n        this.node = options.node;\n        this.output = options.output;\n\n        var view = this;\n        var node = this.node;\n        this.$el\n            .attr(\"class\", `callout ${this.label}`)\n            .css({ display: \"none\" })\n            .append(\n                $(\"<div class='buttons'></div>\").append(\n                    $(\"<img/>\")\n                        .attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small-outline.png`)\n                        .click(() => {\n                            var outputName = view.output.name;\n                            if (node.isWorkflowOutput(outputName)) {\n                                node.removeWorkflowOutput(outputName);\n                                view\n                                    .$(\"img\")\n                                    .attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small-outline.png`);\n                            } else {\n                                node.addWorkflowOutput(outputName);\n                                view.$(\"img\").attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small.png`);\n                            }\n                            window.workflow_globals.workflow.has_changes = true;\n                            window.workflow_globals.canvas_manager.draw_overview();\n                        })\n                )\n            )\n            .tooltip({\n                delay: 500,\n                title: \"Mark dataset as a workflow output. All unmarked datasets will be hidden.\"\n            });\n\n        this.$el.css({\n            top: \"50%\",\n            margin: \"-8px 0px 0px 0px\",\n            right: 8\n        });\n        this.$el.show();\n        this.resetImage();\n    },\n\n    resetImage: function() {\n        if (!this.node.isWorkflowOutput(this.output.name)) {\n            this.$(\"img\").attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small-outline.png`);\n        } else {\n            this.$(\"img\").attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small.png`);\n        }\n    },\n\n    hoverImage: function() {\n        this.$(\"img\").attr(\"src\", `${Galaxy.root}static/images/fugue/asterisk-small-yellow.png`);\n    }\n});\n\nexport default {\n    DataInputView: DataInputView,\n    DataOutputView: DataOutputView\n};\n"]}
{"version":3,"sources":["mvc/workflow/workflow-view-terminals.js"],"names":["window","workflow_globals","TerminalMappingView","Backbone","View","extend","tagName","className","initialize","options","mapText","$el","tooltip","delay","title","model","bind","_","render","mapOver","isCollection","show","hide","InputTerminalMappingView","events","click","mouseenter","mouseleave","onMouseEnter","e","terminal","connected","css","onMouseLeave","onClick","resetMapping","TerminalView","setupMappingView","terminalMapping","terminalMappingClass","terminalMappingView","terminalMappingViewClass","terminalElements","el","BaseInputTerminalView","node","input","name","terminalForInput","multiple","input_terminals","dropinit","dropstart","dropend","drop","hover","onDropInit","d","$","drag","hasClass","canAccept","onDropStart","proxy","connectors","inner_color","onDropEnd","onDrop","redraw","onHover","element","length","t","display","appendTo","append","addClass","each","x","destroy","remove","top","offset","left","width","InputTerminalView","TerminalMapping","InputTerminal","InputCollectionTerminalView","InputCollectionTerminal","BaseOutputTerminalView","output","terminalForOutput","output_terminals","dragstart","dragend","onDrag","onmove","po","offsetParent","offsetX","y","offsetY","canvas_manager","update_viewport_overlay","get","scroll_panel","test","onDragStart","available","workflow","check_changes_in_active_form","h","OutputTerminal","c","dragging","connect","onDragEnd","connector","removeClass","stop","OutputTerminalView","type","extensions","datatypes","OutputCollectionTerminalView","collection_type","collection_type_source","OutputCollectionTerminal"],"mappings":"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","file":"../../../scripts/mvc/workflow/workflow-view-terminals.js","sourcesContent":["import Terminals from \"mvc/workflow/workflow-terminals\";\nimport Connector from \"mvc/workflow/workflow-connector\";\n\n// TODO; tie into Galaxy state?\nwindow.workflow_globals = window.workflow_globals || {};\n\nvar TerminalMappingView = Backbone.View.extend({\n    tagName: \"div\",\n    className: \"fa-icon-button fa fa-folder-o\",\n    initialize: function(options) {\n        var mapText = \"Run tool in parallel over collection\";\n        this.$el.tooltip({ delay: 500, title: mapText });\n        this.model.bind(\"change\", _.bind(this.render, this));\n    },\n    render: function() {\n        if (this.model.mapOver.isCollection) {\n            this.$el.show();\n        } else {\n            this.$el.hide();\n        }\n    }\n});\n\nvar InputTerminalMappingView = TerminalMappingView.extend({\n    events: {\n        click: \"onClick\",\n        mouseenter: \"onMouseEnter\",\n        mouseleave: \"onMouseLeave\"\n    },\n    onMouseEnter: function(e) {\n        var model = this.model;\n        if (!model.terminal.connected() && model.mapOver.isCollection) {\n            this.$el.css(\"color\", \"red\");\n        }\n    },\n    onMouseLeave: function(e) {\n        this.$el.css(\"color\", \"black\");\n    },\n    onClick: function(e) {\n        var model = this.model;\n        if (!model.terminal.connected() && model.mapOver.isCollection) {\n            // TODO: Consider prompting...\n            model.terminal.resetMapping();\n        }\n    }\n});\n\nvar TerminalView = Backbone.View.extend({\n    setupMappingView: function(terminal) {\n        var terminalMapping = new this.terminalMappingClass({\n            terminal: terminal\n        });\n        var terminalMappingView = new this.terminalMappingViewClass({\n            model: terminalMapping\n        });\n        terminalMappingView.render();\n        terminal.terminalMappingView = terminalMappingView;\n        this.terminalMappingView = terminalMappingView;\n    },\n    terminalElements: function() {\n        if (this.terminalMappingView) {\n            return [this.terminalMappingView.el, this.el];\n        } else {\n            return [this.el];\n        }\n    }\n});\n\nvar BaseInputTerminalView = TerminalView.extend({\n    className: \"terminal input-terminal\",\n    initialize: function(options) {\n        var node = options.node;\n        var input = options.input;\n        var name = input.name;\n        var terminal = this.terminalForInput(input);\n        if (!terminal.multiple) {\n            this.setupMappingView(terminal);\n        }\n        this.el.terminal = terminal;\n        terminal.node = node;\n        terminal.name = name;\n        node.input_terminals[name] = terminal;\n    },\n    events: {\n        dropinit: \"onDropInit\",\n        dropstart: \"onDropStart\",\n        dropend: \"onDropEnd\",\n        drop: \"onDrop\",\n        hover: \"onHover\"\n    },\n    onDropInit: function(e, d) {\n        var terminal = this.el.terminal;\n        // Accept a dragable if it is an output terminal and has a\n        // compatible type\n        return $(d.drag).hasClass(\"output-terminal\") && terminal.canAccept(d.drag.terminal);\n    },\n    onDropStart: function(e, d) {\n        if (d.proxy.terminal) {\n            d.proxy.terminal.connectors[0].inner_color = \"#BBFFBB\";\n        }\n    },\n    onDropEnd: function(e, d) {\n        if (d.proxy.terminal) {\n            d.proxy.terminal.connectors[0].inner_color = \"#FFFFFF\";\n        }\n    },\n    onDrop: function(e, d) {\n        var terminal = this.el.terminal;\n        new Connector(d.drag.terminal, terminal).redraw();\n    },\n    onHover: function() {\n        var element = this.el;\n        var terminal = element.terminal;\n        // If connected, create a popup to allow disconnection\n        if (terminal.connectors.length > 0) {\n            // Create callout\n            var t = $(\"<div class='callout'></div>\")\n                .css({ display: \"none\" })\n                .appendTo(\"body\")\n                .append(\n                    $(\"<div class='button'></div>\").append(\n                        $(\"<div/>\")\n                            .addClass(\"fa-icon-button fa fa-times\")\n                            .click(() => {\n                                $.each(terminal.connectors, (_, x) => {\n                                    if (x) {\n                                        x.destroy();\n                                    }\n                                });\n                                t.remove();\n                            })\n                    )\n                )\n                .bind(\"mouseleave\", function() {\n                    $(this).remove();\n                });\n            // Position it and show\n            t\n                .css({\n                    top: $(element).offset().top - 2,\n                    left: $(element).offset().left - t.width(),\n                    \"padding-right\": $(element).width()\n                })\n                .show();\n        }\n    }\n});\n\nvar InputTerminalView = BaseInputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: InputTerminalMappingView,\n    terminalForInput: function(input) {\n        return new Terminals.InputTerminal({\n            element: this.el,\n            input: input\n        });\n    }\n});\n\nvar InputCollectionTerminalView = BaseInputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: InputTerminalMappingView,\n    terminalForInput: function(input) {\n        return new Terminals.InputCollectionTerminal({\n            element: this.el,\n            input: input\n        });\n    }\n});\n\nvar BaseOutputTerminalView = TerminalView.extend({\n    className: \"terminal output-terminal\",\n    initialize: function(options) {\n        var node = options.node;\n        var output = options.output;\n        var name = output.name;\n        var terminal = this.terminalForOutput(output);\n        this.setupMappingView(terminal);\n        this.el.terminal = terminal;\n        terminal.node = node;\n        terminal.name = name;\n        node.output_terminals[name] = terminal;\n    },\n    events: {\n        drag: \"onDrag\",\n        dragstart: \"onDragStart\",\n        dragend: \"onDragEnd\"\n    },\n    onDrag: function(e, d) {\n        var onmove = () => {\n            var po = $(d.proxy)\n                .offsetParent()\n                .offset();\n\n            var x = d.offsetX - po.left;\n            var y = d.offsetY - po.top;\n            $(d.proxy).css({ left: x, top: y });\n            d.proxy.terminal.redraw();\n            // FIXME: global\n            window.workflow_globals.canvas_manager.update_viewport_overlay();\n        };\n        onmove();\n        $(\"#canvas-container\")\n            .get(0)\n            .scroll_panel.test(e, onmove);\n    },\n    onDragStart: function(e, d) {\n        $(d.available).addClass(\"input-terminal-active\");\n        // Save PJAs in the case of change datatype actions.\n        window.workflow_globals.workflow.check_changes_in_active_form();\n        // Drag proxy div\n        var h = $('<div class=\"drag-terminal\" style=\"position: absolute;\"></div>')\n            .appendTo(\"#canvas-container\")\n            .get(0);\n        // Terminal and connection to display noodle while dragging\n        h.terminal = new Terminals.OutputTerminal({ element: h });\n        var c = new Connector();\n        c.dragging = true;\n        c.connect(this.el.terminal, h.terminal);\n        return h;\n    },\n    onDragEnd: function(e, d) {\n        var connector = d.proxy.terminal.connectors[0];\n        // check_changes_in_active_form may change the state and cause a\n        // the connection to have already been destroyed. There must be better\n        // ways to handle this but the following check fixes some serious GUI\n        // bugs for now.\n        if (connector) {\n            connector.destroy();\n        }\n        $(d.proxy).remove();\n        $(d.available).removeClass(\"input-terminal-active\");\n        $(\"#canvas-container\")\n            .get(0)\n            .scroll_panel.stop();\n    }\n});\n\nvar OutputTerminalView = BaseOutputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: TerminalMappingView,\n    terminalForOutput: function(output) {\n        var type = output.extensions;\n        var terminal = new Terminals.OutputTerminal({\n            element: this.el,\n            datatypes: type\n        });\n        return terminal;\n    }\n});\n\nvar OutputCollectionTerminalView = BaseOutputTerminalView.extend({\n    terminalMappingClass: Terminals.TerminalMapping,\n    terminalMappingViewClass: TerminalMappingView,\n    terminalForOutput: function(output) {\n        var collection_type = output.collection_type;\n        var collection_type_source = output.collection_type_source;\n        var terminal = new Terminals.OutputCollectionTerminal({\n            element: this.el,\n            collection_type: collection_type,\n            collection_type_source: collection_type_source,\n            datatypes: output.extensions\n        });\n        return terminal;\n    }\n});\n\nexport default {\n    InputTerminalView: InputTerminalView,\n    OutputTerminalView: OutputTerminalView,\n    InputCollectionTerminalView: InputCollectionTerminalView,\n    OutputCollectionTerminalView: OutputCollectionTerminalView\n};\n"]}
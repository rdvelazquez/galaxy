{"version":3,"sources":["mvc/workflow/workflow-canvas.js"],"names":["CanvasManager","app","canvas_viewport","overview","cv","cc","find","oc","ov","init_drag","init_copy_paste","$","extend","prototype","self","move","x","y","Math","min","width","max","height","css","left","top","update_viewport_overlay","each","scroll_panel","ScrollPanel","x_adjust","y_adjust","bind","document","activeElement","blur","o","offset","p","position","e","d","offsetX","offsetY","workflow","fit_canvas_to_nodes","draw_overview","click","hasClass","removeClass","in_w","in_h","o_w","o_h","new_x_offset","pageX","new_y_offset","pageY","addClass","op","offsetParent","opo","new_size","addEventListener","window","getSelection","toString","active_node","type","clipboardData","setData","JSON","stringify","nodeId","id","preventDefault","parse","getData","error","nodes","hasOwnProperty","clone","cc_pos","canvas_el","size","parent","c","get","getContext","shift_h","shift_w","cv_w","cv_h","ceil","attr","node","fillStyle","strokeStyle","lineWidth","node_element","element","w","h","errors","workflow_outputs","undefined","length","fillRect","strokeRect","panel","test","onmove","clearTimeout","timeout","panel_pos","panel_w","panel_h","viewport","viewport_w","viewport_h","viewport_offset","min_x","min_y","max_x","max_y","p_min_x","p_min_y","p_max_x","p_max_y","moved","close_dist","nudge","t","setTimeout","stop"],"mappings":"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","file":"../../../scripts/mvc/workflow/workflow-canvas.js","sourcesContent":["function CanvasManager(app, canvas_viewport, overview) {\n    this.app = app;\n    this.cv = canvas_viewport;\n    this.cc = this.cv.find(\"#canvas-container\");\n    this.overview = overview;\n    this.oc = overview.find(\"#overview-canvas\");\n    this.ov = overview.find(\"#overview-viewport\");\n    // Make overview box draggable\n    this.init_drag();\n    // Initialize Copy & Paste events\n    this.init_copy_paste();\n}\n$.extend(CanvasManager.prototype, {\n    init_drag: function() {\n        var self = this;\n        var move = (x, y) => {\n            x = Math.min(x, self.cv.width() / 2);\n            x = Math.max(x, -self.cc.width() + self.cv.width() / 2);\n            y = Math.min(y, self.cv.height() / 2);\n            y = Math.max(y, -self.cc.height() + self.cv.height() / 2);\n            self.cc.css({\n                left: x,\n                top: y\n            });\n            self.cv.css({\n                \"background-position-x\": x,\n                \"background-position-y\": y\n            });\n            self.update_viewport_overlay();\n        };\n        // Dragging within canvas background\n        this.cc.each(function() {\n            this.scroll_panel = new ScrollPanel(this);\n        });\n        var x_adjust;\n        var y_adjust;\n        this.cv\n            .bind(\"click\", function() {\n                document.activeElement.blur();\n            })\n            .bind(\"dragstart\", function() {\n                var o = $(this).offset();\n                var p = self.cc.position();\n                y_adjust = p.top - o.top;\n                x_adjust = p.left - o.left;\n            })\n            .bind(\"drag\", (e, d) => {\n                move(d.offsetX + x_adjust, d.offsetY + y_adjust);\n            })\n            .bind(\"dragend\", () => {\n                self.app.workflow.fit_canvas_to_nodes();\n                self.draw_overview();\n            });\n        this.overview.click(e => {\n            if (self.overview.hasClass(\"blockaclick\")) {\n                self.overview.removeClass(\"blockaclick\");\n            } else {\n                var in_w = self.cc.width();\n                var in_h = self.cc.height();\n                var o_w = self.oc.width();\n                var o_h = self.oc.height();\n\n                var new_x_offset = e.pageX - self.oc.offset().left - self.ov.width() / 2;\n\n                var new_y_offset = e.pageY - self.oc.offset().top - self.ov.height() / 2;\n\n                move(-(new_x_offset / o_w * in_w), -(new_y_offset / o_h * in_h));\n                self.app.workflow.fit_canvas_to_nodes();\n                self.draw_overview();\n            }\n        });\n        // Dragging for overview pane\n        this.ov\n            .bind(\"drag\", (e, d) => {\n                var in_w = self.cc.width();\n                var in_h = self.cc.height();\n                var o_w = self.oc.width();\n                var o_h = self.oc.height();\n                var new_x_offset = d.offsetX - self.overview.offset().left;\n                var new_y_offset = d.offsetY - self.overview.offset().top;\n                move(-(new_x_offset / o_w * in_w), -(new_y_offset / o_h * in_h));\n            })\n            .bind(\"dragend\", () => {\n                self.overview.addClass(\"blockaclick\");\n                self.app.workflow.fit_canvas_to_nodes();\n                self.draw_overview();\n            });\n        // Dragging for overview border (resize)\n        $(\"#overview-border\").bind(\"drag\", function(e, d) {\n            var op = $(this).offsetParent();\n            var opo = op.offset();\n            var new_size = Math.max(op.width() - (d.offsetX - opo.left), op.height() - (d.offsetY - opo.top));\n            $(this).css({\n                width: new_size,\n                height: new_size\n            });\n            self.draw_overview();\n        });\n\n        /*  Disable dragging for child element of the panel so that resizing can\n                only be done by dragging the borders */\n        $(\"#overview-border div\").bind(\"drag\", () => {});\n    },\n    init_copy_paste: function() {\n        document.addEventListener(\"copy\", e => {\n            // If it appears that the user is trying to copy/paste text, we\n            // pass that through.\n            if (window.getSelection().toString() === \"\") {\n                if (this.app.workflow.active_node && this.app.workflow.active_node.type !== \"subworkflow\") {\n                    e.clipboardData.setData(\n                        \"application/json\",\n                        JSON.stringify({\n                            nodeId: this.app.workflow.active_node.id\n                        })\n                    );\n                }\n                e.preventDefault();\n            }\n        });\n\n        document.addEventListener(\"paste\", e => {\n            // If it appears that the user is trying to paste into a text box,\n            // pass that through and skip the workflow copy/paste logic.\n            if (\n                document.activeElement &&\n                document.activeElement.type !== \"textarea\" &&\n                document.activeElement.type !== \"text\"\n            ) {\n                var nodeId;\n                try {\n                    nodeId = JSON.parse(e.clipboardData.getData(\"application/json\")).nodeId;\n                } catch (error) {}\n                if (nodeId && this.app.workflow.nodes.hasOwnProperty(nodeId)) {\n                    this.app.workflow.nodes[nodeId].clone();\n                }\n                e.preventDefault();\n            }\n        });\n    },\n    update_viewport_overlay: function() {\n        var cc = this.cc;\n        var cv = this.cv;\n        var oc = this.oc;\n        var ov = this.ov;\n        var in_w = cc.width();\n        var in_h = cc.height();\n        var o_w = oc.width();\n        var o_h = oc.height();\n        var cc_pos = cc.position();\n        ov.css({\n            left: -(cc_pos.left / in_w * o_w),\n            top: -(cc_pos.top / in_h * o_h),\n            // Subtract 2 to account for borders (maybe just change box sizing style instead?)\n            width: cv.width() / in_w * o_w - 2,\n            height: cv.height() / in_h * o_h - 2\n        });\n    },\n    draw_overview: function() {\n        var canvas_el = $(\"#overview-canvas\");\n\n        var size = canvas_el\n            .parent()\n            .parent()\n            .width();\n\n        var c = canvas_el.get(0).getContext(\"2d\");\n        var in_w = $(\"#canvas-container\").width();\n        var in_h = $(\"#canvas-container\").height();\n        var o_h;\n        var shift_h;\n        var o_w;\n        var shift_w;\n        // Fit canvas into overview area\n        var cv_w = this.cv.width();\n        var cv_h = this.cv.height();\n        if (in_w < cv_w && in_h < cv_h) {\n            // Canvas is smaller than viewport\n            o_w = in_w / cv_w * size;\n            shift_w = (size - o_w) / 2;\n            o_h = in_h / cv_h * size;\n            shift_h = (size - o_h) / 2;\n        } else if (in_w < in_h) {\n            // Taller than wide\n            shift_h = 0;\n            o_h = size;\n            o_w = Math.ceil(o_h * in_w / in_h);\n            shift_w = (size - o_w) / 2;\n        } else {\n            // Wider than tall\n            o_w = size;\n            shift_w = 0;\n            o_h = Math.ceil(o_w * in_h / in_w);\n            shift_h = (size - o_h) / 2;\n        }\n        canvas_el.parent().css({\n            left: shift_w,\n            top: shift_h,\n            width: o_w,\n            height: o_h\n        });\n        canvas_el.attr(\"width\", o_w);\n        canvas_el.attr(\"height\", o_h);\n        // Draw overview\n        $.each(this.app.workflow.nodes, (id, node) => {\n            c.fillStyle = \"#D2C099\";\n            c.strokeStyle = \"#D8B365\";\n            c.lineWidth = 1;\n            var node_element = $(node.element);\n            var position = node_element.position();\n            var x = position.left / in_w * o_w;\n            var y = position.top / in_h * o_h;\n            var w = node_element.width() / in_w * o_w;\n            var h = node_element.height() / in_h * o_h;\n            if (node.errors) {\n                c.fillStyle = \"#FFCCCC\";\n                c.strokeStyle = \"#AA6666\";\n            } else if (node.workflow_outputs !== undefined && node.workflow_outputs.length > 0) {\n                c.fillStyle = \"#E8A92D\";\n                c.strokeStyle = \"#E8A92D\";\n            }\n            c.fillRect(x, y, w, h);\n            c.strokeRect(x, y, w, h);\n        });\n        this.update_viewport_overlay();\n    }\n});\n\n// FIXME: merge scroll panel into CanvasManager, clean up hardcoded stuff.\nfunction ScrollPanel(panel) {\n    this.panel = panel;\n}\n$.extend(ScrollPanel.prototype, {\n    test: function(e, onmove) {\n        clearTimeout(this.timeout);\n        var x = e.pageX;\n        var y = e.pageY;\n\n        var // Panel size and position\n        panel = $(this.panel);\n\n        var panel_pos = panel.position();\n        var panel_w = panel.width();\n        var panel_h = panel.height();\n\n        var // Viewport size and offset\n        viewport = panel.parent();\n\n        var viewport_w = viewport.width();\n        var viewport_h = viewport.height();\n        var viewport_offset = viewport.offset();\n\n        var // Edges of viewport (in page coordinates)\n        min_x = viewport_offset.left;\n\n        var min_y = viewport_offset.top;\n        var max_x = min_x + viewport.width();\n        var max_y = min_y + viewport.height();\n\n        var // Legal panel range\n        p_min_x = -(panel_w - viewport_w / 2);\n\n        var p_min_y = -(panel_h - viewport_h / 2);\n        var p_max_x = viewport_w / 2;\n        var p_max_y = viewport_h / 2;\n\n        var // Did the panel move?\n        moved = false;\n\n        var // Constants\n        close_dist = 5;\n\n        var nudge = 23;\n        var t = 0;\n        if (x - close_dist < min_x) {\n            if (panel_pos.left < p_max_x) {\n                t = Math.min(nudge, p_max_x - panel_pos.left);\n                panel.css(\"left\", panel_pos.left + t);\n                moved = true;\n            }\n        } else if (x + close_dist > max_x) {\n            if (panel_pos.left > p_min_x) {\n                t = Math.min(nudge, panel_pos.left - p_min_x);\n                panel.css(\"left\", panel_pos.left - t);\n                moved = true;\n            }\n        } else if (y - close_dist < min_y) {\n            if (panel_pos.top < p_max_y) {\n                t = Math.min(nudge, p_max_y - panel_pos.top);\n                panel.css(\"top\", panel_pos.top + t);\n                moved = true;\n            }\n        } else if (y + close_dist > max_y) {\n            if (panel_pos.top > p_min_y) {\n                t = Math.min(nudge, panel_pos.top - p_min_x);\n                panel.css(\"top\", `${panel_pos.top - t}px`);\n                moved = true;\n            }\n        }\n        if (moved) {\n            // Keep moving even if mouse doesn't move\n            onmove();\n            this.timeout = setTimeout(() => {\n                this.test(e, onmove);\n            }, 50);\n        }\n    },\n    stop: function() {\n        clearTimeout(this.timeout);\n    }\n});\nexport default CanvasManager;\n"]}
{"version":3,"sources":["mvc/history/history-view-annotated.js"],"names":["_super","HistoryView","AnnotatedHistoryView","extend","className","prototype","_buildNewRender","$newRender","call","renderHistoryAnnotation","annotation","model","get","find","text","renderItems","$whereTo","$el","$controls","remove","$headers","$","append","appendTo","self","views","_renderItemView$el","view","render","events","_","clone","ev","stopPropagation","currentTarget","click","$currTarget","length","attr","dropdown","_clickSectionLink","sectionNumber","parent","data","openSection","toString"],"mappings":"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","file":"../../../scripts/mvc/history/history-view-annotated.js","sourcesContent":["import HISTORY_VIEW from \"mvc/history/history-view\";\nimport HDA_LI from \"mvc/history/hda-li\";\nimport HDCA_LI from \"mvc/history/hdca-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// used in history/display.mako and history/embed.mako\n/** @class View/Controller for a tabular view of the history model.\n *\n *  As ReadOnlyHistoryView, but with:\n *      history annotation always shown\n *      datasets displayed in a table:\n *          datasets in left cells, dataset annotations in the right\n */\nvar AnnotatedHistoryView = _super.extend(\n    /** @lends AnnotatedHistoryView.prototype */ {\n        className: `${_super.prototype.className} annotated-history-panel`,\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** In this override, add the history annotation */\n        _buildNewRender: function() {\n            //TODO: shouldn't this display regardless (on all non-current panels)?\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            this.renderHistoryAnnotation($newRender);\n            return $newRender;\n        },\n\n        /** render the history's annotation as its own field */\n        renderHistoryAnnotation: function($newRender) {\n            var annotation = this.model.get(\"annotation\");\n            if (!annotation) {\n                return;\n            }\n            $newRender.find(\"> .controls .subtitle\").text(annotation);\n        },\n\n        /** override to add headers to indicate the dataset, annotation columns */\n        renderItems: function($whereTo) {\n            $whereTo = $whereTo || this.$el;\n            _super.prototype.renderItems.call(this, $whereTo);\n\n            var $controls = $whereTo.find(\"> .controls\");\n            $controls.find(\".contents-container.headers\").remove();\n\n            var $headers = $('<div class=\"contents-container headers\"/>')\n                .append([\n                    $('<div class=\"history-content header\"/>').text(_l(\"Dataset\")),\n                    $('<div class=\"additional-info header\"/>').text(_l(\"Annotation\"))\n                ])\n                .appendTo($controls);\n\n            return self.views;\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** override to wrap each subview */\n        _renderItemView$el: function(view) {\n            return $('<div class=\"contents-container\"/>').append([\n                view.render(0).$el,\n                $('<div class=\"additional-info\"/>').text(view.model.get(\"annotation\") || \"\")\n            ]);\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        events: _.extend(_.clone(_super.prototype.events), {\n            // clicking on any part of the row will expand the items\n            \"click .contents-container\": function(ev) {\n                ev.stopPropagation();\n                $(ev.currentTarget)\n                    .find(\".list-item .title-bar\")\n                    .click();\n            },\n            // prevent propagation on icon btns so they won't bubble up to tr and toggleBodyVisibility\n            \"click .icon-btn\": function(ev) {\n                ev.stopPropagation();\n                // stopProp will prevent bootstrap from getting the click needed to open a dropdown\n                //  in the case of metafile download buttons - workaround here\n                var $currTarget = $(ev.currentTarget);\n                if ($currTarget.length && $currTarget.attr(\"data-toggle\") === \"dropdown\") {\n                    $currTarget.dropdown(\"toggle\");\n                }\n            }\n        }),\n\n        _clickSectionLink: function(ev) {\n            var sectionNumber = $(ev.currentTarget)\n                .parent()\n                .parent()\n                .data(\"section\");\n            this.openSection(sectionNumber);\n        },\n\n        // ........................................................................ misc\n        /** Return a string rep of the history */\n        toString: function() {\n            return `AnnotatedHistoryView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    AnnotatedHistoryView: AnnotatedHistoryView\n};\n"]}
{"version":3,"sources":["mvc/history/multi-panel.js"],"names":["_","Backbone","logNamespace","HistoryViewColumn","View","extend","LoggableMixin","_logNamespace","tagName","className","id","model","get","initialize","options","purgeAllowed","isUndefined","panel","createPanel","setUpListeners","panelOptions","HistoryViewEdit","defaults","dragItems","$scrollContainer","$el","once","trigger","setUpPanelListeners","listenTo","rendered","view","$","off","inView","viewLeft","viewRight","columnLeft","offset","left","columnRight","width","$panel","render","speed","undefined","modelData","toJSON","html","template","renderPanel","css","setUpBehaviors","data","isCurrentHistory","currentHistory","controlsLeftTemplate","history","controlsRightTemplate","join","setElement","$list","before","_renderDropTargetHelp","events","setAsCurrent","_delete","done","undelete","confirm","purge","copy","variable","toString","MultiPanelColumns","log","addClass","columnWidth","borderWidth","columnGap","headerHeight","footerHeight","controlsHeight","perPage","hdaQueue","NamedAjaxQueue","collection","columnMap","columnOptions","historySearch","datasetSearch","setCollection","histories","on","fetchMore","stopListening","HistoryCollection","setUpCollectionListeners","createColumns","clear","addModels","models","isArray","forEach","addColumn","error","errorHandler","add","_postFetchAll","addAsCurrentColumn","setCurrentHistory","handleDeletedHistory","sort","renderColumns","fetchData","remove","scrollLeft","oldCurrentColumn","findWhere","height","newCurrentColumn","currentHistoryId","_recalcFirstColumnHeight","includeDeleted","column","removeColumn","xhr","status","readyState","isString","message","title","errorModal","badGatewayErrorModal","ajaxErrorModal","_ajaxErrorHandler","apply","toArray","arguments","create","ev","current","each","i","createColumn","Galaxy","config","allow_user_dataset_purge","setUpColumnListeners","searchItems","queueHdaFetchDetails","newColumn","queueHdaFetch","widthToRemove","fadeOut","checkColumnsInView","_dropData","JSON","parse","dataTransfer","getData","currentColumnDropTargetOn","currentColumnDropTargetOff","toCopy","filter","contents","isCopyable","json","queue","currentPage","name","fn","fetchPage","reverse","content","start","fetch","columnMapLength","Object","keys","length","sortedFilteredColumns","filters","sortedColumns","index","filtered","every","map","call","sorted","fxSpeed","mainTemplate","isNumber","sortedAndFiltered","$middle","empty","_addColumns","allFetched","append","loadingIndicatorTemplate","columns","numExisting","children","_calcMiddleWidth","delegateEvents","appendTo","numColumns","preventStackWidthAdj","contentsShown","fetchOptions","silent","ids","values","storage","allExpanded","details","fetchCurrentPage","renderItems","FETCH_STATE_ON_ADD","jobStateSummariesCollection","running","needsContentsLoaded","haveDetails","progressivelyFetchDetails","_renderEmptyMessage","renderInfo","msg","text","close","window","location","root","_clickToggleDeletedHistories","toggleDeletedHistories","currentTarget","is","toggleOptionsPopover","show","_clickToggleDeletedDatasets","toggleDeletedDatasets","delay","toggleShowDeleted","_clickToggleHiddenDatasets","toggleHiddenDatasets","toggleShowHidden","_chooseOrder","orderKey","orderDescriptions","setOrder","currentHistoryModel","slice","fetchFirst","unshift","_scrollLeft","val","_moreOptionsPopover","searchInput","placeholder","onfirstsearch","fetchAll","onsearch","searchFor","matchesAll","onclear","progress","curr","total","deferred","clearSearch","resize","debouncedInView","debounce","viewport","_viewport","checkForEndOfScroll","parent","scroll","popover","container","placement","optionsPopoverTemplate","$firstColumn","first","middleHeight","controlHeight","find","$outerMiddle","right","columnsInView","vp","END_PADDING","scrollRight","currentColumn","dataDropped","dropTargetOn","prototype","dataDrop","dropTarget","update_time","size"],"mappings":";;;;;;;;;QACYA,C;;QACAC,Q;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWZ;AACA;;AAEA,QAAIC,eAAe,SAAnB;AACA;;;;AAIA;AACA,QAAIC,oBAAoBF,SAASG,IAAT,CAAcC,MAAd,CAAqB,kBAAQC,aAA7B,EAA4CD,MAA5C,CAAmD;AACvEE,uBAAeL,YADwD;;AAGvEM,iBAAS,KAH8D;AAIvEC,mBAAW,+CAJ4D;AAKvEC,YAAI,SAASA,EAAT,GAAc;AACd,gBAAI,CAAC,KAAKC,KAAV,EAAiB;AACb,uBAAO,EAAP;AACH;AACD,uCAAyB,KAAKA,KAAL,CAAWC,GAAX,CAAe,IAAf,CAAzB;AACH,SAVsE;;AAYvE;AACA;AACAC,oBAAY,SAASA,UAAT,CAAoBC,OAApB,EAA6B;AACrCA,sBAAUA,WAAW,EAArB;AACA,iBAAKC,YAAL,GAAoB,CAACf,EAAEgB,WAAF,CAAcF,QAAQC,YAAtB,CAAD,GAAuCD,QAAQC,YAA/C,GAA8D,KAAlF;AACA,iBAAKE,KAAL,GAAaH,QAAQG,KAAR,IAAiB,KAAKC,WAAL,CAAiBJ,OAAjB,CAA9B;;AAEA,iBAAKK,cAAL;AACH,SApBsE;;AAsBvE;AACAD,qBAAa,SAASA,WAAT,CAAqBE,YAArB,EAAmC;AAC5C,mBAAO,IAAI,0BAAkBC,eAAtB,CACHrB,EAAEsB,QAAF,CAAWF,YAAX,EAAyB;AACrBT,uBAAO,KAAKA,KADS;AAErB;AACAI,8BAAc,KAAKA,YAHE;AAIrBQ,2BAAW,IAJU;AAKrBC,kCAAkB,4BAAW;AACzB,2BAAO,KAAKC,GAAZ;AACH;AAPoB,aAAzB,CADG,CAAP;AAWH,SAnCsE;;AAqCvE;AACAN,wBAAgB,SAASA,cAAT,GAA0B;AAAA;;AACtC;AACA,iBAAKO,IAAL,CAAU,UAAV,EAAsB,YAAM;AACxB,sBAAKC,OAAL,CAAa,kBAAb;AACH,aAFD;AAGA,iBAAKC,mBAAL;AACH,SA5CsE;;AA8CvE;AACAA,6BAAqB,SAASA,mBAAT,GAA+B;AAAA;;AAChD,iBAAKC,QAAL,CACI,KAAKZ,KADT,EAEI;AACI;;AAEA;AACAa,0BAAU,oBAAM;AACZ,2BAAKH,OAAL,CAAa,UAAb;AACH,iBANL;AAOI;AACA;AACA;AACA,+CAA+B,kCAASI,IAAT,EAAe;AAC1CA,yBAAKC,CAAL,CAAO,YAAP,EAAqBC,GAArB;AACH;AAZL,aAFJ,EAgBI,IAhBJ;AAkBH,SAlEsE;;AAoEvE;AACAC,gBAAQ,gBAASC,QAAT,EAAmBC,SAAnB,EAA8B;AAClC,gBAAIC,aAAa,KAAKZ,GAAL,CAASa,MAAT,GAAkBC,IAAnC;AACA,gBAAIC,cAAcH,aAAa,KAAKZ,GAAL,CAASgB,KAAT,EAA/B;AACA,gBAAID,cAAcL,QAAlB,EAA4B;AACxB,uBAAO,KAAP;AACH;AACD,gBAAIE,aAAaD,SAAjB,EAA4B;AACxB,uBAAO,KAAP;AACH;AACD,mBAAO,IAAP;AACH,SA/EsE;;AAiFvE;AACAM,gBAAQ,SAASA,MAAT,GAAkB;AACtB,mBAAO,KAAKV,CAAL,CAAO,gBAAP,CAAP;AACH,SApFsE;;AAsFvE;AACA;AACAW,gBAAQ,SAASA,MAAT,CAAgBC,KAAhB,EAAuB;AAC3BA,oBAAQA,UAAUC,SAAV,GAAsBD,KAAtB,GAA8B,MAAtC;AACA;AACA;AACA,gBAAIE,YAAY,KAAKnC,KAAL,GAAa,KAAKA,KAAL,CAAWoC,MAAX,EAAb,GAAmC,EAAnD;AACA,iBAAKtB,GAAL,CAASuB,IAAT,CAAc,KAAKC,QAAL,CAAcH,SAAd,CAAd;AACA,iBAAKI,WAAL,CAAiBN,KAAjB;AACA;AACA,iBAAK3B,KAAL,CAAWQ,GAAX,CAAe0B,GAAf,CAAmB,SAAnB,EAA8B,MAA9B;AACA;AACA;AACA;AACA,iBAAKC,cAAL;AACA;AACA,mBAAO,IAAP;AACH,SAvGsE;;AAyGvE;AACAA,wBAAgB,SAASA,cAAT,GAA0B;AACtC;AACA;AACH,SA7GsE;;AA+GvE;AACAH,kBAAU,SAASA,QAAT,CAAkBI,IAAlB,EAAwB;AAC9BA,mBAAOrD,EAAEK,MAAF,CAASgD,QAAQ,EAAjB,EAAqB;AACxBC,kCAAkB,KAAKC;AADC,aAArB,CAAP;AAGA,mBAAOvB,EACH,CACI,6CADJ,EAEI,KAAKwB,oBAAL,CAA0B;AACtBC,yBAASJ,IADa;AAEtBtB,sBAAM;AAFgB,aAA1B,CAFJ;AAMI;AACA,iBAAK2B,qBAAL,CAA2B;AACvBD,yBAASJ,IADc;AAEvBtB,sBAAM;AAFiB,aAA3B,CAPJ,EAWI,QAXJ,EAYI,oDAZJ,EAaI,mBAbJ,EAcIsB,KAAK3C,EAdT,EAeI,2DAfJ,EAgBI,QAhBJ,EAiBEiD,IAjBF,CAiBO,EAjBP,CADG,CAAP;AAoBH,SAxIsE;;AA0IvE;AACAT,qBAAa,SAASA,WAAT,CAAqBN,KAArB,EAA4B;AACrCA,oBAAQA,UAAUC,SAAV,GAAsBD,KAAtB,GAA8B,MAAtC;AACA,iBAAK3B,KAAL,CAAW2C,UAAX,CAAsB,KAAKlB,MAAL,EAAtB,EAAqCC,MAArC,CAA4CC,KAA5C;AACA,gBAAI,KAAKW,cAAT,EAAyB;AACrB,qBAAKtC,KAAL,CAAW4C,KAAX,GAAmBC,MAAnB,CAA0B,KAAK7C,KAAL,CAAW8C,qBAAX,EAA1B;AACH;AACD,mBAAO,IAAP;AACH,SAlJsE;;AAoJvE;AACA;AACAC,gBAAQ;AACJ;AACA,oCAAwB,4BAAW;AAC/B,qBAAKrD,KAAL,CAAWsD,YAAX;AACH,aAJG;AAKJ;AACA,qCAAyB,8BAAW;AAAA;;AAChC,qBAAKtD,KAAL,CAAWuD,OAAX,GAAqBC,IAArB,CAA0B,gBAAQ;AAC9B,2BAAKxB,MAAL;AACH,iBAFD;AAGH,aAVG;AAWJ,uCAA2B,gCAAW;AAAA;;AAClC,qBAAKhC,KAAL,CAAWyD,QAAX,GAAsBD,IAAtB,CAA2B,gBAAQ;AAC/B,2BAAKxB,MAAL;AACH,iBAFD;AAGH,aAfG;AAgBJ,oCAAwB,6BAAW;AAAA;;AAC/B,oBAAI0B,QAAQ,4BAAG,sDAAH,CAAR,CAAJ,EAAyE;AACrE,yBAAK1D,KAAL,CAAW2D,KAAX,GAAmBH,IAAnB,CAAwB,gBAAQ;AAC5B,+BAAKxB,MAAL;AACH,qBAFD;AAGH;AACJ,aAtBG;AAuBJ;AACA,mCAAuB;AAxBnB,SAtJ+D;;AAiLvE;AACA;AACA4B,cAAM,SAASA,IAAT,GAAgB;AAClB,sCAAkB,KAAK5D,KAAvB;AACH,SArLsE;;AAuLvE;AACA;AACA6C,8BAAsBxD,EAAEiD,QAAF,CAClB,CACI,yBADJ,EAEI,4CAFJ,EAGI,gCAHJ,EAII,4BAAG,iBAAH,CAJJ,EAKI,WALJ,EAMI,gBANJ,EAOI,4CAPJ,EAQI,4BAAG,WAAH,CARJ,EASI,WATJ,EAUI,SAVJ,EAWI,QAXJ,EAYEU,IAZF,CAYO,EAZP,CADkB,EAclB,EAAEa,UAAU,MAAZ,EAdkB,CAzLiD;;AA0MvE;AACAd,+BAAuB1D,EAAEiD,QAAF,CACnB,CACI,0BADJ,EAEI,mCAFJ,EAGI,oCAHJ,EAII,uFAJJ,EAKI,6BALJ,EAMI,WANJ,EAOI,mDAPJ,EAQI,oCARJ,EASI,yDATJ,EAUI,4BAAG,MAAH,CAVJ,EAWI,WAXJ;AAYI;AACA;AACA;AACA,mEAfJ,EAgBI,4BAAG,QAAH,CAhBJ,EAiBI,WAjBJ,EAkBI,oCAlBJ,EAmBI,6DAnBJ,EAoBI,4BAAG,UAAH,CApBJ,EAqBI,WArBJ,EAsBI,SAtBJ,EAuBI,qCAvBJ,EAwBI,0DAxBJ,EAyBI,4BAAG,OAAH,CAzBJ,EA0BI,WA1BJ,EA2BI,SA3BJ,EA4BI,OA5BJ,EA6BI,QA7BJ,EA8BI,SA9BJ,EA+BI,QA/BJ,EAgCEU,IAhCF,CAgCO,EAhCP,CADmB,EAkCnB,EAAEa,UAAU,MAAZ,EAlCmB,CA3MgD;;AAgPvE;AACA;AACAC,kBAAU,oBAAW;AACjB,2CAA4B,KAAKxD,KAAL,GAAa,KAAKA,KAAlB,GAA0B,EAAtD;AACH;AApPsE,KAAnD,CAAxB;;AAuPA;AACA;;AAEA,QAAIyD,oBAAoBzE,SAASG,IAAT,CAAcC,MAAd,CAAqB,kBAAQC,aAA7B,EAA4CD,MAA5C,CAAmD;AACvEE,uBAAeL,YADwD;;AAGvEO,mBAAW,qBAH4D;;AAKvE;AACA;AACAI,oBAAY,SAASA,UAAT,CAAoBC,OAApB,EAA6B;AACrCA,sBAAUA,WAAW,EAArB;AACA,iBAAK6D,GAAL,CAAY,IAAZ,YAAyB7D,OAAzB;;AAEA;AACA,iBAAKW,GAAL,CAASmD,QAAT,CAAkB,KAAKnE,SAAvB;;AAEA;AACA;AACA,iBAAKK,OAAL,GAAe;AACX+D,6BAAa,GADF;AAEXC,6BAAa,CAFF;AAGXC,2BAAW,CAHA;AAIXC,8BAAc,EAJH;AAKXC,8BAAc,CALH;AAMXC,gCAAgB;AANL,aAAf;;AASA;AACA,iBAAKC,OAAL,GAAerE,QAAQqE,OAAR,IAAmB,EAAlC;;AAEA;AACA,iBAAKC,QAAL,GAAgB,IAAI,oBAAUC,cAAd,CAA6B,EAA7B,EAAiC,KAAjC,CAAhB;;AAEA;AACA;AACA,iBAAKC,UAAL,GAAkB,IAAlB;AACA;AACA,iBAAKC,SAAL,GAAiB,EAAjB;AACA;AACA,iBAAKC,aAAL,GAAqB1E,QAAQ0E,aAAR,IAAyB,EAA9C;;AAEA;AACA,iBAAKC,aAAL,GAAqB,IAArB;AACA;AACA,iBAAKC,aAAL,GAAqB,IAArB;;AAEA,iBAAKC,aAAL,CAAmB7E,QAAQ8E,SAA3B;AACA,iBAAKzE,cAAL;AACH,SA9CsE;;AAgDvE;AACAA,wBAAgB,SAASA,cAAT,GAA0B;AAAA;;AACtC;AACA,iBAAK0E,EAAL,CAAQ,eAAR,EAAyB,YAAM;AAC3B,uBAAKP,UAAL,CAAgBQ,SAAhB;AACH,aAFD;AAGH,SAtDsE;;AAwDvE;AACA;;;AAGAH,uBAAe,SAASA,aAAT,CAAuBL,UAAvB,EAAmC;AAC9C;AACA,iBAAKS,aAAL,CAAmB,KAAKT,UAAxB;;AAEA,iBAAKA,UAAL,GAAkBA,cAAc,IAAI,uBAAcU,iBAAlB,EAAhC;AACA,iBAAKC,wBAAL;;AAEA,iBAAKC,aAAL;AACA,iBAAKd,QAAL,CAAce,KAAd;;AAEA,iBAAKxE,OAAL,CAAa,gBAAb,EAA+B,IAA/B;AACA,mBAAO,IAAP;AACH,SAxEsE;;AA0EvE;;;AAGAyE,mBAAW,SAASA,SAAT,CAAmBC,MAAnB,EAA2Bf,UAA3B,EAAuCxE,OAAvC,EAAgD;AAAA;;AACvD;AACAA,sBAAUA,WAAW,EAArB;AACAuF,qBAASrG,EAAEsG,OAAF,CAAUD,MAAV,IAAoBA,MAApB,GAA6B,CAACA,MAAD,CAAtC;AACAA,mBAAOE,OAAP,CAAe,iBAAS;AACpB,uBAAKC,SAAL,CAAe7F,KAAf,EAAsB,KAAtB;AACA;AACH,aAHD;AAIA,mBAAO,IAAP;AACH,SAtFsE;;AAwFvE;AACAsF,kCAA0B,oCAAW;AACjC,iBAAKpE,QAAL,CAAc,KAAKyD,UAAnB,EAA+B;AAC3B;AACAmB,uBAAO,KAAKC,YAFe;AAG3B;AACAC,qBAAK,KAAKP,SAJiB;AAK3B;AACA,+BAAe,KAAKQ,aANO;AAO3B;AACA,+BAAe,KAAKC,kBARO;AAS3B;AACA,kCAAkB,KAAKC,iBAVI;AAW3B;AACA,gDAAgC,KAAKC,oBAZV;AAa3B;AACAC,sBAAM,gBAAW;AACb,yBAAKC,aAAL,CAAmB,CAAnB;AACH;AAhB0B,aAA/B;AAkBH,SA5GsE;;AA8GvEL,uBAAe,uBAASM,SAAT,EAAoB;AAC/B;AACA,iBAAKlF,CAAL,CAAO,8BAAP,EAAuCmF,MAAvC;AACA;AACA;AACA;AACA,gBAAI,CAAC,KAAK1B,aAAV,EAAyB;AACrB,oBAAIjE,mBAAmB,KAAKQ,CAAL,CAAO,eAAP,CAAvB;AACAR,iCAAiB4F,UAAjB,CAA4B5F,iBAAiB4F,UAAjB,KAAgC,EAA5D;AACH;AACJ,SAxHsE;;AA0HvE;AACAN,2BAAmB,SAASA,iBAAT,CAA2BrD,OAA3B,EAAoC;AACnD,iBAAKkB,GAAL,CAAS,oBAAT,EAA+BlB,OAA/B;AACA,gBAAI4D,mBAAmBrH,EAAEsH,SAAF,CAAY,KAAK/B,SAAjB,EAA4B;AAC/ChC,gCAAgB;AAD+B,aAA5B,CAAvB;AAGA,gBAAI8D,gBAAJ,EAAsB;AAClBA,iCAAiB9D,cAAjB,GAAkC,KAAlC;AACA8D,iCAAiB5F,GAAjB,CAAqB8F,MAArB,CAA4B,EAA5B;AACH;;AAED,gBAAIC,mBAAmB,KAAKjC,SAAL,CAAe,KAAKD,UAAL,CAAgBmC,gBAA/B,CAAvB;AACAD,6BAAiBjE,cAAjB,GAAkC,IAAlC;AACA,iBAAK+B,UAAL,CAAgB0B,IAAhB;AACA,iBAAKU,wBAAL;AACA,mBAAOF,gBAAP;AACH,SA1IsE;;AA4IvE;;;AAGAT,8BAAsB,SAASA,oBAAT,CAA8BtD,OAA9B,EAAuC;AACzD,gBAAIA,QAAQ7C,GAAR,CAAY,SAAZ,KAA0B6C,QAAQ7C,GAAR,CAAY,QAAZ,CAA9B,EAAqD;AACjD,qBAAK+D,GAAL,CAAS,sBAAT,EAAiC,KAAKW,UAAL,CAAgBqC,cAAjD,EAAiElE,OAAjE;AACA,oBAAImE,SAAS,KAAKrC,SAAL,CAAe9B,QAAQ/C,EAAvB,CAAb;AACA,oBAAI,CAACkH,MAAL,EAAa;AACT;AACH;;AAED;AACA,oBAAIA,OAAOjH,KAAP,CAAaD,EAAb,KAAoB,KAAK4E,UAAL,CAAgBmC,gBAAxC,EAA0D;AACtD;AACA;AACA;AACA;AACA;AACH,iBAND,MAMO,IAAI,CAAC,KAAKnC,UAAL,CAAgBqC,cAArB,EAAqC;AACxC,yBAAKE,YAAL,CAAkBD,MAAlB;AACH;AACJ;AACJ,SAlKsE;;AAoKvE;AACA;;;;;;;AAOAlB,sBAAc,sBAAS/F,KAAT,EAAgBmH,GAAhB,EAAqBhH,OAArB,EAA8B;AACxC;AACA,gBAAIgH,OAAOA,IAAIC,MAAJ,KAAe,CAAtB,IAA2BD,IAAIE,UAAJ,KAAmB,CAAlD,EAAqD;AACjD;AACA;AACA;AACH;AACD;AACA,iBAAKvB,KAAL,CAAW9F,KAAX,EAAkBmH,GAAlB,EAAuBhH,OAAvB;AACA;AACA;AACA,gBAAId,EAAEiI,QAAF,CAAWtH,KAAX,KAAqBX,EAAEiI,QAAF,CAAWH,GAAX,CAAzB,EAA0C;AACtC,oBAAII,UAAUvH,KAAd;AACA,oBAAIwH,QAAQL,GAAZ;AACA,uBAAO,qBAAYM,UAAZ,CAAuBF,OAAvB,EAAgCC,KAAhC,EAAuCrH,OAAvC,CAAP;AACH;AACD;AACA;AACA,gBAAIgH,OAAOA,IAAIC,MAAJ,KAAe,GAA1B,EAA+B;AAC3B,uBAAO,qBAAYM,oBAAZ,EAAP;AACH;AACD,mBAAO,qBAAYC,cAAZ,CAA2B3H,KAA3B,EAAkCmH,GAAlC,EAAuChH,OAAvC,CAAP;AACH,SAlMsE;;AAoMvE;AACAyH,2BAAmB,6BAAW;AAC1B,iCAAYD,cAAZ,CAA2BE,KAA3B,CAAiC,IAAjC,EAAuCxI,EAAEyI,OAAF,CAAUC,SAAV,CAAvC;AACH,SAvMsE;;AAyMvE;AACAC,gBAAQ,gBAASC,EAAT,EAAa;AACjB,mBAAO,KAAKtD,UAAL,CAAgBqD,MAAhB,CAAuB,EAAEE,SAAS,IAAX,EAAvB,CAAP;AACH,SA5MsE;;AA8MvE;AACA;AACA3C,uBAAe,SAASA,aAAT,CAAuBG,MAAvB,EAA+Bb,aAA/B,EAA8C;AAAA;;AACzDA,4BAAgBA,iBAAiB,KAAK1E,OAAL,CAAa0E,aAA9C;AACA;AACA;AACA,iBAAKD,SAAL,GAAiB,EAAjB;AACA,iBAAKD,UAAL,CAAgBwD,IAAhB,CAAqB,UAACnI,KAAD,EAAQoI,CAAR,EAAc;AAC/B,uBAAKxD,SAAL,CAAe5E,MAAMD,EAArB,IAA2B,OAAKsI,YAAL,CAAkBrI,KAAlB,EAAyB6E,aAAzB,CAA3B;AACH,aAFD;AAGH,SAxNsE;;AA0NvE;AACAwD,sBAAc,SAASA,YAAT,CAAsBvF,OAAtB,EAA+B3C,OAA/B,EAAwC;AAClD;AACAA,sBAAUd,EAAEK,MAAF,CAAS,EAAT,EAAaS,OAAb,EAAsB;AAC5BH,uBAAO8C,OADqB;AAE5B1C,8BAAckI,OAAOC,MAAP,CAAcC;AAFA,aAAtB,CAAV;AAIA,gBAAIvB,SAAS,IAAIzH,iBAAJ,CAAsBW,OAAtB,CAAb;AACA,gBAAI2C,QAAQ/C,EAAR,KAAe,KAAK4E,UAAL,CAAgBmC,gBAAnC,EAAqD;AACjDG,uBAAOrE,cAAP,GAAwB,IAAxB;AACH;AACD,iBAAK6F,oBAAL,CAA0BxB,MAA1B;AACA,gBAAI,KAAKlC,aAAT,EAAwB;AACpBkC,uBAAO3G,KAAP,CAAaoI,WAAb,CAAyB,KAAK3D,aAA9B;AACA,qBAAK4D,oBAAL,CAA0B1B,MAA1B;AACH;AACD,mBAAOA,MAAP;AACH,SA3OsE;;AA6OvE;AACApB,mBAAW,SAASG,GAAT,CAAalD,OAAb,EAAsBd,MAAtB,EAA8B;AACrCA,qBAASA,WAAWE,SAAX,GAAuBF,MAAvB,GAAgC,IAAzC;AACA,gBAAI4G,YAAY,KAAKP,YAAL,CAAkBvF,OAAlB,CAAhB;AACA,iBAAK8B,SAAL,CAAe9B,QAAQ/C,EAAvB,IAA6B6I,SAA7B;AACA,gBAAI5G,MAAJ,EAAY;AACR,qBAAKsE,aAAL;AACH;AACD,mBAAOsC,SAAP;AACH,SAtPsE;;AAwPvE;AACA1C,4BAAoB,SAASF,GAAT,CAAalD,OAAb,EAAsB6B,UAAtB,EAAkCxE,OAAlC,EAA2C;AAAA;;AAC3D,gBAAIyI,YAAY,KAAK/C,SAAL,CAAe/C,OAAf,EAAwB,KAAxB,CAAhB;AACA,iBAAKqD,iBAAL,CAAuBrD,OAAvB;AACA8F,sBAAU7H,IAAV,CAAe,UAAf,EAA2B,YAAM;AAC7B,uBAAK8H,aAAL,CAAmBD,SAAnB;AACH,aAFD;AAGA,mBAAOA,SAAP;AACH,SAhQsE;;AAkQvE;AACA1B,sBAAc,SAASV,MAAT,CAAgBS,MAAhB,EAAwBjF,MAAxB,EAAgC;AAAA;;AAC1CA,qBAASA,WAAWE,SAAX,GAAuBF,MAAvB,GAAgC,IAAzC;AACA,iBAAKgC,GAAL,CAAS,cAAT,EAAyBiD,MAAzB;AACA,gBAAI,CAACA,MAAL,EAAa;AACT;AACH;AACD,gBAAI6B,gBAAgB,KAAK3I,OAAL,CAAa+D,WAAb,GAA2B,KAAK/D,OAAL,CAAaiE,SAA5D;AACA6C,mBAAOnG,GAAP,CAAWiI,OAAX,CAAmB,MAAnB,EAA2B,YAAM;AAC7B,oBAAI/G,MAAJ,EAAY;AACRX,+BAAQmF,MAAR;AACA,4BAAKnF,CAAL,CAAO,SAAP,EAAkBS,KAAlB,CAAwB,QAAKT,CAAL,CAAO,SAAP,EAAkBS,KAAlB,KAA4BgH,aAApD;AACA,4BAAKE,kBAAL;AACA,4BAAKjC,wBAAL;AACH;;AAED;AACA,wBAAK3B,aAAL,CAAmB6B,OAAO3G,KAA1B;AACA,wBAAK8E,aAAL,CAAmB6B,MAAnB;AACA,uBAAO,QAAKrC,SAAL,CAAeqC,OAAOjH,KAAP,CAAaD,EAA5B,CAAP;AACAkH,uBAAOT,MAAP;AACH,aAbD;AAcH,SAxRsE;;AA0RvE;AACAiC,8BAAsB,SAASA,oBAAT,CAA8BxB,MAA9B,EAAsC;AAAA;;AACxD,iBAAK/F,QAAL,CAAc+F,MAAd,EAAsB;AAClB;AACA,2BAAW,KAAK4B;AAFE,aAAtB;;AAKA,iBAAK3H,QAAL,CAAc+F,OAAO3G,KAArB,EAA4B;AACxB;;AAEA,4CAA4B,gCAAC2H,EAAD,EAAK7G,IAAL,EAAWd,KAAX,EAAkB2G,MAAlB,EAA6B;AACrD,4BAAKgC,SAAL,GAAiBC,KAAKC,KAAL,CAAWlB,GAAGmB,YAAH,CAAgBC,OAAhB,CAAwB,MAAxB,CAAX,CAAjB;AACA,4BAAKC,yBAAL;AACH,iBANuB;AAOxB,0CAA0B,8BAACrB,EAAD,EAAK7G,IAAL,EAAWd,KAAX,EAAkB2G,MAAlB,EAA6B;AACnD,4BAAKgC,SAAL,GAAiB,IAAjB;AACA,4BAAKM,0BAAL;AACH,iBAVuB;AAWxB,mCAAmB,wBAACtB,EAAD,EAAKvF,IAAL,EAAWpC,KAAX,EAAqB;AACpC;AACA,wBAAIkJ,SAAS,QAAKP,SAAL,CAAeQ,MAAf,CAAsB;AAAA,+BAAQnJ,MAAMN,KAAN,CAAY0J,QAAZ,CAAqBC,UAArB,CAAgCC,IAAhC,CAAR;AAAA,qBAAtB,CAAb;AACA,4BAAKX,SAAL,GAAiB,IAAjB;;AAEA,wBAAIY,QAAQ,IAAI,oBAAUnF,cAAd,EAAZ;AACA,wBAAIpE,MAAMN,KAAN,CAAY0J,QAAZ,CAAqBI,WAArB,KAAqC,CAAzC,EAA4C;AACxCD,8BAAM7D,GAAN,CAAU;AACN+D,kCAAM,kBADA;AAENC,gCAAI,cAAW;AACX,uCAAO1J,MAAMN,KAAN,CAAY0J,QAAZ,CAAqBO,SAArB,CAA+B,CAA/B,CAAP;AACH;AAJK,yBAAV;AAMH;AACD;AACA;AACAT,2BAAOU,OAAP,GAAiBtE,OAAjB,CAAyB,mBAAW;AAChCiE,8BAAM7D,GAAN,CAAU;AACN+D,4CAAcI,QAAQpK,EADhB;AAENiK,gCAAI,cAAW;AACX,uCAAO1J,MAAMN,KAAN,CAAY0J,QAAZ,CAAqB9F,IAArB,CAA0BuG,OAA1B,CAAP;AACH;AAJK,yBAAV;AAMH,qBAPD;AAQAN,0BAAMO,KAAN;AACAP,0BAAMrG,IAAN,CAAW,qBAAa;AACpBlD,8BAAMN,KAAN,CAAYqK,KAAZ;AACH,qBAFD;AAGH;AAvCuB,aAA5B;AAyCH,SA1UsE;;AA4UvE;AACAC,yBAAiB,2BAAW;AACxB,mBAAOC,OAAOC,IAAP,CAAY,KAAK5F,SAAjB,EAA4B6F,MAAnC;AACH,SA/UsE;;AAiVvE;;;AAGAC,+BAAuB,+BAASC,OAAT,EAAkB;AACrCA,sBAAUA,WAAW,KAAKA,OAA1B;AACA,gBAAI,CAACA,OAAD,IAAY,CAACA,QAAQF,MAAzB,EAAiC;AAC7B,uBAAO,KAAKG,aAAL,EAAP;AACH;AACD,mBAAO,KAAKA,aAAL,GAAqBnB,MAArB,CAA4B,UAACxC,MAAD,EAAS4D,KAAT,EAAmB;AAClD,oBAAIC,WAAW7D,OAAOrE,cAAP,IAAyBvD,EAAE0L,KAAF,CAAQJ,QAAQK,GAAR,CAAY;AAAA,2BAAUvB,OAAOwB,IAAP,CAAYhE,MAAZ,CAAV;AAAA,iBAAZ,CAAR,CAAxC;AACA,uBAAO6D,QAAP;AACH,aAHM,CAAP;AAIH,SA7VsE;;AA+VvE;AACAF,uBAAe,yBAAW;AAAA;;AACtB,gBAAIM,SAAS,KAAKvG,UAAL,CAAgBqG,GAAhB,CAAoB,UAAClI,OAAD,EAAU+H,KAAV;AAAA,uBAAoB,QAAKjG,SAAL,CAAe9B,QAAQ/C,EAAvB,CAApB;AAAA,aAApB,CAAb;AACA,mBAAOmL,MAAP;AACH,SAnWsE;;AAqWvE;AACA;AACAlJ,gBAAQ,SAASA,MAAT,CAAgBC,KAAhB,EAAuB;AAC3BA,oBAAQA,UAAUC,SAAV,GAAsBD,KAAtB,GAA8B,KAAKkJ,OAA3C;;AAEA,iBAAKnH,GAAL,CAAY,IAAZ;AACA,iBAAKlD,GAAL,CAASuB,IAAT,CAAc,KAAK+I,YAAL,CAAkB,IAAlB,CAAd;AACA,iBAAK9E,aAAL,CAAmBrE,KAAnB;;AAEA;AACA,iBAAKQ,cAAL;AACA;AACA;AACA,iBAAKzB,OAAL,CAAa,UAAb,EAAyB,IAAzB;AACA,mBAAO,IAAP;AACH,SApXsE;;AAsXvE;AACAsF,uBAAe,SAASA,aAAT,CAAuBrE,KAAvB,EAA8B;AACzCA,oBAAQ5C,EAAEgM,QAAF,CAAWpJ,KAAX,IAAoBA,KAApB,GAA4B,KAAKkJ,OAAzC;AACA;AACA;AACA,gBAAIG,oBAAoB,KAAKZ,qBAAL,EAAxB;AACA;AACA,gBAAIa,UAAU,KAAKlK,CAAL,CAAO,SAAP,EAAkBmK,KAAlB,EAAd;;AAEA,iBAAKC,WAAL,CAAiBH,iBAAjB,EAAoCrJ,KAApC;AACA,gBAAI,CAAC,KAAK0C,UAAL,CAAgB+G,UAArB,EAAiC;AAC7BH,wBAAQI,MAAR,CAAe,KAAKC,wBAAL,CAA8B,IAA9B,CAAf;AACH;AACD;AACA,iBAAK5K,OAAL,CAAa,kBAAb,EAAiCsK,iBAAjC,EAAoD,IAApD;;AAEA,gBAAI,CAAC,KAAKvG,aAAN,IAAuBuG,kBAAkBb,MAAlB,GAA2B,CAAtD,EAAyD;AACrD;AACA,qBAAKzB,kBAAL;AACA;AACA,qBAAKjC,wBAAL;AACH;AACD,mBAAOuE,iBAAP;AACH,SA7YsE;;AA+YvEG,qBAAa,qBAASI,OAAT,EAAkB5J,KAAlB,EAAyB;AAClCA,oBAAQ5C,EAAEgM,QAAF,CAAWpJ,KAAX,IAAoBA,KAApB,GAA4B,KAAKkJ,OAAzC;AACA,gBAAII,UAAU,KAAKlK,CAAL,CAAO,SAAP,CAAd;;AAEA,gBAAIyK,cAAcP,QAAQQ,QAAR,CAAiB,iBAAjB,EAAoCtB,MAAtD;AACAc,oBAAQzJ,KAAR,CAAc,KAAKkK,gBAAL,CAAsBH,QAAQpB,MAAR,GAAiBqB,WAAvC,CAAd;;AAEAD,oBAAQjG,OAAR,CAAgB,UAACqB,MAAD,EAASmB,CAAT,EAAe;AAC3BnB,uBACKgF,cADL,GAEKjK,MAFL,CAEYC,KAFZ,EAGKnB,GAHL,CAGSoL,QAHT,CAGkBX,OAHlB;AAIH,aALD;AAMH,SA5ZsE;;AA8ZvES,0BAAkB,0BAASG,UAAT,EAAqB;AACnC,gBAAIC,uBAAuB,EAA3B;AACA,mBACID,cAAc,KAAKhM,OAAL,CAAa+D,WAAb,GAA2B,KAAK/D,OAAL,CAAaiE,SAAtD;AACA;AACA,iBAAKjE,OAAL,CAAaiE,SAFb;AAGA;AACAgI,gCALJ;AAOH,SAvasE;;AAyavE;AACA;AACA;AACA;;;AAGAvD,uBAAe,SAASA,aAAT,CAAuB5B,MAAvB,EAA+B;AAC1C;AACA,gBAAIyC,WAAWzC,OAAOjH,KAAP,CAAa0J,QAA5B;AACA;AACA;AACA,gBAAIA,SAASe,MAAT,KAAoB,CAApB,IAAyBxD,OAAOjH,KAAP,CAAaqM,aAAb,EAA7B,EAA2D;AACvD,oBAAIC,eAAe,EAAEC,QAAQ,IAAV,EAAnB;AACA,oBAAIC,MAAMnN,EAAEoN,MAAF,CAAS/C,SAASgD,OAAT,CAAiBC,WAAjB,EAAT,EAAyC3J,IAAzC,EAAV;AACA,oBAAIwJ,GAAJ,EAAS;AACLF,iCAAaM,OAAb,GAAuBJ,GAAvB;AACH;AACD;AACA,qBAAK/H,QAAL,CAAcuB,GAAd,CAAkB;AACd+D,0BAAM9C,OAAOjH,KAAP,CAAaD,EADL;AAEdiK,wBAAI,cAAW;AACX,+BAAON,SACFmD,gBADE,CACeP,YADf,EAEF9I,IAFE,CAEG,YAAM;AACRyD,mCAAO3G,KAAP,CAAawM,WAAb;AACH,yBAJE,EAKFtJ,IALE,CAKG,YAAM;AACR,gCAAI,CAAC,yBAAiBuJ,kBAAtB,EAA0C;AACtCrD,yCAASsD,2BAAT,CAAqC3C,KAArC;AACH;AACJ,yBATE,CAAP;AAUH;AAba,iBAAlB;AAeA;AACA,oBAAI,CAAC,KAAK5F,QAAL,CAAcwI,OAAnB,EAA4B;AACxB,yBAAKxI,QAAL,CAAc2F,KAAd;AACH;AACJ;AACJ,SA/csE;;AAidvE;AACAzB,8BAAsB,8BAAS1B,MAAT,EAAiB;AACnC,gBAAIyC,WAAWzC,OAAOjH,KAAP,CAAa0J,QAA5B;AACA,gBAAIwD,sBAAsBxD,SAASe,MAAT,KAAoB,CAApB,IAAyBxD,OAAOjH,KAAP,CAAaqM,aAAb,EAAnD;AACA,gBAAIa,uBAAuB,CAACxD,SAASyD,WAAT,EAA5B,EAAoD;AAChD;AACA,qBAAK1I,QAAL,CAAcuB,GAAd,CAAkB;AACd+D,0BAAM9C,OAAOjH,KAAP,CAAaD,EADL;AAEdiK,wBAAI,cAAW;AACX,+BAAON,SAAS0D,yBAAT,GAAqC5J,IAArC,CAA0C,YAAM;AACnDyD,mCAAO3G,KAAP,CAAa+M,mBAAb;AACH,yBAFM,CAAP;AAGH;AANa,iBAAlB;AAQA;AACA,oBAAI,CAAC,KAAK5I,QAAL,CAAcwI,OAAnB,EAA4B;AACxB,yBAAKxI,QAAL,CAAc2F,KAAd;AACH;AACJ;AACJ,SApesE;;AAsevE;AACAkD,oBAAY,oBAASC,GAAT,EAAc;AACtB,mBAAO,KAAKlM,CAAL,CAAO,sBAAP,EAA+BmM,IAA/B,CAAoCD,GAApC,CAAP;AACH,SAzesE;;AA2evE;AACAlK,gBAAQ;AACJ;AACA,+BAAmB,OAFf;AAGJ;AACA,qCAAyB,QAJrB;AAKJ,sCAA0B,8BALtB;AAMJ;AACA,uCAA2B,cAPvB;AAQJ,qCAAyB,6BARrB;AASJ,oCAAwB;AACxB;AAVI,SA5e+D;;AAyfvEoK,eAAO,eAASxF,EAAT,EAAa;AAChB;AACAyF,mBAAOC,QAAP,GAAkBrF,OAAOsF,IAAzB;AACH,SA5fsE;;AA8fvEC,sCAA8B,sCAAS5F,EAAT,EAAa;AACvC,iBAAK6F,sBAAL,CAA4BzM,EAAE4G,GAAG8F,aAAL,EAAoBC,EAApB,CAAuB,UAAvB,CAA5B;AACA,iBAAKC,oBAAL;AACH,SAjgBsE;AAkgBvE;AACAH,gCAAwB,gCAASI,IAAT,EAAe;AACnC,gBAAIA,IAAJ,EAAU;AACNR,uBAAOC,QAAP,GAAqBrF,OAAOsF,IAA5B;AACH,aAFD,MAEO;AACHF,uBAAOC,QAAP,GAAqBrF,OAAOsF,IAA5B;AACH;AACJ,SAzgBsE;;AA2gBvEO,qCAA6B,qCAASlG,EAAT,EAAa;AACtC,iBAAKmG,qBAAL,CAA2B/M,EAAE4G,GAAG8F,aAAL,EAAoBC,EAApB,CAAuB,UAAvB,CAA3B;AACA,iBAAKC,oBAAL;AACH,SA9gBsE;AA+gBvEG,+BAAuB,+BAASF,IAAT,EAAe;AAClCA,mBAAOA,SAAShM,SAAT,GAAqBgM,IAArB,GAA4B,KAAnC;AACA,iBAAKxD,qBAAL,GAA6B9E,OAA7B,CAAqC,UAACqB,MAAD,EAASmB,CAAT,EAAe;AAChD/I,kBAAEgP,KAAF,CAAQ,YAAM;AACVpH,2BAAO3G,KAAP,CAAagO,iBAAb,CAA+BJ,IAA/B,EAAqC,KAArC;AACH,iBAFD,EAEG9F,IAAI,GAFP;AAGH,aAJD;AAKH,SAthBsE;;AAwhBvEmG,oCAA4B,oCAAStG,EAAT,EAAa;AACrC,iBAAKuG,oBAAL,CAA0BnN,EAAE4G,GAAG8F,aAAL,EAAoBC,EAApB,CAAuB,UAAvB,CAA1B;AACA,iBAAKC,oBAAL;AACH,SA3hBsE;AA4hBvEO,8BAAsB,8BAASN,IAAT,EAAe;AACjCA,mBAAOA,SAAShM,SAAT,GAAqBgM,IAArB,GAA4B,KAAnC;AACA,iBAAKxD,qBAAL,GAA6B9E,OAA7B,CAAqC,UAACqB,MAAD,EAASmB,CAAT,EAAe;AAChD/I,kBAAEgP,KAAF,CAAQ,YAAM;AACVpH,2BAAO3G,KAAP,CAAamO,gBAAb,CAA8BP,IAA9B,EAAoC,KAApC;AACH,iBAFD,EAEG9F,IAAI,GAFP;AAGH,aAJD;AAKH,SAniBsE;;AAqiBvE;AACAsG,sBAAc,sBAASzG,EAAT,EAAa;AAAA;;AACvB,gBAAItD,aAAa,KAAKA,UAAtB;AACA,gBAAIgK,WAAWtN,EAAE4G,GAAG8F,aAAL,EAAoBrL,IAApB,CAAyB,OAAzB,CAAf;AACA;AACA,iBAAKrB,CAAL,CAAO,gBAAP,EAAyBmM,IAAzB,CAA8B,KAAKoB,iBAAL,CAAuBD,QAAvB,CAA9B;AACA,iBAAKV,oBAAL;AACA;AACAtJ,uBAAWkK,QAAX,CAAoBF,QAApB;AACA,gBAAIG,sBAAsBnK,WAAWoK,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAA1B;AACApK,uBAAWqK,UAAX,GAAwBxL,IAAxB,CAA6B,YAAM;AAC/BmB,2BAAWsK,OAAX,CAAmBH,mBAAnB,EAAwC;AACpCvC,4BAAQ;AAD4B,iBAAxC;AAGA,wBAAKhH,aAAL;AACA;AACA,wBAAKd,QAAL,CAAce,KAAd;AACA,wBAAKxD,MAAL;AACH,aARD;AASA,iBAAKjB,IAAL,CAAU,kBAAV,EAA8B,KAAKmO,WAAnC;AACA;AACH,SA1jBsE;;AA4jBvE;AACAA,qBAAa,qBAASC,GAAT,EAAc;AACvBA,kBAAM9P,EAAEgM,QAAF,CAAW8D,GAAX,IAAkBA,GAAlB,GAAwB,CAA9B;AACA,iBAAK9N,CAAL,CAAO,eAAP,EAAwBoF,UAAxB,CAAmC0I,GAAnC;AACH,SAhkBsE;;AAkkBvE;AACA1M,wBAAgB,0BAAW;AAAA;;AACvB,iBAAK2M,mBAAL;;AAEA;AACA,iBAAK/N,CAAL,CAAO,mBAAP,EAA4BgO,WAA5B,CAAwC;AACpCtF,sBAAM,kBAD8B;AAEpCuF,6BAAa,4BAAG,kBAAH,CAFuB;;AAIpCC,+BAAe,kCAAa;AACxB,4BAAKlO,CAAL,CAAO,mBAAP,EAA4BgO,WAA5B,CAAwC,gBAAxC;AACA,4BAAK/B,UAAL,CAAgB,4BAAG,kCAAH,CAAhB;AACA,4BAAK3I,UAAL,CAAgB6K,QAAhB,GAA2BhM,IAA3B,CAAgC,YAAM;AAClC,gCAAKnC,CAAL,CAAO,mBAAP,EAA4BgO,WAA5B,CAAwC,gBAAxC;AACA,gCAAK/B,UAAL,CAAgB,EAAhB;AACH,qBAHD;AAIH,iBAXmC;AAYpCmC,0BAAU,6BAAa;AACnB,4BAAK3K,aAAL,GAAqB4K,SAArB;AACA,4BAAK/E,OAAL,GAAe,CACX,YAAM;AACF,+BAAO,QAAK3K,KAAL,CAAW2P,UAAX,CAAsB,QAAK7K,aAA3B,CAAP;AACH,qBAHU,CAAf;AAKA,4BAAKwB,aAAL,CAAmB,CAAnB;AACH,iBApBmC;AAqBpCsJ,yBAAS,4BAAa;AAClB,4BAAK9K,aAAL,GAAqB,IAArB;AACA;AACA,4BAAK6F,OAAL,GAAe,EAAf;AACA,4BAAKrE,aAAL,CAAmB,CAAnB;AACH;AA1BmC,aAAxC;;AA6BA;AACA,iBAAKjF,CAAL,CAAO,kBAAP,EAA2BgO,WAA3B,CAAuC;AACnCtF,sBAAM,iBAD6B;AAEnCuF,6BAAa,4BAAG,qBAAH,CAFsB;;AAInCC,+BAAe,kCAAa;AACxB,4BAAK9K,QAAL,CAAce,KAAd;AACA,4BAAKnE,CAAL,CAAO,kBAAP,EAA2BgO,WAA3B,CAAuC,gBAAvC;AACA,4BAAKtK,aAAL,GAAqB2K,SAArB;AACA,4BAAKhF,qBAAL,GAA6B9E,OAA7B,CAAqC,kBAAU;AAC3CqB,+BAAO3G,KAAP,CAAaoI,WAAb,CAAyBgH,SAAzB;AACA;AACA,gCAAK/G,oBAAL,CAA0B1B,MAA1B;AACH,qBAJD;AAKA,4BAAKxC,QAAL,CAAcoL,QAAd,CAAuB,oBAAY;AAC/B,gCAAKvC,UAAL,CAAgB,CAAC,4BAAG,WAAH,CAAD,EAAkBuC,SAASC,IAAT,GAAgB,CAAlC,EAAqC,4BAAG,IAAH,CAArC,EAA+CD,SAASE,KAAxD,EAA+D/M,IAA/D,CAAoE,GAApE,CAAhB;AACH,qBAFD;AAGA,4BAAKyB,QAAL,CAAcuL,QAAd,CAAuBxM,IAAvB,CAA4B,YAAM;AAC9B,gCAAK8J,UAAL,CAAgB,EAAhB;AACA,gCAAKjM,CAAL,CAAO,kBAAP,EAA2BgO,WAA3B,CAAuC,gBAAvC;AACH,qBAHD;AAIH,iBApBkC;AAqBnCI,0BAAU,6BAAa;AACnB,4BAAK1K,aAAL,GAAqB2K,SAArB;AACA,4BAAKhF,qBAAL,GAA6B9E,OAA7B,CAAqC,kBAAU;AAC3CqB,+BAAO3G,KAAP,CAAaoI,WAAb,CAAyBgH,SAAzB;AACH,qBAFD;AAGH,iBA1BkC;AA2BnCE,yBAAS,4BAAa;AAClB,4BAAK7K,aAAL,GAAqB,IAArB;AACA,4BAAK2F,qBAAL,GAA6B9E,OAA7B,CAAqC,kBAAU;AAC3CqB,+BAAO3G,KAAP,CAAa2P,WAAb;AACH,qBAFD;AAGH;AAhCkC,aAAvC;;AAmCA;AACA5O,cAAEqM,MAAF,EAAUwC,MAAV,CAAiB,YAAM;AACnB,wBAAKnJ,wBAAL;AACH,aAFD;;AAIA;AACA;AACA,gBAAIoJ,kBAAkB9Q,EAAE+Q,QAAF,CAAW,YAAM;AACnC,oBAAIC,WAAW,QAAKC,SAAL,EAAf;AACA,wBAAKtH,kBAAL,CAAwBqH,QAAxB;AACA,wBAAKE,mBAAL,CAAyBF,QAAzB;AACH,aAJqB,EAInB,GAJmB,CAAtB;AAKA,iBAAKhP,CAAL,CAAO,SAAP,EACKmP,MADL,GAEKC,MAFL,CAEYN,eAFZ;AAGH,SAvpBsE;;AAypBvE;AACAf,6BAAqB,+BAAW;AAC5B,mBAAO,KAAK/N,CAAL,CAAO,wBAAP,EAAiCqP,OAAjC,CAAyC;AAC5CC,2BAAW,SADiC;AAE5CC,2BAAW,QAFiC;AAG5CvO,sBAAM,IAHsC;AAI5C8H,yBAAS9I,EAAE,KAAKwP,sBAAL,CAA4B,IAA5B,CAAF;AAJmC,aAAzC,CAAP;AAMH,SAjqBsE;;AAmqBvE;AACA5C,8BAAsB,8BAAShG,EAAT,EAAa;AAC/B;AACA,iBAAK5G,CAAL,CAAO,wBAAP,EAAiCqP,OAAjC,CAAyC,QAAzC;AACH,SAvqBsE;;AAyqBvE;AACA3J,kCAA0B,oCAAW;AACjC,gBAAI+J,eAAe,KAAKzP,CAAL,CAAO,iBAAP,EAA0B0P,KAA1B,EAAnB;AACA,gBAAIC,eAAe,KAAK3P,CAAL,CAAO,SAAP,EAAkBuF,MAAlB,EAAnB;AACA,gBAAIqK,gBAAgBH,aAAaI,IAAb,CAAkB,iBAAlB,EAAqCtK,MAArC,EAApB;AACAkK,yBACKlK,MADL,CACYoK,YADZ,EAEKE,IAFL,CAEU,QAFV,EAGKtK,MAHL,CAGYoK,eAAeC,aAH3B;AAIH,SAlrBsE;;AAorBvE;AACAX,mBAAW,qBAAW;AAClB,gBAAIa,eAAe,KAAK9P,CAAL,CAAO,SAAP,EAAkBmP,MAAlB,EAAnB;AACA,gBAAIhP,WAAW2P,aAAaxP,MAAb,GAAsBC,IAArC;AACA,gBAAIE,QAAQqP,aAAarP,KAAb,EAAZ;AACA,mBAAO;AACHF,sBAAMJ,QADH;AAEH4P,uBAAO5P,WAAWM;AAFf,aAAP;AAIH,SA7rBsE;;AA+rBvE;AACAuP,uBAAe,uBAAShB,QAAT,EAAmB;AAC9B;AACA;AACA,gBAAIiB,KAAKjB,YAAY,KAAKC,SAAL,EAArB;AACA,mBAAO,KAAK5F,qBAAL,GAA6BjB,MAA7B,CAAoC;AAAA,uBAAUxC,OAAOrE,cAAP,IAAyBqE,OAAO1F,MAAP,CAAc+P,GAAG1P,IAAjB,EAAuB0P,GAAGF,KAA1B,CAAnC;AAAA,aAApC,CAAP;AACH,SArsBsE;;AAusBvE;AACA;AACApI,4BAAoB,8BAAW;AAC3B;AACA,iBAAKqI,aAAL,GAAqBzL,OAArB,CAA6B,kBAAU;AACnCqB,uBAAOjG,OAAP,CAAe,SAAf,EAA0BiG,MAA1B;AACH,aAFD;AAGH,SA9sBsE;;AAgtBvE;AACAsJ,6BAAqB,6BAASF,QAAT,EAAmB;AACpCA,uBAAWA,YAAY,KAAKC,SAAL,EAAvB;AACA,gBAAIiB,cAAc,EAAlB;AACA,gBAAIhG,UAAU,KAAKlK,CAAL,CAAO,SAAP,CAAd;AACA,gBAAImQ,cAAcjG,QAAQiF,MAAR,GAAiB/J,UAAjB,KAAgC4J,SAASe,KAA3D;AACA,gBAAII,eAAejG,QAAQzJ,KAAR,KAAkByP,WAArC,EAAkD;AAC9C,qBAAKvQ,OAAL,CAAa,eAAb;AACH;AACJ,SAztBsE;;AA2tBvE;AACAsI,mCAA2B,qCAAW;AAClC,gBAAImI,gBAAgB,KAAK7M,SAAL,CAAe,KAAKD,UAAL,CAAgBmC,gBAA/B,CAApB;AACA,gBAAI,CAAC2K,aAAL,EAAoB;AAChB;AACH;AACD;AACAA,0BAAcnR,KAAd,CAAoBoR,WAApB,GAAkC,gBAAQ,CAAE,CAA5C;AACAD,0BAAcnR,KAAd,CAAoBqR,YAApB;AACH,SApuBsE;;AAsuBvE;AACApI,oCAA4B,sCAAW;AACnC,gBAAIkI,gBAAgB,KAAK7M,SAAL,CAAe,KAAKD,UAAL,CAAgBmC,gBAA/B,CAApB;AACA,gBAAI,CAAC2K,aAAL,EAAoB;AAChB;AACH;AACDA,0BAAcnR,KAAd,CAAoBoR,WAApB,GAAkC,0BAAkBhR,eAAlB,CAAkCkR,SAAlC,CAA4CC,QAA9E;AACA;AACAJ,0BAAcnR,KAAd,CAAoBwR,UAApB,GAAiC,KAAjC;AACAL,0BAAcnR,KAAd,CAAoBe,CAApB,CAAsB,sBAAtB,EAA8CmF,MAA9C;AACH,SAhvBsE;;AAkvBvE;AACA;AACA1C,kBAAU,oBAAW;AACjB,2CAA4B,KAAK+H,OAAL,GAAe,KAAKA,OAAL,CAAapB,MAA5B,GAAqC,CAAjE;AACH,SAtvBsE;;AAwvBvE;AACAW,sBAAc/L,EAAEiD,QAAF,CACV,CACI,4CADJ,EAEI,8DAFJ,EAGI,oDAHJ,EAII,4BAAG,MAAH,CAJJ,EAKI,WALJ,EAMI,0DANJ,EAOI,yDAPJ,EAQI,4DARJ,EASI,wCATJ,EAUI,MAVJ,EAWI,QAXJ;AAYI;AACA,wEAbJ,EAcI,2BAdJ,EAeI,QAfJ,EAgBI,QAhBJ,EAiBI,+DAjBJ,EAkBI,0DAlBJ,EAmBI,4BAAG,YAAH,CAnBJ,EAoBI,YApBJ,EAqBI,QArBJ,EAsBI,QAtBJ;AAuBI;AACA,gEAxBJ,EAyBI,2DAzBJ,EA0BI,QA1BJ;AA2BI;AACA,0DA5BJ,EA6BEU,IA7BF,CA6BO,EA7BP,CADU,EA+BV,EAAEa,UAAU,MAAZ,EA/BU,CAzvByD;;AA2xBvE+H,kCAA0BvM,EAAEiD,QAAF,CACtB,CACI,2CADJ,EAEI,6CAFJ,EAGI,4BAAG,mBAAH,CAHJ,EAII,KAJJ,EAKI,QALJ,EAMEU,IANF,CAMO,EANP,CADsB,EAQtB,EAAEa,UAAU,MAAZ,EARsB,CA3xB6C;;AAsyBvE+K,2BAAmB;AACfmD,yBAAa,4BAAG,mBAAH,CADE;AAEf,+BAAmB,4BAAG,oBAAH,CAFJ;AAGfhI,kBAAM,4BAAG,cAAH,CAHS;AAIf,wBAAY,4BAAG,cAAH,CAJG;AAKfiI,kBAAM,4BAAG,sBAAH,CALS;AAMf,wBAAY,4BAAG,sBAAH;AANG,SAtyBoD;;AA+yBvEnB,gCAAwBxR,EAAEiD,QAAF,CACpB,CACI,4BADJ,EAEI,+BAFJ,EAGI,uFAHJ,EAIO,4BAAG,oBAAH,CAJP,QAKI,4FALJ,EAMI,6BANJ,EAOI,WAPJ,EAQI,wCARJ,EASI,gEATJ,EAUI,gFAVJ,EAWI,aAXJ,EAYI,WAZJ,EAaI,WAbJ,EAcI,OAdJ,EAeI,QAfJ,EAiBI,0EAjBJ,EAkBI,yDAlBJ,EAmBI,4BAAG,2BAAH,CAnBJ,EAoBI,gBApBJ,EAsBI,QAtBJ,EAwBI,0EAxBJ,EAyBI,4BAAG,0BAAH,CAzBJ,EA0BI,gBA1BJ,EA2BI,yEA3BJ,EA4BI,4BAAG,yBAAH,CA5BJ,EA6BI,gBA7BJ,EA8BI,QA9BJ,EA+BEU,IA/BF,CA+BO,EA/BP,CADoB,EAiCpB,EAAEa,UAAU,MAAZ,EAjCoB;AA/yB+C,KAAnD,CAAxB;;AAo1BA;sBACe;AACXE,2BAAmBA;AADR,K","file":"../../../scripts/mvc/history/multi-panel.js","sourcesContent":["import _l from \"utils/localization\";\nimport * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\nimport HISTORY_MODEL from \"mvc/history/history-model\";\nimport HISTORY_VIEW_EDIT from \"mvc/history/history-view-edit\";\nimport JOB_STATES_MODEL from \"mvc/history/job-states-model\";\nimport historyCopyDialog from \"mvc/history/copy-dialog\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport baseMVC from \"mvc/base-mvc\";\nimport ajaxQueue from \"utils/ajax-queue\";\nimport \"ui/mode-button\";\nimport \"ui/search-input\";\n\n/* global $ */\n/* global Galaxy */\n\nvar logNamespace = \"history\";\n/* ==============================================================================\nTODO:\n\n============================================================================== */\n/** @class A container for a history panel that renders controls for that history (delete, copy, etc.) */\nvar HistoryViewColumn = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    tagName: \"div\",\n    className: \"history-column flex-column flex-row-container\",\n    id: function id() {\n        if (!this.model) {\n            return \"\";\n        }\n        return `history-column-${this.model.get(\"id\")}`;\n    },\n\n    // ------------------------------------------------------------------------ set up\n    /** set up passed-in panel (if any) and listeners */\n    initialize: function initialize(options) {\n        options = options || {};\n        this.purgeAllowed = !_.isUndefined(options.purgeAllowed) ? options.purgeAllowed : false;\n        this.panel = options.panel || this.createPanel(options);\n\n        this.setUpListeners();\n    },\n\n    /** create a history panel for this column */\n    createPanel: function createPanel(panelOptions) {\n        return new HISTORY_VIEW_EDIT.HistoryViewEdit(\n            _.defaults(panelOptions, {\n                model: this.model,\n                // non-current panels should set their hdas to draggable\n                purgeAllowed: this.purgeAllowed,\n                dragItems: true,\n                $scrollContainer: function() {\n                    return this.$el;\n                }\n            })\n        );\n    },\n\n    /** set up reflexive listeners */\n    setUpListeners: function setUpListeners() {\n        //this.log( 'setUpListeners', this );\n        this.once(\"rendered\", () => {\n            this.trigger(\"rendered:initial\", this);\n        });\n        this.setUpPanelListeners();\n    },\n\n    /** set listeners needed for panel */\n    setUpPanelListeners: function setUpPanelListeners() {\n        this.listenTo(\n            this.panel,\n            {\n                //'all': function(){ console.info( 'panel of ' + this, arguments ); },\n\n                // assumes panel will take the longest to render\n                rendered: () => {\n                    this.trigger(\"rendered\", this);\n                },\n                // when a panel's view expands turn off the click handler on the rerun button so that it uses it's href\n                // this allows the button to open the tool rerun form in a new tab (instead of erroring)\n                // TODO: hack\n                \"view:expanded view:rendered\": function(view) {\n                    view.$(\".rerun-btn\").off();\n                }\n            },\n            this\n        );\n    },\n\n    /** do the dimensions of this column overlap the given (horizontal) browser coords? */\n    inView: function(viewLeft, viewRight) {\n        var columnLeft = this.$el.offset().left;\n        var columnRight = columnLeft + this.$el.width();\n        if (columnRight < viewLeft) {\n            return false;\n        }\n        if (columnLeft > viewRight) {\n            return false;\n        }\n        return true;\n    },\n\n    /** shortcut to the panel */\n    $panel: function $panel() {\n        return this.$(\".history-panel\");\n    },\n\n    // ------------------------------------------------------------------------ render\n    /** render ths column, its panel, and set up plugins */\n    render: function render(speed) {\n        speed = speed !== undefined ? speed : \"fast\";\n        //this.log( this + '.render', this.$el, this.el );\n        //TODO: not needed\n        var modelData = this.model ? this.model.toJSON() : {};\n        this.$el.html(this.template(modelData));\n        this.renderPanel(speed);\n        // jq 1.12 doesn't fade/show properly when display: flex, re-set here\n        this.panel.$el.css(\"display\", \"flex\");\n        // if model and not children\n        // template\n        // render controls\n        this.setUpBehaviors();\n        // add panel\n        return this;\n    },\n\n    /** set up plugins */\n    setUpBehaviors: function setUpBehaviors() {\n        //this.log( 'setUpBehaviors:', this );\n        // on panel size change, ...\n    },\n\n    /** column body template with inner div for panel based on data (model json) */\n    template: function template(data) {\n        data = _.extend(data || {}, {\n            isCurrentHistory: this.currentHistory\n        });\n        return $(\n            [\n                '<div class=\"panel-controls clear flex-row\">',\n                this.controlsLeftTemplate({\n                    history: data,\n                    view: this\n                }),\n                //'<button class=\"btn btn-default\">Herp</button>',\n                this.controlsRightTemplate({\n                    history: data,\n                    view: this\n                }),\n                \"</div>\",\n                '<div class=\"inner flex-row flex-column-container\">',\n                '<div id=\"history-',\n                data.id,\n                '\" class=\"history-column history-panel flex-column\"></div>',\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    /** render the panel contained in the column using speed for fx speed */\n    renderPanel: function renderPanel(speed) {\n        speed = speed !== undefined ? speed : \"fast\";\n        this.panel.setElement(this.$panel()).render(speed);\n        if (this.currentHistory) {\n            this.panel.$list().before(this.panel._renderDropTargetHelp());\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ behaviors and events\n    /** event map */\n    events: {\n        // will make this the current history\n        \"click .switch-to.btn\": function() {\n            this.model.setAsCurrent();\n        },\n        //TODO: remove boiler plate from next 3\n        \"click .delete-history\": function() {\n            this.model._delete().done(data => {\n                this.render();\n            });\n        },\n        \"click .undelete-history\": function() {\n            this.model.undelete().done(data => {\n                this.render();\n            });\n        },\n        \"click .purge-history\": function() {\n            if (confirm(_l(\"This will permanently remove the data. Are you sure?\"))) {\n                this.model.purge().done(data => {\n                    this.render();\n                });\n            }\n        },\n        // will copy this history and make the copy the current history\n        \"click .copy-history\": \"copy\"\n    },\n\n    // ------------------------------------------------------------------------ non-current controls\n    /** Open a modal to get a new history name, copy it (if not canceled), and makes the copy current */\n    copy: function copy() {\n        historyCopyDialog(this.model);\n    },\n\n    // ------------------------------------------------------------------------ templates\n    /** controls template displaying controls above the panel based on this.currentHistory */\n    controlsLeftTemplate: _.template(\n        [\n            '<div class=\"pull-left\">',\n            \"<% if( data.history.isCurrentHistory ){ %>\",\n            '<strong class=\"current-label\">',\n            _l(\"Current History\"),\n            \"</strong>\",\n            \"<% } else { %>\",\n            '<button class=\"switch-to btn btn-default\">',\n            _l(\"Switch to\"),\n            \"</button>\",\n            \"<% } %>\",\n            \"</div>\"\n        ].join(\"\"),\n        { variable: \"data\" }\n    ),\n\n    /** controls template displaying controls above the panel based on this.currentHistory */\n    controlsRightTemplate: _.template(\n        [\n            '<div class=\"pull-right\">',\n            \"<% if( !data.history.purged ){ %>\",\n            '<div class=\"panel-menu btn-group\">',\n            '<button type=\"button\" class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n            '<span class=\"caret\"></span>',\n            \"</button>\",\n            '<ul class=\"dropdown-menu pull-right\" role=\"menu\">',\n            \"<% if( !data.history.deleted ){ %>\",\n            '<li><a href=\"javascript:void(0);\" class=\"copy-history\">',\n            _l(\"Copy\"),\n            \"</a></li>\",\n            //'<li><a href=\"javascript:void(0);\" class=\"publish-history\">',\n            //    _l( 'Publish' ),\n            //'</a></li>',\n            '<li><a href=\"javascript:void(0);\" class=\"delete-history\">',\n            _l(\"Delete\"),\n            \"</a></li>\",\n            \"<% } else /* if is deleted */ { %>\",\n            '<li><a href=\"javascript:void(0);\" class=\"undelete-history\">',\n            _l(\"Undelete\"),\n            \"</a></li>\",\n            \"<% } %>\",\n            \"<% if( data.view.purgeAllowed ){ %>\",\n            '<li><a href=\"javascript:void(0);\" class=\"purge-history\">',\n            _l(\"Purge\"),\n            \"</a></li>\",\n            \"<% } %>\",\n            \"</ul>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"</div>\"\n        ].join(\"\"),\n        { variable: \"data\" }\n    ),\n\n    // ------------------------------------------------------------------------ misc\n    /** String rep */\n    toString: function() {\n        return `HistoryViewColumn(${this.panel ? this.panel : \"\"})`;\n    }\n});\n\n//==============================================================================\n/** @class A view of a HistoryCollection and displays histories similarly to the current history panel.\n */\nvar MultiPanelColumns = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    className: \"multi-panel-history\",\n\n    // ------------------------------------------------------------------------ set up\n    /** Set up internals, history collection, and columns to display the history */\n    initialize: function initialize(options) {\n        options = options || {};\n        this.log(`${this}.init`, options);\n\n        // add the className here (since we gen. pass the el in options)\n        this.$el.addClass(this.className);\n\n        // --- instance vars\n        //TODO: move these to some defaults\n        this.options = {\n            columnWidth: 312,\n            borderWidth: 1,\n            columnGap: 8,\n            headerHeight: 29,\n            footerHeight: 0,\n            controlsHeight: 20\n        };\n\n        /** how many histories to get when fetching a new batch/page */\n        this.perPage = options.perPage || 10;\n\n        /** named ajax queue for loading hdas */\n        this.hdaQueue = new ajaxQueue.NamedAjaxQueue([], false);\n\n        // --- set up models, sub-views, and listeners\n        /** the original unfiltered and unordered collection of histories */\n        this.collection = null;\n        /** model id to column map */\n        this.columnMap = {};\n        /** model id to column map */\n        this.columnOptions = options.columnOptions || {};\n\n        /** what to search for within all histories */\n        this.historySearch = null;\n        /** what to search for within all datasets */\n        this.datasetSearch = null;\n\n        this.setCollection(options.histories);\n        this.setUpListeners();\n    },\n\n    /** Set up reflexive listeners */\n    setUpListeners: function setUpListeners() {\n        //multipanel.log( 'setUpListeners', multipanel );\n        this.on(\"end-of-scroll\", () => {\n            this.collection.fetchMore();\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection\n    /** Set up a (new) history collection, sorting and adding listeners\n     *  @fires 'new-collection' when set with this view as the arg\n     */\n    setCollection: function setCollection(collection) {\n        // console.log( 'setCollection:', collection );\n        this.stopListening(this.collection);\n\n        this.collection = collection || new HISTORY_MODEL.HistoryCollection();\n        this.setUpCollectionListeners();\n\n        this.createColumns();\n        this.hdaQueue.clear();\n\n        this.trigger(\"new-collection\", this);\n        return this;\n    },\n\n    /** Set up a (new) history collection, sorting and adding listeners\n     *  @fires 'new-collection' when set with this view as the arg\n     */\n    addModels: function addModels(models, collection, options) {\n        // console.log( 'addModels:', models, collection, options );\n        options = options || {};\n        models = _.isArray(models) ? models : [models];\n        models.forEach(model => {\n            this.addColumn(model, false);\n            // if this is from a fetch, sort will be called and it will call render\n        });\n        return this;\n    },\n\n    /** Set up listeners for the collection - handling: added histories, change of current, deletion, and sorting */\n    setUpCollectionListeners: function() {\n        this.listenTo(this.collection, {\n            // handle ajax errors from the collection\n            error: this.errorHandler,\n            // add multiple models\n            add: this.addModels,\n            // when all the histories a user has have been fetched\n            \"all-fetched\": this._postFetchAll,\n            // handle addition of histories, triggered by column copy and create new\n            \"new-current\": this.addAsCurrentColumn,\n            // handle setting a history as current, triggered by history.setAsCurrent\n            \"set-as-current\": this.setCurrentHistory,\n            // handle deleting a history (depends on whether panels is including deleted or not)\n            \"change:deleted change:purged\": this.handleDeletedHistory,\n            // re-render columns after a sort\n            sort: function() {\n                this.renderColumns(0);\n            }\n        });\n    },\n\n    _postFetchAll: function(fetchData) {\n        // console.log( '_postFetchAll' );\n        this.$(\".histories-loading-indicator\").remove();\n        // when new histories is fetched and the indicator is not required,\n        // the panel will jump slightly left - totally aesthetic but jarring\n        // TODO: this probably would be best handled elsewhere during a refinement cycle (if any)\n        if (!this.historySearch) {\n            var $scrollContainer = this.$(\".outer-middle\");\n            $scrollContainer.scrollLeft($scrollContainer.scrollLeft() + 24);\n        }\n    },\n\n    /** Re-render and set currentHistoryId to reflect a new current history */\n    setCurrentHistory: function setCurrentHistory(history) {\n        this.log(\"setCurrentHistory:\", history);\n        var oldCurrentColumn = _.findWhere(this.columnMap, {\n            currentHistory: true\n        });\n        if (oldCurrentColumn) {\n            oldCurrentColumn.currentHistory = false;\n            oldCurrentColumn.$el.height(\"\");\n        }\n\n        var newCurrentColumn = this.columnMap[this.collection.currentHistoryId];\n        newCurrentColumn.currentHistory = true;\n        this.collection.sort();\n        this._recalcFirstColumnHeight();\n        return newCurrentColumn;\n    },\n\n    /** Either remove a deleted history or re-render it to show the deleted message\n     *      based on collection.includeDeleted\n     */\n    handleDeletedHistory: function handleDeletedHistory(history) {\n        if (history.get(\"deleted\") || history.get(\"purged\")) {\n            this.log(\"handleDeletedHistory\", this.collection.includeDeleted, history);\n            var column = this.columnMap[history.id];\n            if (!column) {\n                return;\n            }\n\n            // if it's the current column, create a new, empty history as the new current\n            if (column.model.id === this.collection.currentHistoryId) {\n                //TODO: figuring out the order of async here is tricky\n                //  - for now let the user handle the two step process\n                //multipanel.collection.create().done( function(){\n                //    if( !multipanel.collection.includeDeleted ){ multipanel.removeColumn( column, false ); }\n                //});\n            } else if (!this.collection.includeDeleted) {\n                this.removeColumn(column);\n            }\n        }\n    },\n\n    // ........................................................................ error handling\n    /** Event handler for errors (from the history collection mainly)\n     *  Alternately use two strings for model and xhr to use custom message and title (respectively)\n     *  (e.g. this.trigger( 'error', 'Heres a message', 'Heres a title' ))\n     *  @param {Model or View} model    the (Backbone) source of the error\n     *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n     *  @param {Object} options         the options map commonly used with bbone ajax\n     */\n    errorHandler: function(model, xhr, options) {\n        // interrupted ajax or no connection\n        if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n            // return ERROR_MODAL.offlineErrorModal();\n            // fail silently\n            return;\n        }\n        // otherwise, leave something to report in the console\n        this.error(model, xhr, options);\n        // and feedback to a modal\n        // if sent two strings (and possibly details as 'options'), use those as message and title\n        if (_.isString(model) && _.isString(xhr)) {\n            var message = model;\n            var title = xhr;\n            return ERROR_MODAL.errorModal(message, title, options);\n        }\n        // bad gateway\n        // TODO: possibly to global handler\n        if (xhr && xhr.status === 502) {\n            return ERROR_MODAL.badGatewayErrorModal();\n        }\n        return ERROR_MODAL.ajaxErrorModal(model, xhr, options);\n    },\n\n    /** If Galaxy object is available handle error there, otherwise, locally (and crudely) */\n    _ajaxErrorHandler: function() {\n        ERROR_MODAL.ajaxErrorModal.apply(null, _.toArray(arguments));\n    },\n\n    /** create a new history and set it to current */\n    create: function(ev) {\n        return this.collection.create({ current: true });\n    },\n\n    // ------------------------------------------------------------------------ columns\n    /** create columns from collection */\n    createColumns: function createColumns(models, columnOptions) {\n        columnOptions = columnOptions || this.options.columnOptions;\n        // clear column map\n        // TODO: make cummulative\n        this.columnMap = {};\n        this.collection.each((model, i) => {\n            this.columnMap[model.id] = this.createColumn(model, columnOptions);\n        });\n    },\n\n    /** create a column and its panel and set up any listeners to them */\n    createColumn: function createColumn(history, options) {\n        // options passed can be re-used, so extend them before adding the model to prevent pollution for the next\n        options = _.extend({}, options, {\n            model: history,\n            purgeAllowed: Galaxy.config.allow_user_dataset_purge\n        });\n        var column = new HistoryViewColumn(options);\n        if (history.id === this.collection.currentHistoryId) {\n            column.currentHistory = true;\n        }\n        this.setUpColumnListeners(column);\n        if (this.datasetSearch) {\n            column.panel.searchItems(this.datasetSearch);\n            this.queueHdaFetchDetails(column);\n        }\n        return column;\n    },\n\n    /** add a new column for history and render all columns if render is true */\n    addColumn: function add(history, render) {\n        render = render !== undefined ? render : true;\n        var newColumn = this.createColumn(history);\n        this.columnMap[history.id] = newColumn;\n        if (render) {\n            this.renderColumns();\n        }\n        return newColumn;\n    },\n\n    /** add a new column for history and make it the current history/column */\n    addAsCurrentColumn: function add(history, collection, options) {\n        var newColumn = this.addColumn(history, false);\n        this.setCurrentHistory(history);\n        newColumn.once(\"rendered\", () => {\n            this.queueHdaFetch(newColumn);\n        });\n        return newColumn;\n    },\n\n    /** remove the given column, it's listeners, and optionally render */\n    removeColumn: function remove(column, render) {\n        render = render !== undefined ? render : true;\n        this.log(\"removeColumn\", column);\n        if (!column) {\n            return;\n        }\n        var widthToRemove = this.options.columnWidth + this.options.columnGap;\n        column.$el.fadeOut(\"fast\", () => {\n            if (render) {\n                $(this).remove();\n                this.$(\".middle\").width(this.$(\".middle\").width() - widthToRemove);\n                this.checkColumnsInView();\n                this._recalcFirstColumnHeight();\n            }\n\n            //TODO: to freeColumn (where Columns have freePanel)\n            this.stopListening(column.panel);\n            this.stopListening(column);\n            delete this.columnMap[column.model.id];\n            column.remove();\n        });\n    },\n\n    /** set up listeners for a column and it's panel - handling: hda lazy-loading, drag and drop */\n    setUpColumnListeners: function setUpColumnListeners(column) {\n        this.listenTo(column, {\n            //'all': function(){ console.info( 'column ' + column + ':', arguments ) },\n            \"in-view\": this.queueHdaFetch\n        });\n\n        this.listenTo(column.panel, {\n            //'all': function(){ console.info( 'panel ' + column.panel + ':', arguments ) },\n\n            \"view:draggable:dragstart\": (ev, view, panel, column) => {\n                this._dropData = JSON.parse(ev.dataTransfer.getData(\"text\"));\n                this.currentColumnDropTargetOn();\n            },\n            \"view:draggable:dragend\": (ev, view, panel, column) => {\n                this._dropData = null;\n                this.currentColumnDropTargetOff();\n            },\n            \"droptarget:drop\": (ev, data, panel) => {\n                //note: bad copy sources fail silently\n                var toCopy = this._dropData.filter(json => panel.model.contents.isCopyable(json));\n                this._dropData = null;\n\n                var queue = new ajaxQueue.NamedAjaxQueue();\n                if (panel.model.contents.currentPage !== 0) {\n                    queue.add({\n                        name: \"fetch-front-page\",\n                        fn: function() {\n                            return panel.model.contents.fetchPage(0);\n                        }\n                    });\n                }\n                // need to reverse to better match expected order\n                // TODO: reconsider order in list-view._setUpItemViewListeners, dragstart (instead of here)\n                toCopy.reverse().forEach(content => {\n                    queue.add({\n                        name: `copy-${content.id}`,\n                        fn: function() {\n                            return panel.model.contents.copy(content);\n                        }\n                    });\n                });\n                queue.start();\n                queue.done(responses => {\n                    panel.model.fetch();\n                });\n            }\n        });\n    },\n\n    /** conv. fn to count the columns in columnMap */\n    columnMapLength: function() {\n        return Object.keys(this.columnMap).length;\n    },\n\n    /** return array of Columns filtered by filters and sorted to match the collection\n     *  @param: filters Function[] array of filter fns\n     */\n    sortedFilteredColumns: function(filters) {\n        filters = filters || this.filters;\n        if (!filters || !filters.length) {\n            return this.sortedColumns();\n        }\n        return this.sortedColumns().filter((column, index) => {\n            var filtered = column.currentHistory || _.every(filters.map(filter => filter.call(column)));\n            return filtered;\n        });\n    },\n\n    /** return array of Columns sorted to match the collection */\n    sortedColumns: function() {\n        var sorted = this.collection.map((history, index) => this.columnMap[history.id]);\n        return sorted;\n    },\n\n    // ------------------------------------------------------------------------ render\n    /** Render this view, columns, and set up view plugins */\n    render: function render(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n\n        this.log(`${this}.render`);\n        this.$el.html(this.mainTemplate(this));\n        this.renderColumns(speed);\n\n        // set the columns to full height allowed and set up behaviors for thie multipanel\n        this.setUpBehaviors();\n        //TODO: wrong - has to wait for columns to render\n        //  - create a column listener that fires this when all columns are rendered\n        this.trigger(\"rendered\", this);\n        return this;\n    },\n\n    /** Render the columns and panels */\n    renderColumns: function renderColumns(speed) {\n        speed = _.isNumber(speed) ? speed : this.fxSpeed;\n        // console.log( 'renderColumns:', speed );\n        // render columns and track the total number rendered, firing an event when all are rendered\n        var sortedAndFiltered = this.sortedFilteredColumns();\n        // console.log( '\\t sortedAndFiltered:', sortedAndFiltered );\n        var $middle = this.$(\".middle\").empty();\n\n        this._addColumns(sortedAndFiltered, speed);\n        if (!this.collection.allFetched) {\n            $middle.append(this.loadingIndicatorTemplate(this));\n        }\n        //TODO: sorta - at least their fx queue has started the re-rendering\n        this.trigger(\"columns-rendered\", sortedAndFiltered, this);\n\n        if (!this.datasetSearch || sortedAndFiltered.length > 1) {\n            // check for in-view, hda lazy-loading if so\n            this.checkColumnsInView();\n            // the first, current column has position: fixed and flex css will not apply - adjust height manually\n            this._recalcFirstColumnHeight();\n        }\n        return sortedAndFiltered;\n    },\n\n    _addColumns: function(columns, speed) {\n        speed = _.isNumber(speed) ? speed : this.fxSpeed;\n        var $middle = this.$(\".middle\");\n\n        var numExisting = $middle.children(\".history-column\").length;\n        $middle.width(this._calcMiddleWidth(columns.length + numExisting));\n\n        columns.forEach((column, i) => {\n            column\n                .delegateEvents()\n                .render(speed)\n                .$el.appendTo($middle);\n        });\n    },\n\n    _calcMiddleWidth: function(numColumns) {\n        var preventStackWidthAdj = 16;\n        return (\n            numColumns * (this.options.columnWidth + this.options.columnGap) +\n            // last column gap\n            this.options.columnGap +\n            // the amount that safely prevents stacking of columns when adding a new one\n            preventStackWidthAdj\n        );\n    },\n\n    //TODO: combine the following two more sensibly\n    //TODO: could have HistoryContents.haveDetails return false\n    //      if column.model.contents.length === 0 && !column.model.get( 'empty' ) then just check that\n    /** Get the *summary* contents of a column's history (and details on any expanded contents),\n     *      queueing the ajax call and using a named queue to prevent the call being sent twice\n     */\n    queueHdaFetch: function queueHdaFetch(column) {\n        // console.log( column.model + '.contentsShown:', column.model.contentsShown() );\n        var contents = column.model.contents;\n        // console.log( 'queueHdaFetch:', column, column.model.get( 'contents_active' ) );\n        // if the history model says it has hdas but none are present, queue an ajax req for them\n        if (contents.length === 0 && column.model.contentsShown()) {\n            var fetchOptions = { silent: true };\n            var ids = _.values(contents.storage.allExpanded()).join();\n            if (ids) {\n                fetchOptions.details = ids;\n            }\n            // this uses a 'named' queue so that duplicate requests are ignored\n            this.hdaQueue.add({\n                name: column.model.id,\n                fn: function() {\n                    return contents\n                        .fetchCurrentPage(fetchOptions)\n                        .done(() => {\n                            column.panel.renderItems();\n                        })\n                        .done(() => {\n                            if (!JOB_STATES_MODEL.FETCH_STATE_ON_ADD) {\n                                contents.jobStateSummariesCollection.fetch();\n                            }\n                        });\n                }\n            });\n            // the queue is re-used, so if it's not processing requests - start it again\n            if (!this.hdaQueue.running) {\n                this.hdaQueue.start();\n            }\n        }\n    },\n\n    /** Get the *detailed* json for *all* of a column's history's contents - req'd for searching */\n    queueHdaFetchDetails: function(column) {\n        var contents = column.model.contents;\n        var needsContentsLoaded = contents.length === 0 && column.model.contentsShown();\n        if (needsContentsLoaded || !contents.haveDetails()) {\n            // this uses a 'named' queue so that duplicate requests are ignored\n            this.hdaQueue.add({\n                name: column.model.id,\n                fn: function() {\n                    return contents.progressivelyFetchDetails().done(() => {\n                        column.panel._renderEmptyMessage();\n                    });\n                }\n            });\n            // the queue is re-used, so if it's not processing requests - start it again\n            if (!this.hdaQueue.running) {\n                this.hdaQueue.start();\n            }\n        }\n    },\n\n    /** put a text msg in the header */\n    renderInfo: function(msg) {\n        return this.$(\".header .header-info\").text(msg);\n    },\n\n    // ------------------------------------------------------------------------ events/behaviors\n    events: {\n        // will move to the server root (gen. Analyze data)\n        \"click .done.btn\": \"close\",\n        // creates a new empty history and makes it current\n        \"click .create-new.btn\": \"create\",\n        \"click #include-deleted\": \"_clickToggleDeletedHistories\",\n        // these change the collection and column sort order\n        \"click .order .set-order\": \"_chooseOrder\",\n        \"click #toggle-deleted\": \"_clickToggleDeletedDatasets\",\n        \"click #toggle-hidden\": \"_clickToggleHiddenDatasets\"\n        //'dragstart .list-item .title-bar'                       : function( e ){ console.debug( 'ok' ); }\n    },\n\n    close: function(ev) {\n        //TODO: switch to pushState/router\n        window.location = Galaxy.root;\n    },\n\n    _clickToggleDeletedHistories: function(ev) {\n        this.toggleDeletedHistories($(ev.currentTarget).is(\":checked\"));\n        this.toggleOptionsPopover();\n    },\n    /** Include deleted histories in the collection */\n    toggleDeletedHistories: function(show) {\n        if (show) {\n            window.location = `${Galaxy.root}history/view_multiple?include_deleted_histories=True`;\n        } else {\n            window.location = `${Galaxy.root}history/view_multiple`;\n        }\n    },\n\n    _clickToggleDeletedDatasets: function(ev) {\n        this.toggleDeletedDatasets($(ev.currentTarget).is(\":checked\"));\n        this.toggleOptionsPopover();\n    },\n    toggleDeletedDatasets: function(show) {\n        show = show !== undefined ? show : false;\n        this.sortedFilteredColumns().forEach((column, i) => {\n            _.delay(() => {\n                column.panel.toggleShowDeleted(show, false);\n            }, i * 200);\n        });\n    },\n\n    _clickToggleHiddenDatasets: function(ev) {\n        this.toggleHiddenDatasets($(ev.currentTarget).is(\":checked\"));\n        this.toggleOptionsPopover();\n    },\n    toggleHiddenDatasets: function(show) {\n        show = show !== undefined ? show : false;\n        this.sortedFilteredColumns().forEach((column, i) => {\n            _.delay(() => {\n                column.panel.toggleShowHidden(show, false);\n            }, i * 200);\n        });\n    },\n\n    /** change the collection order and re-fetch when the drop down in the options menu is changed */\n    _chooseOrder: function(ev) {\n        var collection = this.collection;\n        var orderKey = $(ev.currentTarget).data(\"order\");\n        // set the sort order text also\n        this.$(\".current-order\").text(this.orderDescriptions[orderKey]);\n        this.toggleOptionsPopover();\n        // set the order and re-fetch using the new order, saving the current history as the first\n        collection.setOrder(orderKey);\n        var currentHistoryModel = collection.slice(0, 1);\n        collection.fetchFirst().done(() => {\n            collection.unshift(currentHistoryModel, {\n                silent: true\n            });\n            this.createColumns();\n            // need to clear this or previously fetched contents won't refetch now (bc of named queue)\n            this.hdaQueue.clear();\n            this.render();\n        });\n        this.once(\"columns-rendered\", this._scrollLeft);\n        //TODO: check allFetched and do not reset if so - just sort instead\n    },\n\n    /** scroll the column container right or left */\n    _scrollLeft: function(val) {\n        val = _.isNumber(val) ? val : 0;\n        this.$(\".outer-middle\").scrollLeft(val);\n    },\n\n    /** Set up any view plugins */\n    setUpBehaviors: function() {\n        this._moreOptionsPopover();\n\n        // input to search histories\n        this.$(\"#search-histories\").searchInput({\n            name: \"search-histories\",\n            placeholder: _l(\"search histories\"),\n\n            onfirstsearch: searchFor => {\n                this.$(\"#search-histories\").searchInput(\"toggle-loading\");\n                this.renderInfo(_l(\"loading all histories for search\"));\n                this.collection.fetchAll().done(() => {\n                    this.$(\"#search-histories\").searchInput(\"toggle-loading\");\n                    this.renderInfo(\"\");\n                });\n            },\n            onsearch: searchFor => {\n                this.historySearch = searchFor;\n                this.filters = [\n                    () => {\n                        return this.model.matchesAll(this.historySearch);\n                    }\n                ];\n                this.renderColumns(0);\n            },\n            onclear: searchFor => {\n                this.historySearch = null;\n                //TODO: remove specifically not just reset\n                this.filters = [];\n                this.renderColumns(0);\n            }\n        });\n\n        // input to search datasets\n        this.$(\"#search-datasets\").searchInput({\n            name: \"search-datasets\",\n            placeholder: _l(\"search all datasets\"),\n\n            onfirstsearch: searchFor => {\n                this.hdaQueue.clear();\n                this.$(\"#search-datasets\").searchInput(\"toggle-loading\");\n                this.datasetSearch = searchFor;\n                this.sortedFilteredColumns().forEach(column => {\n                    column.panel.searchItems(searchFor);\n                    // load details for them that need\n                    this.queueHdaFetchDetails(column);\n                });\n                this.hdaQueue.progress(progress => {\n                    this.renderInfo([_l(\"searching\"), progress.curr + 1, _l(\"of\"), progress.total].join(\" \"));\n                });\n                this.hdaQueue.deferred.done(() => {\n                    this.renderInfo(\"\");\n                    this.$(\"#search-datasets\").searchInput(\"toggle-loading\");\n                });\n            },\n            onsearch: searchFor => {\n                this.datasetSearch = searchFor;\n                this.sortedFilteredColumns().forEach(column => {\n                    column.panel.searchItems(searchFor);\n                });\n            },\n            onclear: searchFor => {\n                this.datasetSearch = null;\n                this.sortedFilteredColumns().forEach(column => {\n                    column.panel.clearSearch();\n                });\n            }\n        });\n\n        // resize first (fixed position) column on page resize\n        $(window).resize(() => {\n            this._recalcFirstColumnHeight();\n        });\n\n        // when scrolling - check for histories now in view: they will fire 'in-view' and queueHdaLoading if necc.\n        //TODO:?? might be able to simplify and not use pub-sub\n        var debouncedInView = _.debounce(() => {\n            var viewport = this._viewport();\n            this.checkColumnsInView(viewport);\n            this.checkForEndOfScroll(viewport);\n        }, 100);\n        this.$(\".middle\")\n            .parent()\n            .scroll(debouncedInView);\n    },\n\n    /** create the options popover */\n    _moreOptionsPopover: function() {\n        return this.$(\".open-more-options.btn\").popover({\n            container: \".header\",\n            placement: \"bottom\",\n            html: true,\n            content: $(this.optionsPopoverTemplate(this))\n        });\n    },\n\n    /** change the collection order and re-fetch when the drop down in the options menu is changed */\n    toggleOptionsPopover: function(ev) {\n        // hide seems broken in our version\n        this.$(\".open-more-options.btn\").popover(\"toggle\");\n    },\n\n    /** Adjust the height of the first, current column since flex-boxes won't work with fixed postiion elements */\n    _recalcFirstColumnHeight: function() {\n        var $firstColumn = this.$(\".history-column\").first();\n        var middleHeight = this.$(\".middle\").height();\n        var controlHeight = $firstColumn.find(\".panel-controls\").height();\n        $firstColumn\n            .height(middleHeight)\n            .find(\".inner\")\n            .height(middleHeight - controlHeight);\n    },\n\n    /** Get the left and right pixel coords of the middle element */\n    _viewport: function() {\n        var $outerMiddle = this.$(\".middle\").parent();\n        var viewLeft = $outerMiddle.offset().left;\n        var width = $outerMiddle.width();\n        return {\n            left: viewLeft,\n            right: viewLeft + width\n        };\n    },\n\n    /** returns the columns currently in the viewport */\n    columnsInView: function(viewport) {\n        //TODO: uses offset which is render intensive\n        //TODO: 2N - could use arg filter (sortedFilteredColumns( filter )) instead\n        var vp = viewport || this._viewport();\n        return this.sortedFilteredColumns().filter(column => column.currentHistory || column.inView(vp.left, vp.right));\n    },\n\n    //TODO: sortByInView - return cols in view, then others\n    /** trigger in-view from columns in-view */\n    checkColumnsInView: function() {\n        //TODO: assbackward - don't fire from the column, fire from here and listen from here\n        this.columnsInView().forEach(column => {\n            column.trigger(\"in-view\", column);\n        });\n    },\n\n    /** is the middle, horizontally scrolling section scrolled fully to the right? */\n    checkForEndOfScroll: function(viewport) {\n        viewport = viewport || this._viewport();\n        var END_PADDING = 16;\n        var $middle = this.$(\".middle\");\n        var scrollRight = $middle.parent().scrollLeft() + viewport.right;\n        if (scrollRight >= $middle.width() - END_PADDING) {\n            this.trigger(\"end-of-scroll\");\n        }\n    },\n\n    /** Show and enable the current columns drop target */\n    currentColumnDropTargetOn: function() {\n        var currentColumn = this.columnMap[this.collection.currentHistoryId];\n        if (!currentColumn) {\n            return;\n        }\n        //TODO: fix this - shouldn't need monkeypatch\n        currentColumn.panel.dataDropped = data => {};\n        currentColumn.panel.dropTargetOn();\n    },\n\n    /** Hide and disable the current columns drop target */\n    currentColumnDropTargetOff: function() {\n        var currentColumn = this.columnMap[this.collection.currentHistoryId];\n        if (!currentColumn) {\n            return;\n        }\n        currentColumn.panel.dataDropped = HISTORY_VIEW_EDIT.HistoryViewEdit.prototype.dataDrop;\n        // slight override of dropTargetOff to not erase drop-target-help\n        currentColumn.panel.dropTarget = false;\n        currentColumn.panel.$(\".history-drop-target\").remove();\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** String rep */\n    toString: function() {\n        return `MultiPanelColumns(${this.columns ? this.columns.length : 0})`;\n    },\n\n    // ------------------------------------------------------------------------ templates\n    mainTemplate: _.template(\n        [\n            '<div class=\"header flex-column-container\">',\n            '<div class=\"control-column control-column-left flex-column\">',\n            '<button class=\"done btn btn-default\" tabindex=\"1\">',\n            _l(\"Done\"),\n            \"</button>\",\n            '<div id=\"search-histories\" class=\"search-control\"></div>',\n            '<div id=\"search-datasets\" class=\"search-control\"></div>',\n            '<a class=\"open-more-options btn btn-default\" tabindex=\"3\">',\n            '<span class=\"fa fa-ellipsis-h\"></span>',\n            \"</a>\",\n            \"</div>\",\n            // feedback\n            '<div class=\"control-column control-column-center flex-column\">',\n            '<div class=\"header-info\">',\n            \"</div>\",\n            \"</div>\",\n            '<div class=\"control-column control-column-right flex-column\">',\n            '<button class=\"create-new btn btn-default\" tabindex=\"4\">',\n            _l(\"Create new\"),\n            \"</button> \",\n            \"</div>\",\n            \"</div>\",\n            // middle - where the columns go\n            '<div class=\"outer-middle flex-row flex-row-container\">',\n            '<div class=\"middle flex-column-container flex-row\"></div>',\n            \"</div>\",\n            // footer\n            '<div class=\"footer flex-column-container\"></div>'\n        ].join(\"\"),\n        { variable: \"view\" }\n    ),\n\n    loadingIndicatorTemplate: _.template(\n        [\n            '<div class=\"histories-loading-indicator\">',\n            '<span class=\"fa fa-spin fa-spinner\"></span>',\n            _l(\"Loading histories\"),\n            \"...\",\n            \"</div>\"\n        ].join(\"\"),\n        { variable: \"view\" }\n    ),\n\n    orderDescriptions: {\n        update_time: _l(\"most recent first\"),\n        \"update_time-asc\": _l(\"least recent first\"),\n        name: _l(\"name, a to z\"),\n        \"name-dsc\": _l(\"name, z to a\"),\n        size: _l(\"size, large to small\"),\n        \"size-asc\": _l(\"size, small to large\")\n    },\n\n    optionsPopoverTemplate: _.template(\n        [\n            '<div class=\"more-options\">',\n            '<div class=\"order btn-group\">',\n            '<button type=\"button\" class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n            `${_l(\"Order histories by\")} `,\n            '<span class=\"current-order\"><%- view.orderDescriptions[ view.collection.order ] %></span> ',\n            '<span class=\"caret\"></span>',\n            \"</button>\",\n            '<ul class=\"dropdown-menu\" role=\"menu\">',\n            \"<% _.each( view.orderDescriptions, function( text, order ){ %>\",\n            '<li><a href=\"javascript:void(0);\" class=\"set-order\" data-order=\"<%- order %>\">',\n            \"<%- text %>\",\n            \"</a></li>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\",\n\n            '<div class=\"checkbox\"><label><input id=\"include-deleted\" type=\"checkbox\"',\n            '<%= view.collection.includeDeleted? \" checked\" : \"\" %>>',\n            _l(\"Include deleted histories\"),\n            \"</label></div>\",\n\n            \"<hr />\",\n\n            '<div class=\"checkbox\"><label><input id=\"toggle-deleted\" type=\"checkbox\">',\n            _l(\"Include deleted datasets\"),\n            \"</label></div>\",\n            '<div class=\"checkbox\"><label><input id=\"toggle-hidden\" type=\"checkbox\">',\n            _l(\"Include hidden datasets\"),\n            \"</label></div>\",\n            \"</div>\"\n        ].join(\"\"),\n        { variable: \"view\" }\n    )\n});\n\n//==============================================================================\nexport default {\n    MultiPanelColumns: MultiPanelColumns\n};\n"]}
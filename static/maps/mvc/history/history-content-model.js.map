{"version":3,"sources":["mvc/history/history-content-model.js"],"names":["collectionFuzzyCountDefault","localStorage","getItem","err","HistoryContentMixin","defaults","history_id","history_content_type","hid","visible","idAttribute","hidden","get","isVisible","includeDeleted","includeHidden","urlRoot","Galaxy","root","url","historyContentType","historyId","historyContentId","hide","options","jQuery","when","save","unhide","toString","join"],"mappings":";;;;;;;;;;;;;;;;;;;AAIA,QAAIA,8BAA8B,IAAlC;AACA,QAAI;AACAA,sCAA8BC,aAAaC,OAAb,CAAqB,6BAArB,KAAuDF,2BAArF;AACH,KAFD,CAEE,OAAOG,GAAP,EAAY,CAAE;;AAEhB;AACA;;AAEA,QAAIC,sBAAsB;AACtB;AACAC,kBAAU;AACN;AACAC,wBAAY,IAFN;AAGN;AACAC,kCAAsB,IAJhB;AAKN;AACAC,iBAAK,IANC;AAON;AACAC,qBAAS;AARH,SAFY;;AAatB;AACA;AACA;AACA;AACAC,qBAAa,SAjBS;;AAmBtB;AACA;AACAC,gBAAQ,kBAAW;AACf,mBAAO,CAAC,KAAKC,GAAL,CAAS,SAAT,CAAR;AACH,SAvBqB;;AAyBtB;AACA;;;;;AAKAC,mBAAW,mBAASC,cAAT,EAAyBC,aAAzB,EAAwC;AAC/C,gBAAIF,YAAY,IAAhB;AACA,gBAAI,CAACC,cAAD,KAAoB,KAAKF,GAAL,CAAS,SAAT,KAAuB,KAAKA,GAAL,CAAS,QAAT,CAA3C,CAAJ,EAAoE;AAChEC,4BAAY,KAAZ;AACH;AACD,gBAAI,CAACE,aAAD,IAAkB,CAAC,KAAKH,GAAL,CAAS,SAAT,CAAvB,EAA4C;AACxCC,4BAAY,KAAZ;AACH;AACD,mBAAOA,SAAP;AACH,SAxCqB;;AA0CtB;AACA;AACA;AACAG,iBAAYC,OAAOC,IAAnB,mBA7CsB;;AA+CtB;AACAC,aAAK,eAAW;AACZ,gBAAIC,qBAAqB,KAAKR,GAAL,CAAS,sBAAT,CAAzB;AACA,gBAAIS,YAAY,KAAKT,GAAL,CAAS,YAAT,CAAhB;AACA,gBAAIU,mBAAmB,KAAKV,GAAL,CAAS,IAAT,CAAvB;AACA,gBAAIO,WAAS,KAAKH,OAAd,GAAwBK,SAAxB,kBAA8CD,kBAA9C,UAAqEE,gBAAzE;AACA,gBAAIF,sBAAsB,oBAA1B,EAAgD;AAC5C;AACA;AACAD,sBAASA,GAAT,4CAAmDnB,2BAAnD;AACH;AACD,mBAAOmB,GAAP;AACH,SA3DqB;;AA6DtB;AACAI,cAAM,cAASC,OAAT,EAAkB;AACpB,gBAAI,CAAC,KAAKZ,GAAL,CAAS,SAAT,CAAL,EAA0B;AACtB,uBAAOa,OAAOC,IAAP,EAAP;AACH;AACD,mBAAO,KAAKC,IAAL,CAAU,EAAElB,SAAS,KAAX,EAAV,EAA8Be,OAA9B,CAAP;AACH,SAnEqB;AAoEtB;AACAI,gBAAQ,gBAASJ,OAAT,EAAkB;AACtB,gBAAI,KAAKZ,GAAL,CAAS,SAAT,CAAJ,EAAyB;AACrB,uBAAOa,OAAOC,IAAP,EAAP;AACH;AACD,mBAAO,KAAKC,IAAL,CAAU,EAAElB,SAAS,IAAX,EAAV,EAA6Be,OAA7B,CAAP;AACH,SA1EqB;;AA4EtB;AACAK,kBAAU,oBAAW;AACjB,mBAAO,CAAC,KAAKjB,GAAL,CAAS,SAAT,CAAD,EAAsB,KAAKA,GAAL,CAAS,KAAT,CAAtB,EAAuC,KAAKA,GAAL,CAAS,MAAT,CAAvC,EAAyDkB,IAAzD,CAA8D,GAA9D,CAAP;AACH;AA/EqB,KAA1B;;AAkFA;sBACe;AACX1B,6BAAqBA;AADV,K","file":"../../../scripts/mvc/history/history-content-model.js","sourcesContent":["import STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar collectionFuzzyCountDefault = 1000;\ntry {\n    collectionFuzzyCountDefault = localStorage.getItem(\"collectionFuzzyCountDefault\") || collectionFuzzyCountDefault;\n} catch (err) {}\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n    /** default attributes for a model */\n    defaults: {\n        /** parent (containing) history */\n        history_id: null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid: null,\n        /** whether the user wants the content shown (visible) */\n        visible: true\n    },\n\n    // ........................................................................ mixed content element\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Instead, use type_id which prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute: \"type_id\",\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden: function() {\n        return !this.get(\"visible\");\n    },\n\n    //TODO: remove\n    /** based on includeDeleted, includeHidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} includeDeleted are we showing deleted hdas?\n     *  @param {Boolean} includeHidden are we showing hidden hdas?\n     */\n    isVisible: function(includeDeleted, includeHidden) {\n        var isVisible = true;\n        if (!includeDeleted && (this.get(\"deleted\") || this.get(\"purged\"))) {\n            isVisible = false;\n        }\n        if (!includeHidden && !this.get(\"visible\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n    //TODO?: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: `${Galaxy.root}api/histories/`,\n\n    /** full url spec. for this content */\n    url: function() {\n        var historyContentType = this.get(\"history_content_type\");\n        var historyId = this.get(\"history_id\");\n        var historyContentId = this.get(\"id\");\n        var url = `${this.urlRoot}${historyId}/contents/${historyContentType}s/${historyContentId}`;\n        if (historyContentType == \"dataset_collection\") {\n            // Don't fetch whole collection - just enought to render outline. Backbone will\n            // make a detailed request if any datasets are expanded beyond that point.\n            url = `${url}?view=element-reference&fuzzy_count=${collectionFuzzyCountDefault}`;\n        }\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide: function(options) {\n        if (!this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: false }, options);\n    },\n    /** save this content as visible */\n    unhide: function(options) {\n        if (this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: true }, options);\n    },\n\n    // ........................................................................ misc\n    toString: function() {\n        return [this.get(\"type_id\"), this.get(\"hid\"), this.get(\"name\")].join(\":\");\n    }\n};\n\n//==============================================================================\nexport default {\n    HistoryContentMixin: HistoryContentMixin\n};\n"]}
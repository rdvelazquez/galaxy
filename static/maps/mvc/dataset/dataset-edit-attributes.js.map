{"version":3,"sources":["mvc/dataset/dataset-edit-attributes.js"],"names":["View","Backbone","extend","initialize","setElement","model","Model","dataset_id","Galaxy","params","message","Message","persistent","tabs","_createTabs","$el","append","$","hide","render","self","ajax","url","root","get","success","response","initial_message","update","_","each","forms","form","key","set","show","error","err_msg","responseJSON","status","_submit","operation","data","create","type","_reloadHistory","attribute","_getAttribute","conversion","_getConversion","datatype","_getDatatype","permission","_getPermission","add","id","title","icon","tooltip","operations","submit_attributes","ButtonIcon","onclick","submit_autodetect","submit_conversion","submit_datatype","submit_permission","window","currHistoryPanel","loadCurrentHistory"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AACA;AAKA,QAAIA,OAAOC,SAASD,IAAT,CAAcE,MAAd,CAAqB;AAC5BC,oBAAY,sBAAW;AACnB,iBAAKC,UAAL,CAAgB,QAAhB;AACA,iBAAKC,KAAL,GAAa,IAAIJ,SAASK,KAAb,CAAmB;AAC5BC,4BAAYC,OAAOC,MAAP,CAAcF;AADE,aAAnB,CAAb;AAGA,iBAAKG,OAAL,GAAe,IAAI,iBAAGC,OAAP,CAAe,EAAEC,YAAY,IAAd,EAAf,CAAf;AACA,iBAAKC,IAAL,GAAY,KAAKC,WAAL,EAAZ;AACA,iBAAKC,GAAL,CACKC,MADL,CACYC,EAAE,OAAF,EAAWD,MAAX,CAAkB,yBAAlB,CADZ,EAEKA,MAFL,CAEY,KAAKN,OAAL,CAAaK,GAFzB,EAGKC,MAHL,CAGY,MAHZ,EAIKA,MAJL,CAIY,KAAKH,IAAL,CAAUE,GAJtB,EAKKG,IALL;AAMA,iBAAKC,MAAL;AACH,SAf2B;;AAiB5B;AACAA,gBAAQ,kBAAW;AACf,gBAAIC,OAAO,IAAX;AACAH,cAAEI,IAAF,CAAO;AACHC,qBAAQd,OAAOe,IAAf,oCAAkDH,KAAKf,KAAL,CAAWmB,GAAX,CAAe,YAAf,CAD/C;AAEHC,yBAAS,iBAASC,QAAT,EAAmB;AACxB,qBAACN,KAAKO,eAAN,IAAyBP,KAAKV,OAAL,CAAakB,MAAb,CAAoBF,QAApB,CAAzB;AACAN,yBAAKO,eAAL,GAAuB,IAAvB;AACAE,sBAAEC,IAAF,CAAOV,KAAKW,KAAZ,EAAmB,UAACC,IAAD,EAAOC,GAAP,EAAe;AAC9BD,6BAAK3B,KAAL,CAAW6B,GAAX,CAAe,QAAf,EAAyBR,SAAYO,GAAZ,aAAzB;AACAD,6BAAK3B,KAAL,CAAW6B,GAAX,CAAe,iBAAf,EAAkCR,SAAYO,GAAZ,cAAlC;AACAD,6BAAKb,MAAL;AACH,qBAJD;AAKAC,yBAAKL,GAAL,CAASoB,IAAT;AACH,iBAXE;AAYHC,uBAAO,eAASV,QAAT,EAAmB;AACtB,wBAAIW,UAAUX,SAASY,YAAT,IAAyBZ,SAASY,YAAT,CAAsBD,OAA7D;AACAjB,yBAAKV,OAAL,CAAakB,MAAb,CAAoB;AAChBW,gCAAQ,QADQ;AAEhB7B,iCAAS2B,WAAW;AAFJ,qBAApB;AAIH;AAlBE,aAAP;AAoBH,SAxC2B;;AA0C5B;AACAG,iBAAS,iBAASC,SAAT,EAAoBT,IAApB,EAA0B;AAC/B,gBAAIZ,OAAO,IAAX;AACA,gBAAIsB,OAAOV,KAAKU,IAAL,CAAUC,MAAV,EAAX;AACAD,iBAAKnC,UAAL,GAAkB,KAAKF,KAAL,CAAWmB,GAAX,CAAe,YAAf,CAAlB;AACAkB,iBAAKD,SAAL,GAAiBA,SAAjB;AACAxB,cAAEI,IAAF,CAAO;AACHuB,sBAAM,KADH;AAEHtB,qBAAQd,OAAOe,IAAf,qBAFG;AAGHmB,sBAAMA,IAHH;AAIHjB,yBAAS,iBAASC,QAAT,EAAmB;AACxBN,yBAAKV,OAAL,CAAakB,MAAb,CAAoBF,QAApB;AACAN,yBAAKD,MAAL;AACAC,yBAAKyB,cAAL;AACH,iBARE;AASHT,uBAAO,eAASV,QAAT,EAAmB;AACtB,wBAAIW,UAAUX,SAASY,YAAT,IAAyBZ,SAASY,YAAT,CAAsBD,OAA7D;AACAjB,yBAAKV,OAAL,CAAakB,MAAb,CAAoB;AAChBW,gCAAQ,QADQ;AAEhB7B,iCAAS2B,WAAW;AAFJ,qBAApB;AAIH;AAfE,aAAP;AAiBH,SAjE2B;;AAmE5B;AACAvB,qBAAa,uBAAW;AACpB,iBAAKiB,KAAL,GAAa;AACTe,2BAAW,KAAKC,aAAL,EADF;AAETC,4BAAY,KAAKC,cAAL,EAFH;AAGTC,0BAAU,KAAKC,YAAL,EAHD;AAITC,4BAAY,KAAKC,cAAL;AAJH,aAAb;AAMA,gBAAIxC,OAAO,IAAI,iBAAKb,IAAT,EAAX;AACAa,iBAAKyC,GAAL,CAAS;AACLC,oBAAI,WADC;AAELC,uBAAO,4BAAG,YAAH,CAFF;AAGLC,sBAAM,YAHD;AAILC,yBAAS,4BAAG,yBAAH,CAJJ;AAKL3C,qBAAK,KAAKgB,KAAL,CAAWe,SAAX,CAAqB/B;AALrB,aAAT;AAOAF,iBAAKyC,GAAL,CAAS;AACLC,oBAAI,SADC;AAELC,uBAAO,4BAAG,SAAH,CAFF;AAGLC,sBAAM,SAHD;AAILC,yBAAS,4BAAG,uBAAH,CAJJ;AAKL3C,qBAAK,KAAKgB,KAAL,CAAWiB,UAAX,CAAsBjC;AALtB,aAAT;AAOAF,iBAAKyC,GAAL,CAAS;AACLC,oBAAI,UADC;AAELC,uBAAO,4BAAG,WAAH,CAFF;AAGLC,sBAAM,aAHD;AAILC,yBAAS,4BAAG,kBAAH,CAJJ;AAKL3C,qBAAK,KAAKgB,KAAL,CAAWmB,QAAX,CAAoBnC;AALpB,aAAT;AAOAF,iBAAKyC,GAAL,CAAS;AACLC,oBAAI,aADC;AAELC,uBAAO,4BAAG,aAAH,CAFF;AAGLC,sBAAM,SAHD;AAILC,yBAAS,4BAAG,aAAH,CAJJ;AAKL3C,qBAAK,KAAKgB,KAAL,CAAWqB,UAAX,CAAsBrC;AALtB,aAAT;AAOA,mBAAOF,IAAP;AACH,SAzG2B;;AA2G5B;AACAkC,uBAAe,yBAAW;AACtB,gBAAI3B,OAAO,IAAX;AACA,gBAAIY,OAAO,uBAAS;AAChBwB,uBAAO,4BAAG,iBAAH,CADS;AAEhBG,4BAAY;AACRC,uCAAmB,IAAI,iBAAGC,UAAP,CAAkB;AACjCH,iCAAS,4BAAG,iCAAH,CADwB;AAEjCD,8BAAM,aAF2B;AAGjCD,+BAAO,4BAAG,MAAH,CAH0B;AAIjCM,iCAAS,mBAAW;AAChB1C,iCAAKoB,OAAL,CAAa,YAAb,EAA2BR,IAA3B;AACH;AANgC,qBAAlB,CADX;AASR+B,uCAAmB,IAAI,iBAAGF,UAAP,CAAkB;AACjCH,iCACI,qGAF6B;AAGjCD,8BAAM,SAH2B;AAIjCD,+BAAO,aAJ0B;AAKjCM,iCAAS,mBAAW;AAChB1C,iCAAKoB,OAAL,CAAa,YAAb,EAA2BR,IAA3B;AACH;AAPgC,qBAAlB;AATX;AAFI,aAAT,CAAX;AAsBA,mBAAOA,IAAP;AACH,SArI2B;;AAuI5B;AACAiB,wBAAgB,0BAAW;AACvB,gBAAI7B,OAAO,IAAX;AACA,gBAAIY,OAAO,uBAAS;AAChBwB,uBAAO,4BAAG,uBAAH,CADS;AAEhBG,4BAAY;AACRK,uCAAmB,IAAI,iBAAGH,UAAP,CAAkB;AACjCH,iCAAS,4BAAG,uCAAH,CADwB;AAEjCF,+BAAO,4BAAG,kBAAH,CAF0B;AAGjCC,8BAAM,aAH2B;AAIjCK,iCAAS,mBAAW;AAChB1C,iCAAKoB,OAAL,CAAa,YAAb,EAA2BR,IAA3B;AACH;AANgC,qBAAlB;AADX;AAFI,aAAT,CAAX;AAaA,mBAAOA,IAAP;AACH,SAxJ2B;;AA0J5B;AACAmB,sBAAc,wBAAW;AACrB,gBAAI/B,OAAO,IAAX;AACA,gBAAIY,OAAO,uBAAS;AAChBwB,uBAAO,4BAAG,iBAAH,CADS;AAEhBG,4BAAY;AACRM,qCAAiB,IAAI,iBAAGJ,UAAP,CAAkB;AAC/BH,iCAAS,4BAAG,oCAAH,CADsB;AAE/BF,+BAAO,4BAAG,iBAAH,CAFwB;AAG/BC,8BAAM,aAHyB;AAI/BK,iCAAS,mBAAW;AAChB1C,iCAAKoB,OAAL,CAAa,UAAb,EAAyBR,IAAzB;AACH;AAN8B,qBAAlB;AADT;AAFI,aAAT,CAAX;AAaA,mBAAOA,IAAP;AACH,SA3K2B;;AA6K5B;AACAqB,wBAAgB,0BAAW;AACvB,gBAAIjC,OAAO,IAAX;AACA,gBAAIY,OAAO,uBAAS;AAChBwB,uBAAO,4BAAG,4BAAH,CADS;AAEhBG,4BAAY;AACRO,uCAAmB,IAAI,iBAAGL,UAAP,CAAkB;AACjCH,iCAAS,4BAAG,mBAAH,CADwB;AAEjCF,+BAAO,4BAAG,kBAAH,CAF0B;AAGjCC,8BAAM,cAH2B;AAIjCK,iCAAS,mBAAW;AAChB1C,iCAAKoB,OAAL,CAAa,YAAb,EAA2BR,IAA3B;AACH;AANgC,qBAAlB;AADX;AAFI,aAAT,CAAX;AAaA,mBAAOA,IAAP;AACH,SA9L2B;;AAgM5B;AACAa,wBAAgB,0BAAW;AACvB,gBAAIsB,OAAO3D,MAAX,EAAmB;AACf2D,uBAAO3D,MAAP,CAAc4D,gBAAd,CAA+BC,kBAA/B;AACH;AACJ;AArM2B,KAArB,CAAX;;sBAwMe;AACXrE,cAAMA;AADK,K","file":"../../../scripts/mvc/dataset/dataset-edit-attributes.js","sourcesContent":["import _l from \"utils/localization\";\n/** Dataset edit attributes view */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nvar View = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.message = new Ui.Message({ persistent: true });\n        this.tabs = this._createTabs();\n        this.$el\n            .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n            .append(this.message.$el)\n            .append(\"<p/>\")\n            .append(this.tabs.$el)\n            .hide();\n        this.render();\n    },\n\n    /** fetch data for the selected dataset and build forms */\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: `${Galaxy.root}dataset/get_edit?dataset_id=${self.model.get(\"dataset_id\")}`,\n            success: function(response) {\n                !self.initial_message && self.message.update(response);\n                self.initial_message = true;\n                _.each(self.forms, (form, key) => {\n                    form.model.set(\"inputs\", response[`${key}_inputs`]);\n                    form.model.set(\"hide_operations\", response[`${key}_disable`]);\n                    form.render();\n                });\n                self.$el.show();\n            },\n            error: function(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while loading the dataset.\"\n                });\n            }\n        });\n    },\n\n    /** submit data to backend to update attributes */\n    _submit: function(operation, form) {\n        var self = this;\n        var data = form.data.create();\n        data.dataset_id = this.model.get(\"dataset_id\");\n        data.operation = operation;\n        $.ajax({\n            type: \"PUT\",\n            url: `${Galaxy.root}dataset/set_edit`,\n            data: data,\n            success: function(response) {\n                self.message.update(response);\n                self.render();\n                self._reloadHistory();\n            },\n            error: function(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while editing the dataset attributes.\"\n                });\n            }\n        });\n    },\n\n    /** create tabs for different dataset attribute categories*/\n    _createTabs: function() {\n        this.forms = {\n            attribute: this._getAttribute(),\n            conversion: this._getConversion(),\n            datatype: this._getDatatype(),\n            permission: this._getPermission()\n        };\n        var tabs = new Tabs.View();\n        tabs.add({\n            id: \"attribute\",\n            title: _l(\"Attributes\"),\n            icon: \"fa fa-bars\",\n            tooltip: _l(\"Edit dataset attributes\"),\n            $el: this.forms.attribute.$el\n        });\n        tabs.add({\n            id: \"convert\",\n            title: _l(\"Convert\"),\n            icon: \"fa-gear\",\n            tooltip: _l(\"Convert to new format\"),\n            $el: this.forms.conversion.$el\n        });\n        tabs.add({\n            id: \"datatype\",\n            title: _l(\"Datatypes\"),\n            icon: \"fa-database\",\n            tooltip: _l(\"Change data type\"),\n            $el: this.forms.datatype.$el\n        });\n        tabs.add({\n            id: \"permissions\",\n            title: _l(\"Permissions\"),\n            icon: \"fa-user\",\n            tooltip: _l(\"Permissions\"),\n            $el: this.forms.permission.$el\n        });\n        return tabs;\n    },\n\n    /** edit main attributes form */\n    _getAttribute: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Edit attributes\"),\n            operations: {\n                submit_attributes: new Ui.ButtonIcon({\n                    tooltip: _l(\"Save attributes of the dataset.\"),\n                    icon: \"fa-floppy-o\",\n                    title: _l(\"Save\"),\n                    onclick: function() {\n                        self._submit(\"attributes\", form);\n                    }\n                }),\n                submit_autodetect: new Ui.ButtonIcon({\n                    tooltip:\n                        \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                    icon: \"fa-undo\",\n                    title: \"Auto-detect\",\n                    onclick: function() {\n                        self._submit(\"autodetect\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** datatype conversion form */\n    _getConversion: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Convert to new format\"),\n            operations: {\n                submit_conversion: new Ui.ButtonIcon({\n                    tooltip: _l(\"Convert the datatype to a new format.\"),\n                    title: _l(\"Convert datatype\"),\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"conversion\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** change datatype form */\n    _getDatatype: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Change datatype\"),\n            operations: {\n                submit_datatype: new Ui.ButtonIcon({\n                    tooltip: _l(\"Change the datatype to a new type.\"),\n                    title: _l(\"Change datatype\"),\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"datatype\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** dataset permissions form */\n    _getPermission: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Manage dataset permissions\"),\n            operations: {\n                submit_permission: new Ui.ButtonIcon({\n                    tooltip: _l(\"Save permissions.\"),\n                    title: _l(\"Save permissions\"),\n                    icon: \"fa-floppy-o \",\n                    onclick: function() {\n                        self._submit(\"permission\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** reload Galaxy's history after updating dataset's attributes */\n    _reloadHistory: function() {\n        if (window.Galaxy) {\n            window.Galaxy.currHistoryPanel.loadCurrentHistory();\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}
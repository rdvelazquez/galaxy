{"version":3,"sources":["mvc/toolshed/workflows-view.js"],"names":["View","Backbone","extend","el","defaults","initialize","options","that","model","WorkflowTools","listenTo","render","fetch","workflows_missing_tools","templateWorkflows","workflows","models","$el","html","title","queue","queueLength","$","css","bindEvents","repository_id","on","tool_ids","attr","toolshed","api_url","Galaxy","root","params","get","data","repository","id","new_route","replace","history","navigate","trigger","elem","tool_shed_url","changesets","Object","keys","metadata","current_changeset","current_metadata","addToQueue","remove","loadWorkflows","reDraw","empty","_","template","join","Workflows"],"mappings":"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","file":"../../../scripts/mvc/toolshed/workflows-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nvar View = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: [{}],\n\n    initialize: function(options) {\n        var that = this;\n        this.model = new toolshed_model.WorkflowTools();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.fetch();\n        that.render();\n    },\n\n    render: function(options) {\n        var that = this;\n        var workflows_missing_tools = that.templateWorkflows;\n        var workflows = that.model.models;\n        that.$el.html(\n            workflows_missing_tools({\n                title: _l(\"Workflows Missing Tools\"),\n                workflows: workflows,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        that.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n        var repository_id;\n        $(\".show_wf_repo\").on(\"click\", function() {\n            var tool_ids = $(this).attr(\"data-toolids\");\n            var toolshed = $(this).attr(\"data-shed\");\n            var api_url = `${Galaxy.root}api/tool_shed/repository`;\n            var params = { tool_ids: tool_ids };\n            $.get(api_url, params, data => {\n                repository_id = data.repository.id;\n                var new_route = `repository/s/${toolshed.replace(/:/g, \"%3a\").replace(/\\//g, \"%2f\")}/r/${\n                    data.repository.id\n                }`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            });\n        });\n        $(\".queue_wf_repo\").on(\"click\", function() {\n            var elem = $(this);\n            var tool_ids = elem.attr(\"data-toolids\");\n            var toolshed = elem.attr(\"data-shed\");\n            var api_url = `${Galaxy.root}api/tool_shed/repository`;\n            var params = { tool_ids: tool_ids };\n            $.get(api_url, params, data => {\n                repository_id = data.repository.id;\n                params = {\n                    tool_shed_url: toolshed,\n                    repository_id: repository_id\n                };\n                $.get(api_url, params, data => {\n                    var changesets = Object.keys(data.repository.metadata);\n                    var current_changeset = changesets[0];\n                    var current_metadata = data.repository.metadata[current_changeset];\n                    current_metadata.tool_shed_url = toolshed;\n                    toolshed_util.addToQueue(current_metadata);\n                    elem.remove();\n                });\n            });\n        });\n        $(\"#from_workflow\").on(\"click\", that.loadWorkflows);\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.initialize(options);\n    },\n\n    templateWorkflows: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<style type=\"text/css\">',\n            \".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }\",\n            \"</style>\",\n            '<table id=\"workflows_missing_tools\" class=\"grid\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th class=\"datasetRow\">Workflows</th>',\n            '<th class=\"datasetRow\">Tool IDs</th>',\n            '<th class=\"datasetRow\">Shed</th>',\n            '<th class=\"datasetRow\">Name</th>',\n            '<th class=\"datasetRow\">Owner</th>',\n            '<th class=\"datasetRow\">Actions</th>',\n            \"</tr>\",\n            \"</thead>\",\n            \"<tbody>\",\n            \"<% _.each(workflows, function(workflow) { %>\",\n            \"<tr>\",\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_names\">',\n            '<% _.each(workflow.get(\"workflows\"), function(name) { %>',\n            '<li class=\"workflow_names\"><%= name %></li>',\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</td>\",\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_tools\">',\n            '<% _.each(workflow.get(\"tools\"), function(tool) { %>',\n            '<li class=\"workflow_tools\"><%= tool %></li>',\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</td>\",\n            '<td class=\"datasetRow\"><%= workflow.get(\"shed\") %></td>',\n            '<td class=\"datasetRow\"><%= workflow.get(\"repository\") %></td>',\n            '<td class=\"datasetRow\"><%= workflow.get(\"owner\") %></td>',\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_tools\">',\n            '<li class=\"workflow_tools\">',\n            '<input type=\"button\" class=\"show_wf_repo btn btn-primary\" data-shed=\"<%= workflow.get(\"shed\") %>\" data-owner=\"<%= workflow.get(\"owner\") %>\" data-repo=\"<%= workflow.get(\"repository\") %>\" data-toolids=\"<%= workflow.get(\"tools\").join(\",\") %>\" value=\"Show Repository\" /></li>',\n            \"</ul>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    Workflows: View\n};\n"]}
{"version":3,"sources":["mvc/toolshed/repo-status-view.js"],"names":["ToolShedRepoStatusView","Backbone","View","extend","el","initialize","options","self","_","defaults","model","RepoStatus","listenTo","render","url","repositories","join","fetch","timer","setInterval","terminal_states","all_done","some","models","repo_id","repository","get","repo_status","toLowerCase","indexOf","clearInterval","close","repo_status_template","templateRepoStatus","$el","html","title","queue","queueLength","$","css","bindEvents","that","reDraw","empty","template"],"mappings":"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","file":"../../../scripts/mvc/toolshed/repo-status-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nvar ToolShedRepoStatusView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(options) {\n        var self = this;\n        this.options = _.defaults(this.options || [{}], options, this.defaults);\n        this.model = new toolshed_model.RepoStatus();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.url += `?repositories=${this.options.repositories.join(\"|\")}`;\n        this.model.fetch();\n        this.timer = setInterval(\n            self => {\n                var terminal_states = [\"installed\", \"error\"];\n                var all_done = true;\n                _.some(self.model.models, repository => {\n                    repo_id = repository.get(\"id\");\n                    var repo_status = repository.get(\"status\").toLowerCase();\n                    if (terminal_states.indexOf(repo_status) === -1) {\n                        all_done = false;\n                        return true;\n                    }\n                });\n                if (all_done) {\n                    clearInterval(self.timer);\n                } else {\n                    self.model.fetch();\n                }\n            },\n            2000,\n            this\n        );\n    },\n\n    close: function() {\n        clearInterval(this.timer);\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var repo_status_template = this.templateRepoStatus;\n        this.$el.html(\n            repo_status_template({\n                title: _l(\"Repository Status\"),\n                repositories: this.model.models,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.initialize(options);\n    },\n\n    templateRepoStatus: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<style type=\"text/css\">',\n            \".state-color-new,\",\n            \".state-color-deactivated,\",\n            \".state-color-uninstalled { border-color:#bfbfbf; background:#eee }\",\n            \".state-color-cloning,\",\n            \".state-color-setting-tool-versions,\",\n            \".state-color-installing-repository-dependencies,\",\n            \".state-color-installing-tool-dependencies,\",\n            \".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }\",\n            \".state-color-installed { border-color:#20b520; background:#b0f1b0 }\",\n            \".state-color-error { border-color:#dd1b15; background:#f9c7c5 }\",\n            \"</style>\",\n            '<table id=\"grid-table\" class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th id=\"null-header\">Name<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Description<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Owner<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Revision<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Installation Status<span class=\"sort-arrow\"></span></th>',\n            \"</tr>\",\n            \"</thead>\",\n            '<tbody id=\"grid-table-body\">',\n            \"<% _.each(repositories, function(repository) { %>\",\n            \"<tr>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-name-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"name\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-desc-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"description\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-user-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"owner\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-changeset-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"changeset_revision\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"RepositoryStatus-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<div class=\"repo-status count-box state-color-<%= repository.get(\"status\").toLowerCase().replace(/ /g, \"-\") %>\" id=\"RepositoryStatus-<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"status\") %>',\n            \"</div>\",\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</tbody>\",\n            '<tfoot id=\"grid-table-footer\"></tfoot>',\n            \"</table>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    RepoStatus: ToolShedRepoStatusView\n};\n"]}
{"version":3,"sources":["mvc/toolshed/categories-view.js"],"names":["ToolShedCategories","Backbone","View","extend","el","defaults","tool_shed","initialize","options","self","shed","replace","_","model","Categories","listenTo","render","url","fetch","categories","models","queue","queueLength","category_list_template","templateCategoryList","$el","html","$","css","bindEvents","that","autocomplete","source","request","response","shed_url","base_url","Galaxy","root","params","term","tool_shed_url","post","console","log","data","result_list","shedParser","minLength","select","event","ui","tsr_id","item","value","api_url","new_route","history","navigate","trigger","reDraw","empty","template","join","CategoryView"],"mappings":"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","file":"../../../scripts/mvc/toolshed/categories-view.js","sourcesContent":["import toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nimport \"libs/jquery/jquery-ui\";\nvar ToolShedCategories = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: {\n        tool_shed: \"https://toolshed.g2.bx.psu.edu/\"\n    },\n\n    initialize: function(options) {\n        var self = this;\n        var shed = options.tool_shed.replace(/\\//g, \"%2f\");\n        this.options = _.defaults(this.options || options, this.defaults);\n        this.model = new toolshed_model.Categories();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.url = `${this.model.url}?tool_shed_url=${this.options.tool_shed}`;\n        this.model.tool_shed = shed;\n        this.model.fetch();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        this.options.categories = this.model.models;\n        this.options.queue = toolshed_util.queueLength();\n        var category_list_template = this.templateCategoryList;\n        this.$el.html(category_list_template(this.options));\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n        $(\"#search_box\").autocomplete({\n            source: function(request, response) {\n                var shed_url = that.model.tool_shed.replace(/%2f/g, \"/\");\n                var base_url = `${Galaxy.root}api/tool_shed/search`;\n                var params = {\n                    term: request.term,\n                    tool_shed_url: shed_url\n                };\n                $.post(base_url, params, data => {\n                    console.log(data);\n                    var result_list = toolshed_util.shedParser(data);\n                    response(result_list);\n                });\n            },\n            minLength: 3,\n            select: function(event, ui) {\n                var tsr_id = ui.item.value;\n                var api_url = `${Galaxy.root}api/tool_shed/repository`;\n                var params = {\n                    tool_shed_url: that.model.tool_shed,\n                    tsr_id: tsr_id\n                };\n                var new_route = `repository/s/${that.model.tool_shed}/r/${tsr_id}`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            }\n        });\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.model.url = `${this.model.url}?tool_shed_url=${this.options.tool_shed}`;\n        this.initialize(options);\n    },\n\n    templateCategoryList: _.template(\n        [\n            '<style type=\"text/css\">',\n            \".ui-autocomplete { background-color: #fff; }\",\n            \"li.ui-menu-item { list-style-type: none; }\",\n            \"</style>\",\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\" style=\"layout: inline;\">Categories in <%= tool_shed.replace(/%2f/g, \"/\") %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"list_categories\">',\n            '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n            '<span class=\"ui-widget\" >',\n            '<input class=\"search-box-input\" id=\"search_box\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" name=\"search\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n            \"</span>\",\n            \"</div>\",\n            '<div style=\"clear: both; margin-top: 1em;\">',\n            '<table class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            \"<th>Name</th>\",\n            \"<th>Description</th>\",\n            \"<th>Repositories</th>\",\n            \"</tr>\",\n            \"</thead>\",\n            \"<% _.each(categories, function(category) { %>\",\n            \"<tr>\",\n            \"<td>\",\n            '<a href=\"#/category/s/<%= tool_shed %>/c/<%= category.get(\"id\") %>\"><%= category.get(\"name\") %></a>',\n            \"</td>\",\n            '<td><%= category.get(\"description\") %></td>',\n            '<td><%= category.get(\"repositories\") %></td>',\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    CategoryView: ToolShedCategories\n};\n"]}
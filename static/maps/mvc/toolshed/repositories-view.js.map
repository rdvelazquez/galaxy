{"version":3,"sources":["mvc/toolshed/repositories-view.js"],"names":["ToolShedCategoryContentsView","Backbone","View","extend","el","initialize","params","self","model","CategoryCollection","listenTo","render","shed","tool_shed","replace","url","category_id","category","fetch","options","_","category_contents_template","templateCategoryContents","$el","html","models","queue","queueLength","$","css","bindEvents","that","autocomplete","source","request","response","shed_url","base_url","Galaxy","root","term","tool_shed_url","post","result_list","shedParser","data","minLength","select","event","ui","tsr_id","item","value","new_route","history","navigate","trigger","reDraw","empty","template","join","Category"],"mappings":"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","file":"../../../scripts/mvc/toolshed/repositories-view.js","sourcesContent":["import toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nimport \"libs/jquery/jquery-ui\";\nvar ToolShedCategoryContentsView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(params) {\n        var self = this;\n        this.model = new toolshed_model.CategoryCollection();\n        this.listenTo(this.model, \"sync\", this.render);\n        var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n        this.model.url += `?tool_shed_url=${shed}&category_id=${params.category_id}`;\n        this.model.tool_shed = shed;\n        this.model.category = params.category_id;\n        this.model.fetch();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var category_contents_template = this.templateCategoryContents;\n        this.$el.html(\n            category_contents_template({\n                category: this.model.models[0],\n                tool_shed: this.model.tool_shed,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n        $(\"#search_box\").autocomplete({\n            source: function(request, response) {\n                var shed_url = that.model.tool_shed.replace(/%2f/g, \"/\");\n                var base_url = `${Galaxy.root}api/tool_shed/search`;\n                var params = {\n                    term: request.term,\n                    tool_shed_url: shed_url\n                };\n                $.post(base_url, params, data => {\n                    var result_list = toolshed_util.shedParser(data);\n                    response(result_list);\n                });\n            },\n            minLength: 3,\n            select: function(event, ui) {\n                var tsr_id = ui.item.value;\n                var new_route = `repository/s/${that.model.tool_shed}/r/${tsr_id}`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            }\n        });\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.initialize(options);\n    },\n\n    templateCategoryContents: _.template(\n        [\n            '<style type=\"text/css\">',\n            \".ui-autocomplete { background-color: #fff; }\",\n            \"li.ui-menu-item { list-style-type: none; }\",\n            \"</style>\",\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n            '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n            '<span class=\"ui-widget\" >',\n            '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n            \"</span>\",\n            \"</div>\",\n            '<div style=\"clear: both; margin-top: 1em;\">',\n            '<table class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th style=\"width: 10%;\">Owner</th>',\n            '<th style=\"width: 15%;\">Name</th>',\n            \"<th>Synopsis</th>\",\n            '<th style=\"width: 10%;\">Type</th>',\n            \"</tr>\",\n            \"</thead>\",\n            '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n            \"<tr>\",\n            \"<td><%= repository.owner %></td>\",\n            \"<td>\",\n            '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n            '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n            \"</div>\",\n            \"</td>\",\n            \"<td><%= repository.description %></td>\",\n            \"<td><%= repository.type %></td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    Category: ToolShedCategoryContentsView\n};\n"]}
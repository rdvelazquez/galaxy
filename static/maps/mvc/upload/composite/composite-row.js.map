{"version":3,"sources":["mvc/upload/composite/composite-row.js"],"names":["Backbone","View","extend","status_classes","init","ready","running","success","error","initialize","app","options","self","model","setElement","_template","$source","$","$settings","$status","$text","$text_content","$info_text","$info_progress","$file_name","$file_desc","$file_size","$progress_bar","$percentage","uploadinput","$el","ondragover","get","addClass","ondragleave","removeClass","onchange","files","length","reset","file_data","file_name","name","file_size","size","file_mode","mode","_refreshReady","button_menu","ButtonMenu","icon","title","pull","append","addMenu","onclick","dialog","ftp_upload_site","_showFtp","ftp","container","find","placement","settings","on","set","url_paste","e","target","val","_showSettings","preventDefault","listenTo","_refreshPercentage","_refreshStatus","_refreshInfo","_refreshFileName","_refreshMode","_refreshFileSize","remove","collection","render","attr","id","html","_","escape","bytesToString","prototype","apply","each","height","css","width","top","show","trigger","hide","info","percentage","parseInt","offsetHeight","status","visible","empty","ftp_file","path","file_path"],"mappings":"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","file":"../../../../scripts/mvc/upload/composite/composite-row.js","sourcesContent":["import _l from \"utils/localization\";\n/** Renders the composite upload row view */\nimport Utils from \"utils/utils\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport UploadFtp from \"mvc/upload/upload-ftp\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Select from \"mvc/ui/ui-select\";\nimport \"utils/uploadbox\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-mode fa fa-exclamation text-primary\",\n        ready: \"upload-mode fa fa-check text-success\",\n        running: \"upload-mode fa fa-spinner fa-spin\",\n        success: \"upload-mode fa fa-check\",\n        error: \"upload-mode fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$source = this.$(\".upload-source\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$status = this.$(\".upload-status\");\n        this.$text = this.$(\".upload-text\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$file_name = this.$(\".upload-file-name\");\n        this.$file_desc = this.$(\".upload-file-desc\");\n        this.$file_size = this.$(\".upload-file-size\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // build upload functions\n        this.uploadinput = this.$el.uploadinput({\n            ondragover: function() {\n                self.model.get(\"enabled\") && self.$el.addClass(\"warning\");\n            },\n            ondragleave: function() {\n                self.$el.removeClass(\"warning\");\n            },\n            onchange: function(files) {\n                if (self.model.get(\"status\") != \"running\" && files && files.length > 0) {\n                    self.model.reset({\n                        file_data: files[0],\n                        file_name: files[0].name,\n                        file_size: files[0].size,\n                        file_mode: files[0].mode || \"local\"\n                    });\n                    self._refreshReady();\n                }\n            }\n        });\n\n        // source selection popup\n        this.button_menu = new Ui.ButtonMenu({\n            icon: \"fa-caret-down\",\n            title: _l(\"Select\"),\n            pull: \"left\"\n        });\n        this.$source.append(this.button_menu.$el);\n        this.button_menu.addMenu({\n            icon: \"fa-laptop\",\n            title: _l(\"Choose local file\"),\n            onclick: function() {\n                self.uploadinput.dialog();\n            }\n        });\n        if (this.app.ftp_upload_site) {\n            this.button_menu.addMenu({\n                icon: \"fa-folder-open-o\",\n                title: _l(\"Choose FTP file\"),\n                onclick: function() {\n                    self._showFtp();\n                }\n            });\n        }\n        this.button_menu.addMenu({\n            icon: \"fa-edit\",\n            title: \"Paste/Fetch data\",\n            onclick: function() {\n                self.model.reset({\n                    file_mode: \"new\",\n                    file_name: \"New File\"\n                });\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title: \"Choose FTP file:\",\n            container: this.$source.find(\".ui-button-menu\"),\n            placement: \"right\"\n        });\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: _l(\"Upload configuration\"),\n            container: this.$settings,\n            placement: \"bottom\"\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n            self._refreshReady();\n        });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", e => {\n                self._showSettings();\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_name\", () => {\n            self._refreshFileName();\n        });\n        this.listenTo(this.model, \"change:file_mode\", () => {\n            self._refreshMode();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", () => {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", () => {\n            self.remove();\n        });\n    },\n\n    render: function() {\n        this.$el.attr(\"id\", `upload-row-${this.model.id}`);\n        this.$file_name.html(_.escape(this.model.get(\"file_name\") || \"-\"));\n        this.$file_desc.html(this.model.get(\"file_desc\") || \"Unavailable\");\n        this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n        this.$status.removeClass().addClass(this.status_classes.init);\n    },\n\n    /** Remove view */\n    remove: function() {\n        // call the base class remove method\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    //\n    // handle model events\n    //\n\n    /** Refresh ready or not states */\n    _refreshReady: function() {\n        this.app.collection.each(model => {\n            model.set(\"status\", (model.get(\"file_size\") > 0 && \"ready\") || \"init\");\n        });\n    },\n\n    /** Refresh mode and e.g. show/hide textarea field */\n    _refreshMode: function() {\n        var file_mode = this.model.get(\"file_mode\");\n        if (file_mode == \"new\") {\n            this.height = this.$el.height();\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$text_content.val(\"\").trigger(\"keyup\");\n        } else {\n            this.$el.height(this.height);\n            this.$text.hide();\n        }\n    },\n\n    /** Refresh information */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        if (percentage != 0) {\n            this.$progress_bar.css({ width: `${percentage}%` });\n        } else {\n            this.$progress_bar.addClass(\"no-transition\");\n            this.$progress_bar.css({ width: \"0%\" });\n            this.$progress_bar[0].offsetHeight;\n            this.$progress_bar.removeClass(\"no-transition\");\n        }\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$status.removeClass().addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status != \"running\");\n        this.$text_content.attr(\"disabled\", !this.model.get(\"enabled\"));\n        this.$el.removeClass(\"success danger warning\");\n        if (status == \"running\" || status == \"ready\") {\n            this.model.set(\"percentage\", 0);\n        }\n        this.$source.find(\".button\")[status == \"running\" ? \"addClass\" : \"removeClass\"](\"disabled\");\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.model.set(\"percentage\", 100);\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.model.set(\"percentage\", 0);\n            this.$info_progress.hide();\n            this.$info_text.show();\n        } else {\n            this.$info_progress.show();\n            this.$info_text.hide();\n        }\n    },\n\n    /** File name */\n    _refreshFileName: function() {\n        this.$file_name.html(this.model.get(\"file_name\") || \"-\");\n    },\n\n    /** File size */\n    _refreshFileSize: function() {\n        this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Show/hide ftp popup */\n    _showFtp: function() {\n        if (!this.ftp.visible) {\n            var self = this;\n            this.ftp.empty();\n            this.ftp.append(\n                new UploadFtp({\n                    ftp_upload_site: this.app.ftp_upload_site,\n                    onchange: function(ftp_file) {\n                        self.ftp.hide();\n                        if (self.model.get(\"status\") != \"running\" && ftp_file) {\n                            self.model.reset({\n                                file_mode: \"ftp\",\n                                file_name: ftp_file.path,\n                                file_size: ftp_file.size,\n                                file_path: ftp_file.path\n                            });\n                            self._refreshReady();\n                        }\n                    }\n                }).$el\n            );\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Show/hide settings popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<tr class=\"upload-row\">' +\n            \"<td>\" +\n            '<div class=\"upload-source\"/>' +\n            '<div class=\"upload-text-column\">' +\n            '<div class=\"upload-text\">' +\n            '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n            '<textarea class=\"upload-text-content form-control\"/>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-status\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-desc upload-title\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-name upload-title\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-size upload-size\"/>' +\n            \"</td>\" +\n            '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n            \"<td>\" +\n            '<div class=\"upload-info\">' +\n            '<div class=\"upload-info-text\"/>' +\n            '<div class=\"upload-info-progress progress\">' +\n            '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n            '<div class=\"upload-percentage\">0%</div>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"</tr>\"\n        );\n    }\n});\n"]}
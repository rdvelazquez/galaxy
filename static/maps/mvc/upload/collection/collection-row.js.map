{"version":3,"sources":["mvc/upload/collection/collection-row.js"],"names":["Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","$info_progress","$text_content","$symbol","$progress_bar","$percentage","settings","title","container","placement","default_genome","select_genome","value","default_extension","select_extension","on","_removeRow","set","url_paste","e","target","val","file_size","length","listenTo","_refreshPercentage","_refreshStatus","_refreshInfo","_refreshFileSize","remove","collection","render","attributes","html","_","escape","file_name","bytesToString","removeClass","addClass","file_mode","css","width","$el","top","height","show","info","get","hide","percentage","parseInt","status","enabled","attr","indexOf","_showSettings","visible","empty","append","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/collection/collection-row.js","sourcesContent":["import _l from \"utils/localization\";\n/** Renders the collection uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title-extended\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: _l(\"Upload configuration\"),\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // handle click event\n        this.$symbol.on(\"click\", () => {\n            self._removeRow();\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", () => {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", () => {\n            self.remove();\n        });\n    },\n\n    render: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: `${percentage}%` });\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return `<tr id=\"upload-row-${\n            options.id\n        }\" class=\"upload-row\"><td><div class=\"upload-text-column\"><div class=\"upload-mode\"/><div class=\"upload-title-extended\"/><div class=\"upload-text\"><div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\"upload-text-content form-control\"/></div></div></td><td><div class=\"upload-size\"/></td><td><div class=\"upload-info\"><div class=\"upload-info-text\"/><div class=\"upload-info-progress progress\"><div class=\"upload-progress-bar progress-bar progress-bar-success\"/><div class=\"upload-percentage\">0%</div></div></div></td><td><div class=\"upload-symbol ${\n            this.status_classes.init\n        }\"/></td></tr>`;\n    }\n});\n"]}
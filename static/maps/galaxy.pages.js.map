{"version":3,"sources":["galaxy.pages.js"],"names":["pagesEditorOnload","WYMeditor","window","CONTROLS","ITEM_HISTORY","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","ITEM_VISUALIZATION","DIALOG_HISTORY_LINK","DIALOG_DATASET_LINK","DIALOG_WORKFLOW_LINK","DIALOG_PAGE_LINK","DIALOG_VISUALIZATION_LINK","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","DIALOG_EMBED_PAGE","DIALOG_EMBED_VISUALIZATION","init_galaxy_elts","wym","$","_doc","body","each","click","range","createRange","selectNodeContents","selection","getSelection","removeAllRanges","addRange","t","get_item_info","dialog_type","item_singular","item_plural","item_controller","item_class","item_list_action","toLowerCase","ajax_url","list_objects_url","replace","singular","plural","controller","iclass","list_ajax_url","make_item_importable","item_id","item_type","set_accessible_url","ajax","type","url","data","id","accessible","error","alert","editor","prototype","dialog","dialogType","dialogFeatures","bodyHtml","sStamp","uniqueStamp","selected","set_link_id","text","attribute_input","addClass","removeClass","val","attr","remove","DIALOG_LINK","_options","hrefSelector","HREF","srcSelector","SRC","titleSelector","TITLE","altSelector","ALT","curURL","curTitle","undefined","show_modal","sUrl","sId","sName","_exec","CREATE_LINK","link","indexOf","hide_modal","Cancel","DIALOG_IMAGE","_selected_image","dialogImageSelector","Insert","length","INSERT_IMAGE","DIALOG_TABLE","iRows","rowsSelector","iCols","colsSelector","table","createElement","TABLE","newRow","newCol","sCaption","captionSelector","newCaption","createCaption","innerHTML","x","insertRow","y","insertCell","summarySelector","node","findUp","container","MAIN_CONTAINERS","get","parentNode","append","after","item_info","grid","url_base","embedded","Galaxy","modal","show","title","$el","closing_events","buttons","make_importable","item_ids","Array","url_template","get_name_and_link_url","getJSON","link_text","insert","returned_item_info","name","hide","Close","Embed","item_name","item_elt_id","item_embed_html","join","document","ajaxError","e","message","responseText","statusText","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","boxHtml","TOOLS","IFRAME","STATUS","toolsItems","css","wymeditors","save","save_url","page_id","content","xhtml","annotations","JSON","stringify","Object","_","success","callback","changed","do_close","onbeforeunload","location","page_list_url","containers_menu","items","containersItems","k","v","tagname","make_popupmenu","insert_link_menu_button","embed_object_button"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["import _l from \"utils/localization\";\nimport \"libs/jquery/jquery.form\";\nimport \"libs/jquery/jstorage\";\nimport \"libs/jquery/jquery.wymeditor\";\nimport \"libs/jquery/jquery.autocomplete\";\nimport GridView from \"mvc/grid/grid-view\";\n\nvar WYMeditor = window.WYMeditor;\n\nvar CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym) {\n    // Set up events to make annotation easy.\n    $(\".annotation\", wym._doc.body).each(function() {\n        $(this).click(function() {\n            // Works in Safari, not in Firefox.\n            var range = wym._doc.createRange();\n            range.selectNodeContents(this);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            var t = \"\";\n        });\n    });\n}\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular;\n    var item_plural;\n    var item_controller;\n    var item_class;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = `list_${item_plural.toLowerCase()}_for_selection`;\n    var ajax_url = list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = set_accessible_url.replace(\"ITEM_CONTROLLER\", item_controller);\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(`Making ${item_type} accessible failed`);\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(dialogType, dialogFeatures, bodyHtml) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n\n        // Get current URL, title.\n        var curURL;\n\n        var curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            `<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='${curURL}' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='${curTitle}' size='40' /></div><div>`,\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\";\n\n                    var sId = $(\".wym_id\").val() || \"\";\n                    var sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(`a[href=${sStamp}]`, wym._doc.body);\n                        link\n                            .attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(`${wym._options.dialogImageSelector} ${wym._options.srcSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.SRC)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.titleSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.TITLE)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.altSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.ALT)\n            );\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(`img[src$=${sStamp}]`, wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                            .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n                        var newCol = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\"summary\", $(wym._options.summarySelector).val());\n\n                        //append the table after the selected container\n                        var node = $(wym.findUp(wym.container(), WYMeditor.MAIN_CONTAINERS)).get(0);\n                        if (!node || !node.parentNode) $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Insert: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    // Insert links to history for each checked item.\n                    var item_ids = new Array();\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        var item_id = $(this).val();\n\n                        // Make item importable?\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                        var url_template = get_name_and_link_url + item_id;\n                        var ajax_url = url_template.replace(\"ITEM_CONTROLLER\", item_info.controller);\n                        $.getJSON(ajax_url, returned_item_info => {\n                            // Get link text.\n                            wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                            var link_text = $(`a[href=${sStamp}]`, wym._doc.body).text();\n\n                            // Insert link: need to do different actions depending on link text.\n                            if (\n                                link_text == \"\" || // Firefox.\n                                link_text == sStamp // Safari\n                            ) {\n                                // User selected no text; create link from scratch and use default text.\n                                wym.insert(\n                                    `<a href='${returned_item_info.link}'>${item_info.singular} '${\n                                        returned_item_info.name\n                                    }'</a>`\n                                );\n                            } else {\n                                // Link created from selected text; add href and title.\n                                $(`a[href=${sStamp}]`, wym._doc.body)\n                                    .attr(WYMeditor.HREF, returned_item_info.link)\n                                    .attr(WYMeditor.TITLE, item_info.singular + item_id);\n                            }\n                        });\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Embed: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        // Get item ID and name.\n                        var item_id = $(this).val();\n                        // Use ':first' because there are many labels in table; the first one is the item name.\n                        var item_name = $(`label[for='${item_id}']:first`).text();\n\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                        // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                        // item_class='History').\n                        var item_elt_id = `${item_info.iclass}-${item_id}`;\n                        var item_embed_html = [\n                            \"<div id='\",\n                            item_elt_id,\n                            \"' class='embedded-item \",\n                            item_info.singular.toLowerCase(),\n                            \" placeholder'>\",\n                            \"<p class='title'>\",\n                            \"Embedded Galaxy \",\n                            item_info.singular,\n                            \" '\",\n                            item_name,\n                            \"'\",\n                            \"</p>\",\n                            \"<p class='content'>\",\n                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                            item_info.singular.toLowerCase(),\n                            \" when it is displayed.]\",\n                            \"</p>\",\n                            \"</div>\"\n                        ].join(\"\");\n\n                        // Insert embedded item into document.\n                        wym.insert(item_embed_html);\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n};\n\nexport default function pagesEditorOnload() {\n    // Generic error handling\n    $(document).ajaxError((e, x) => {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        // + WYMeditor.HTML\n        boxHtml: `<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>${\n            WYMeditor.TOOLS\n        }</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>${\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME\n        }${WYMeditor.STATUS}</div></div></td></tr></table>`,\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: _l(\"Superscript\"),\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: _l(\"Subscript\"),\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = callback => {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(() => {\n        save(() => {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(() => {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = () => {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, (k, v) => {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = () => {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n}\n"]}
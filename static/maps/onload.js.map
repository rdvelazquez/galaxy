{"version":3,"sources":["onload.js"],"names":["window","jQuery","$","_","Backbone","panels","extend","async_save_text","make_popupmenu","make_popup_menus","init_tag_click_function","replace_big_select_inputs","min_length","max_length","select_elts","refresh_select2","element","select_elt","options","placeholder","closeOnSelect","is","dropdownAutoWidth","containerCssClass","select2","fn","undefined","each","not","num_options","find","length","hasClass","init_refresh_on_change","off","change","select_field","select_val","val","ref_on_change_vals","attr","split","last_selected_value","inArray","trigger","document","get","form","submit","click","confirm","ready","tooltip","placement","anchor","galaxy_main_exists","parent","frames","galaxy_main","href","indexOf","activeGalaxyTourRunner","onloadWebhooks","Galaxy","root","config","enable_webhooks","load","type","callback","webhooks","webhook","model","toJSON","activate","script","appendScriptStyle","setTimeout"],"mappings":"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","file":"../scripts/onload.js","sourcesContent":["// ============================================================================\n// Globals (temporary)\n// ============================================================================\n// HACK: add these to global scope until we stop asking for them there...\n// Via webpack: these are required here automatically by the provider plugin\n// Via script tag: these are redundant (identities) since they're already global\nwindow[\"jQuery\"] = jQuery; // a weird form to prevent webpack from sub'ing 'window.jQuery' in the provider plugin\nwindow.$ = jQuery;\nwindow._ = _;\nwindow.Backbone = Backbone;\n// console.debug('globals loaded:', window.jQuery, window.Backbone, '...');\n\n// these are galaxy globals not defined in the provider (although they could be - but why encourage that?)\nimport Panel from \"layout/panel\";\nwindow.panels = Panel;\n\n// using extend bc there are multiple fns/objs to decorate the window with\nimport layout_modal from \"layout/modal\";\n_.extend(window, layout_modal);\nimport async_save_text from \"utils/async-save-text\";\nwindow.async_save_text = async_save_text;\nimport Popupmenu from \"ui/popupmenu\";\nwindow.make_popupmenu = Popupmenu.make_popupmenu;\nwindow.make_popup_menus = Popupmenu.make_popup_menus;\nimport init_tag_click_function from \"ui/autocom_tagging\";\nwindow.init_tag_click_function = init_tag_click_function;\nimport Tours from \"mvc/tours\";\nimport Webhooks from \"mvc/webhooks\";\nimport Utils from \"utils/utils\";\n// console.debug( 'galaxy globals loaded' );\n\n// ============================================================================\n// jquery on document ready\n// ============================================================================\n// Replace select box with a text input box + autocomplete.\nfunction replace_big_select_inputs(min_length, max_length, select_elts) {\n    function refresh_select2(element) {\n        var select_elt = $(element);\n        var options = {\n            placeholder: \"Click to select\",\n            closeOnSelect: !select_elt.is(\"[MULTIPLE]\"),\n            dropdownAutoWidth: true,\n            containerCssClass: \"select2-minwidth\"\n        };\n        return element.select2(options);\n    }\n\n    // To do replace, the select2 plugin must be loaded.\n    if (!jQuery.fn.select2) {\n        return;\n    }\n\n    // Set default for min_length and max_length\n    if (min_length === undefined) {\n        min_length = 20;\n    }\n    if (max_length === undefined) {\n        max_length = 3000;\n    }\n\n    select_elts = select_elts || $(\"select\");\n\n    select_elts.each(function() {\n        var select_elt = $(this).not(\"[multiple]\");\n        // Make sure that options is within range.\n        var num_options = select_elt.find(\"option\").length;\n        if (num_options < min_length || num_options > max_length) {\n            return;\n        }\n\n        if (select_elt.hasClass(\"no-autocomplete\")) {\n            return;\n        }\n\n        /* Replaced jQuery.autocomplete with select2, notes:\n         * - multiple selects are supported\n         * - the original element is updated with the value, convert_to_values should not be needed\n         * - events are fired when updating the original element, so refresh_on_change should just work\n         *\n         * - should we still sort dbkey fields here?\n         */\n        refresh_select2(select_elt);\n    });\n}\n\n// Initialize refresh events.\nfunction init_refresh_on_change() {\n    $(\"select[refresh_on_change='true']\")\n        .off(\"change\")\n        .change(function() {\n            var select_field = $(this);\n            var select_val = select_field.val();\n            var ref_on_change_vals = select_field.attr(\"refresh_on_change_values\");\n            if (ref_on_change_vals) {\n                ref_on_change_vals = ref_on_change_vals.split(\",\");\n                var last_selected_value = select_field.attr(\"last_selected_value\");\n                if (\n                    $.inArray(select_val, ref_on_change_vals) === -1 &&\n                    $.inArray(last_selected_value, ref_on_change_vals) === -1\n                ) {\n                    return;\n                }\n            }\n            $(window).trigger(\"refresh_on_change\");\n            $(document).trigger(\"convert_to_values\"); // Convert autocomplete text to values\n            select_field.get(0).form.submit();\n        });\n\n    // checkboxes refresh on change\n    $(\":checkbox[refresh_on_change='true']\")\n        .off(\"click\")\n        .click(function() {\n            var select_field = $(this);\n            var select_val = select_field.val();\n            var ref_on_change_vals = select_field.attr(\"refresh_on_change_values\");\n            if (ref_on_change_vals) {\n                ref_on_change_vals = ref_on_change_vals.split(\",\");\n                var last_selected_value = select_field.attr(\"last_selected_value\");\n                if (\n                    $.inArray(select_val, ref_on_change_vals) === -1 &&\n                    $.inArray(last_selected_value, ref_on_change_vals) === -1\n                ) {\n                    return;\n                }\n            }\n            $(window).trigger(\"refresh_on_change\");\n            select_field.get(0).form.submit();\n        });\n\n    // Links with confirmation\n    $(\"a[confirm]\")\n        .off(\"click\")\n        .click(function() {\n            return confirm($(this).attr(\"confirm\"));\n        });\n}\n// used globally in grid-view\nwindow.init_refresh_on_change = init_refresh_on_change;\n\n$(document).ready(() => {\n    // Refresh events for form fields.\n    init_refresh_on_change();\n\n    // Tooltips\n    if ($.fn.tooltip) {\n        // Put tooltips below items in panel header so that they do not overlap masthead.\n        $(\".unified-panel-header [title]\").tooltip({ placement: \"bottom\" });\n\n        // default tooltip initialization, it will follow the data-placement tag for tooltip location\n        // and fallback to 'top' if not present\n        $(\"[title]\").tooltip();\n    }\n    // Make popup menus.\n    Popupmenu.make_popup_menus();\n\n    // Replace big selects.\n    replace_big_select_inputs(20, 1500);\n\n    // If galaxy_main frame does not exist and link targets galaxy_main,\n    // add use_panels=True and set target to self.\n    $(\"a\").click(function() {\n        var anchor = $(this);\n        var galaxy_main_exists = window.parent.frames && window.parent.frames.galaxy_main;\n        if (anchor.attr(\"target\") == \"galaxy_main\" && !galaxy_main_exists) {\n            var href = anchor.attr(\"href\");\n            if (href.indexOf(\"?\") == -1) {\n                href += \"?\";\n            } else {\n                href += \"&\";\n            }\n            href += \"use_panels=True\";\n            anchor.attr(\"href\", href);\n            anchor.attr(\"target\", \"_self\");\n        }\n        return anchor;\n    });\n\n    Tours.activeGalaxyTourRunner();\n\n    function onloadWebhooks() {\n        if (Galaxy.root !== undefined) {\n            if (Galaxy.config.enable_webhooks) {\n                // Load all webhooks with the type 'onload'\n                Webhooks.load({\n                    type: \"onload\",\n                    callback: function(webhooks) {\n                        webhooks.each(model => {\n                            var webhook = model.toJSON();\n                            if (webhook.activate && webhook.script) {\n                                Utils.appendScriptStyle(webhook);\n                            }\n                        });\n                    }\n                });\n            }\n        } else {\n            setTimeout(onloadWebhooks, 100);\n        }\n    }\n    onloadWebhooks();\n});\n"]}
{"version":3,"sources":["viz/trackster/filters.js"],"names":["_","extend","Filter","obj_dict","manager","name","index","tool_id","tool_exp_name","prototype","to_dict","create_action_icon","title","css_class","on_click_fn","$","attr","addClass","tooltip","click","NumberFilter","call","low","Number","MAX_VALUE","high","min","max","container","slider","slider_label","edit_slider_values","span","cur_value","text","parseFloat","input_size","toString","length","multi_value","slider_row","parents","appendTo","focus","select","e","stopPropagation","blur","remove","removeClass","keyup","keyCode","trigger","slider_min","slider_max","invalid","isNaN","a_val","new_value","val","alert","split","filter","parent_div","filter_label","values_span","values_span_container","append","slider_div","control_element","range","step","get_slider_step","values","slide","event","ui","change","display_controls_div","transparency_icon","alpha_filter","find","hide","show","track","request_draw","force","clear_after","height_icon","height_filter","hover","type","copy","self","setTimeout","applies_to","element","_keep_val","keep","to_filter","Array","returnVal","i","update_attrs","updated","value","Math","floor","ceil","update_ui_elt","FiltersManager","filters","bind","alpha_filter_name","height_filter_name","filters_dict","add_filter","console","log","visible","run_buttons_row","run_on_dataset_button","filter_manager","run_on_dataset","toggle","is","filter_dicts","push","new_track","remove_all","children","init_filters","clear_filters","get_or_create_dict_item","dict","key","new_item","active_filters","tool_filter_conditions","active_filters_list","run_filter","input_dataset_id","filter_tuple","tool_filters","tool_filter_str","join","url_params","cond","input","target_dataset_id","slice","getJSON","run_tool_url","response","error","Galaxy","modal","body","buttons","Close","dataset_id"],"mappings":"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","file":"../../../scripts/viz/trackster/filters.js","sourcesContent":["import _l from \"utils/localization\";\nimport * as _ from \"libs/underscore\";\nvar extend = _.extend;\n\n/**\n * Filters that enable users to show/hide data points dynamically.\n */\nvar Filter = function(obj_dict) {\n    this.manager = null;\n    this.name = obj_dict.name;\n    // Index into payload to filter.\n    this.index = obj_dict.index;\n    this.tool_id = obj_dict.tool_id;\n    // Name to use for filter when building expression for tool.\n    this.tool_exp_name = obj_dict.tool_exp_name;\n};\n\nextend(Filter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function() {\n        return {\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        };\n    }\n});\n\n/**\n * Creates an action icon.\n */\nvar create_action_icon = (title, css_class, on_click_fn) =>\n    $(\"<a/>\")\n        .attr(\"href\", \"javascript:void(0);\")\n        .attr(\"title\", title)\n        .addClass(\"icon-button\")\n        .addClass(css_class)\n        .tooltip()\n        .click(on_click_fn);\n\n/**\n * Number filters have a min, max as well as a low, high; low and high are used\n */\nvar NumberFilter = function(obj_dict) {\n    //\n    // Attribute init.\n    //\n    Filter.call(this, obj_dict);\n    // Filter low/high. These values are used to filter elements.\n    this.low = \"low\" in obj_dict ? obj_dict.low : -Number.MAX_VALUE;\n    this.high = \"high\" in obj_dict ? obj_dict.high : Number.MAX_VALUE;\n    // Slide min/max. These values are used to set/update slider.\n    this.min = \"min\" in obj_dict ? obj_dict.min : Number.MAX_VALUE;\n    this.max = \"max\" in obj_dict ? obj_dict.max : -Number.MAX_VALUE;\n    // UI elements associated with filter.\n    this.container = null;\n    this.slider = null;\n    this.slider_label = null;\n\n    //\n    // Create HTML.\n    //\n\n    // Function that supports inline text editing of slider values.\n    // Enable users to edit parameter's value via a text box.\n    var edit_slider_values = (container, span, slider) => {\n        container.click(function() {\n            var cur_value = span.text();\n            var max = parseFloat(slider.slider(\"option\", \"max\"));\n\n            var input_size = max <= 1 ? 4 : max <= 1000000 ? max.toString().length : 6;\n\n            var multi_value = false;\n            var slider_row = $(this).parents(\".slider-row\");\n\n            // Row now has input.\n            slider_row.addClass(\"input\");\n\n            // Increase input size if there are two values.\n            if (slider.slider(\"option\", \"values\")) {\n                input_size = 2 * input_size + 1;\n                multi_value = true;\n            }\n            span.text(\"\");\n            // Temporary input for changing value.\n            $(\"<input type='text'/>\")\n                .attr(\"size\", input_size)\n                .attr(\"maxlength\", input_size)\n                .attr(\"value\", cur_value)\n                .appendTo(span)\n                .focus()\n                .select()\n                .click(e => {\n                    // Don't want click to propogate up to values_span and restart everything.\n                    e.stopPropagation();\n                })\n                .blur(function() {\n                    $(this).remove();\n                    span.text(cur_value);\n                    slider_row.removeClass(\"input\");\n                })\n                .keyup(function(e) {\n                    if (e.keyCode === 27) {\n                        // Escape key.\n                        $(this).trigger(\"blur\");\n                    } else if (e.keyCode === 13) {\n                        //\n                        // Enter/return key initiates callback. If new value(s) are in slider range,\n                        // change value (which calls slider's change() function).\n                        //\n                        var slider_min = slider.slider(\"option\", \"min\");\n\n                        var slider_max = slider.slider(\"option\", \"max\");\n\n                        var invalid = a_val => isNaN(a_val) || a_val > slider_max || a_val < slider_min;\n\n                        var new_value = $(this).val();\n                        if (!multi_value) {\n                            new_value = parseFloat(new_value);\n                            if (invalid(new_value)) {\n                                alert(`Parameter value must be in the range [${slider_min}-${slider_max}]`);\n                                return $(this);\n                            }\n                        } else {\n                            // Multi value.\n                            new_value = new_value.split(\"-\");\n                            new_value = [parseFloat(new_value[0]), parseFloat(new_value[1])];\n                            if (invalid(new_value[0]) || invalid(new_value[1])) {\n                                alert(`Parameter value must be in the range [${slider_min}-${slider_max}]`);\n                                return $(this);\n                            }\n                        }\n\n                        // Updating the slider also updates slider values and removes input.\n                        slider.slider(multi_value ? \"values\" : \"value\", new_value);\n                        slider_row.removeClass(\"input\");\n                    }\n                });\n        });\n    };\n\n    var filter = this;\n\n    filter.parent_div = $(\"<div/>\").addClass(\"filter-row slider-row\");\n\n    // Set up filter label (name, values).\n    var filter_label = $(\"<div/>\")\n        .addClass(\"elt-label\")\n        .appendTo(filter.parent_div);\n\n    $(\"<span/>\")\n        .addClass(\"slider-name\")\n        .text(`${filter.name}  `)\n        .appendTo(filter_label);\n\n    var values_span = $(\"<span/>\").text(`${this.low}-${this.high}`);\n\n    var values_span_container = $(\"<span/>\")\n        .addClass(\"slider-value\")\n        .appendTo(filter_label)\n        .append(\"[\")\n        .append(values_span)\n        .append(\"]\");\n\n    filter.values_span = values_span;\n\n    // Set up slider for filter.\n    var slider_div = $(\"<div/>\")\n        .addClass(\"slider\")\n        .appendTo(filter.parent_div);\n    filter.control_element = $(\"<div/>\")\n        .attr(\"id\", `${filter.name}-filter-control`)\n        .appendTo(slider_div);\n    filter.control_element.slider({\n        range: true,\n        min: this.min,\n        max: this.max,\n        step: this.get_slider_step(this.min, this.max),\n        values: [this.low, this.high],\n        slide: function(event, ui) {\n            filter.slide(event, ui);\n        },\n        change: function(event, ui) {\n            filter.control_element.slider(\"option\", \"slide\").call(filter.control_element, event, ui);\n        }\n    });\n    filter.slider = filter.control_element;\n    filter.slider_label = values_span;\n\n    // Enable users to edit slider values via text box.\n    edit_slider_values(values_span_container, values_span, filter.control_element);\n\n    // Set up filter display controls.\n    var display_controls_div = $(\"<div/>\")\n        .addClass(\"display-controls\")\n        .appendTo(filter.parent_div);\n    this.transparency_icon = create_action_icon(\"Use filter for data transparency\", \"layer-transparent\", () => {\n        if (filter.manager.alpha_filter !== filter) {\n            // Setting this filter as the alpha filter.\n            filter.manager.alpha_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div\n                .find(\".layer-transparent\")\n                .removeClass(\"active\")\n                .hide();\n            filter.transparency_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.alpha_filter = null;\n            filter.transparency_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    })\n        .appendTo(display_controls_div)\n        .hide();\n    this.height_icon = create_action_icon(\"Use filter for data height\", \"arrow-resize-090\", () => {\n        if (filter.manager.height_filter !== filter) {\n            // Setting this filter as the height filter.\n            filter.manager.height_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div\n                .find(\".arrow-resize-090\")\n                .removeClass(\"active\")\n                .hide();\n            filter.height_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.height_filter = null;\n            filter.height_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    })\n        .appendTo(display_controls_div)\n        .hide();\n    filter.parent_div.hover(\n        () => {\n            filter.transparency_icon.show();\n            filter.height_icon.show();\n        },\n        () => {\n            if (filter.manager.alpha_filter !== filter) {\n                filter.transparency_icon.hide();\n            }\n            if (filter.manager.height_filter !== filter) {\n                filter.height_icon.hide();\n            }\n        }\n    );\n\n    // Add to clear floating layout.\n    $(\"<div style='clear: both;'/>\").appendTo(filter.parent_div);\n};\nextend(NumberFilter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function() {\n        var obj_dict = Filter.prototype.to_dict.call(this);\n        return extend(obj_dict, {\n            type: \"number\",\n            min: this.min,\n            max: this.max,\n            low: this.low,\n            high: this.high\n        });\n    },\n    /**\n     * Return a copy of filter.\n     */\n    copy: function() {\n        return new NumberFilter({\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        });\n    },\n    /**\n     * Get step for slider.\n     */\n    // FIXME: make this a \"static\" function.\n    get_slider_step: function(min, max) {\n        var range = max - min;\n        return range <= 2 ? 0.01 : 1;\n    },\n    /**\n     * Handle slide events.\n     */\n    slide: function(event, ui) {\n        var values = ui.values;\n\n        // Set new values in UI.\n        this.values_span.text(`${values[0]}-${values[1]}`);\n\n        // Set new values in filter.\n        this.low = values[0];\n        this.high = values[1];\n\n        // Set timeout to update if filter low, high are stable.\n        var self = this;\n        setTimeout(() => {\n            if (values[0] === self.low && values[1] === self.high) {\n                self.manager.track.request_draw({\n                    force: true,\n                    clear_after: true\n                });\n            }\n        }, 25);\n    },\n    /**\n     * Returns true if filter can be applied to element.\n     */\n    applies_to: function(element) {\n        if (element.length > this.index) {\n            return true;\n        }\n        return false;\n    },\n    /**\n     * Helper function: returns true if value in in filter's [low, high] range.\n     */\n    _keep_val: function(val) {\n        return isNaN(val) || (val >= this.low && val <= this.high);\n    },\n    /**\n     * Returns true if (a) element's value(s) is in [low, high] (range is inclusive)\n     * or (b) if value is non-numeric and hence unfilterable.\n     */\n    keep: function(element) {\n        if (!this.applies_to(element)) {\n            // No element to filter on.\n            return true;\n        }\n\n        // Do filtering.\n        var to_filter = element[this.index];\n        if (to_filter instanceof Array) {\n            var returnVal = true;\n            for (var i = 0; i < to_filter.length; i++) {\n                if (!this._keep_val(to_filter[i])) {\n                    // Exclude element.\n                    returnVal = false;\n                    break;\n                }\n            }\n            return returnVal;\n        } else {\n            return this._keep_val(element[this.index]);\n        }\n    },\n    /**\n     * Update filter's min and max values based on element's values.\n     */\n    update_attrs: function(element) {\n        var updated = false;\n        if (!this.applies_to(element)) {\n            return updated;\n        }\n\n        //\n        // Update filter's min, max based on element values.\n        //\n\n        // Make value(s) into an Array.\n        var values = element[this.index];\n        if (!(values instanceof Array)) {\n            values = [values];\n        }\n\n        // Loop through values and update min, max.\n        for (var i = 0; i < values.length; i++) {\n            var value = values[i];\n            if (value < this.min) {\n                this.min = Math.floor(value);\n                updated = true;\n            }\n            if (value > this.max) {\n                this.max = Math.ceil(value);\n                updated = true;\n            }\n        }\n        return updated;\n    },\n    /**\n     * Update filter's slider.\n     */\n    update_ui_elt: function() {\n        // Only show filter if min < max because filter is not useful otherwise. This\n        // covers all corner cases, such as when min, max have not been defined and\n        // when min == max.\n        if (this.min < this.max) {\n            this.parent_div.show();\n        } else {\n            this.parent_div.hide();\n        }\n\n        var slider_min = this.slider.slider(\"option\", \"min\");\n        var slider_max = this.slider.slider(\"option\", \"max\");\n        if (this.min < slider_min || this.max > slider_max) {\n            // Update slider min, max, step.\n            this.slider.slider(\"option\", \"min\", this.min);\n            this.slider.slider(\"option\", \"max\", this.max);\n            this.slider.slider(\"option\", \"step\", this.get_slider_step(this.min, this.max));\n            // Refresh slider:\n            // TODO: do we want to keep current values or reset to min/max?\n            // Currently we reset values:\n            this.slider.slider(\"option\", \"values\", [this.min, this.max]);\n            // To use the current values.\n            //var values = this.slider.slider( \"option\", \"values\" );\n            //this.slider.slider( \"option\", \"values\", values );\n        }\n    }\n});\n\n/**\n * Manages a set of filters.\n */\nvar FiltersManager = function(track, obj_dict) {\n    this.track = track;\n    this.alpha_filter = null;\n    this.height_filter = null;\n    this.filters = [];\n\n    //\n    // Create HTML.\n    //\n\n    //\n    // Create parent div.\n    //\n    this.parent_div = $(\"<div/>\")\n        .addClass(\"filters\")\n        .hide();\n    // Disable dragging, double clicking, keys on div so that actions on slider do not impact viz.\n    this.parent_div\n        .bind(\"drag\", e => {\n            e.stopPropagation();\n        })\n        .click(e => {\n            e.stopPropagation();\n        })\n        .bind(\"dblclick\", e => {\n            e.stopPropagation();\n        })\n        .bind(\"keydown\", e => {\n            e.stopPropagation();\n        });\n\n    //\n    // Restore state from dict.\n    //\n    if (obj_dict && \"filters\" in obj_dict) {\n        // Second condition needed for backward compatibility.\n        var alpha_filter_name = \"alpha_filter\" in obj_dict ? obj_dict.alpha_filter : null;\n\n        var height_filter_name = \"height_filter\" in obj_dict ? obj_dict.height_filter : null;\n\n        var filters_dict = obj_dict.filters;\n        var filter;\n        for (var i = 0; i < filters_dict.length; i++) {\n            if (filters_dict[i].type === \"number\") {\n                filter = new NumberFilter(filters_dict[i]);\n                this.add_filter(filter);\n                if (filter.name === alpha_filter_name) {\n                    this.alpha_filter = filter;\n                    filter.transparency_icon.addClass(\"active\").show();\n                }\n                if (filter.name === height_filter_name) {\n                    this.height_filter = filter;\n                    filter.height_icon.addClass(\"active\").show();\n                }\n            } else {\n                console.log(\"ERROR: unsupported filter: \", filters_dict[i]);\n            }\n        }\n\n        if (\"visible\" in obj_dict && obj_dict.visible) {\n            this.parent_div.show();\n        }\n    }\n\n    // Add button to filter complete dataset.\n    if (this.filters.length !== 0) {\n        var run_buttons_row = $(\"<div/>\")\n            .addClass(\"param-row\")\n            .appendTo(this.parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'/>\")\n            .attr(\"value\", \"Run on complete dataset\")\n            .appendTo(run_buttons_row);\n        var filter_manager = this;\n        run_on_dataset_button.click(() => {\n            filter_manager.run_on_dataset();\n        });\n    }\n};\n\nextend(FiltersManager.prototype, {\n    // HTML manipulation and inspection.\n    show: function() {\n        this.parent_div.show();\n    },\n    hide: function() {\n        this.parent_div.hide();\n    },\n    toggle: function() {\n        this.parent_div.toggle();\n    },\n    visible: function() {\n        return this.parent_div.is(\":visible\");\n    },\n    /**\n     * Returns dictionary for manager.\n     */\n    to_dict: function() {\n        var obj_dict = {};\n        var filter_dicts = [];\n        var filter;\n\n        // Include individual filter states.\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            filter_dicts.push(filter.to_dict());\n        }\n        obj_dict.filters = filter_dicts;\n\n        // Include transparency, height filters.\n        obj_dict.alpha_filter = this.alpha_filter ? this.alpha_filter.name : null;\n        obj_dict.height_filter = this.height_filter ? this.height_filter.name : null;\n\n        // Include visibility.\n        obj_dict.visible = this.parent_div.is(\":visible\");\n\n        return obj_dict;\n    },\n    /**\n     * Return a copy of the manager.\n     */\n    copy: function(new_track) {\n        var copy = new FiltersManager(new_track);\n        for (var i = 0; i < this.filters.length; i++) {\n            copy.add_filter(this.filters[i].copy());\n        }\n        return copy;\n    },\n    /**\n     * Add a filter to the manager.\n     */\n    add_filter: function(filter) {\n        filter.manager = this;\n        this.parent_div.append(filter.parent_div);\n        this.filters.push(filter);\n    },\n    /**\n     * Remove all filters from manager.\n     */\n    remove_all: function() {\n        this.filters = [];\n        this.parent_div.children().remove();\n    },\n    /**\n     * Initialize filters.\n     */\n\n    init_filters: function() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.update_ui_elt();\n        }\n    },\n    /**\n     * Clear filters so that they do not impact track display.\n     */\n    clear_filters: function() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.slider.slider(\"option\", \"values\", [filter.min, filter.max]);\n        }\n        this.alpha_filter = null;\n        this.height_filter = null;\n\n        // Hide icons for setting filters.\n        this.parent_div.find(\".icon-button\").hide();\n    },\n    run_on_dataset: function() {\n        // Get or create dictionary item.\n        var get_or_create_dict_item = (dict, key, new_item) => {\n            // Add new item to dict if\n            if (!(key in dict)) {\n                dict[key] = new_item;\n            }\n            return dict[key];\n        };\n\n        //\n        // Find and group active filters. Active filters are those being used to hide data.\n        // Filters with the same tool id are grouped.\n        //\n        var active_filters = {};\n\n        var filter;\n        var tool_filter_conditions;\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            if (filter.tool_id) {\n                // Add filtering conditions if filter low/high are set.\n                if (filter.min !== filter.low) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = `${filter.tool_exp_name} >= ${filter.low}`;\n                }\n                if (filter.max !== filter.high) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = `${filter.tool_exp_name} <= ${filter.high}`;\n                }\n            }\n        }\n\n        //\n        // Use tools to run filters.\n        //\n\n        // Create list of (tool_id, tool_filters) tuples.\n        var active_filters_list = [];\n        for (var tool_id in active_filters) {\n            active_filters_list[active_filters_list.length] = [tool_id, active_filters[tool_id]];\n        }\n\n        // Invoke recursive function to run filters; this enables chaining of filters via\n        // iteratively application.\n        (function run_filter(input_dataset_id, filters) {\n            var // Set up filtering info and params.\n            filter_tuple = filters[0];\n\n            var tool_id = filter_tuple[0];\n            var tool_filters = filter_tuple[1];\n            var tool_filter_str = `(${tool_filters.join(\") and (\")})`;\n\n            var url_params = {\n                cond: tool_filter_str,\n                input: input_dataset_id,\n                target_dataset_id: input_dataset_id,\n                tool_id: tool_id\n            };\n\n            // Remove current filter.\n            filters = filters.slice(1);\n\n            // DBTODO: This will never work, run_tool_url doesn't exist?\n            $.getJSON(run_tool_url, url_params, response => {\n                if (response.error) {\n                    // General error.\n                    Galaxy.modal.show({\n                        title: _l(\"Filter Dataset\"),\n                        body: `Error running tool ${tool_id}`,\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else if (filters.length === 0) {\n                    // No more filters to run.\n                    Galaxy.modal.show({\n                        title: _l(\"Filtering Dataset\"),\n                        body: \"Filter(s) are running on the complete dataset. Outputs are in dataset's history.\",\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else {\n                    // More filters to run.\n                    run_filter(response.dataset_id, filters);\n                }\n            });\n        })(this.track.dataset_id, active_filters_list);\n    }\n});\n\nexport default {\n    FiltersManager: FiltersManager,\n    NumberFilter: NumberFilter\n};\n"]}
{"version":3,"sources":["ui/scroll-panel.js"],"names":["$","ui","plugin","add","drag","e","instance","data","clearTimeout","timeout","o","options","element","panel","panel_pos","position","panel_w","width","panel_h","height","viewport","parent","viewport_w","viewport_h","element_w","element_h","moved","close_dist","nudge","p_min_x","p_min_y","p_max_x","p_max_y","min_vis_x","left","max_vis_x","min_vis_y","top","max_vis_y","mouse_x","offset","click","mouse_y","t","Math","min","css","amount_moved","max","ddmanager","prepareOffsets","old_e","setTimeout","mouseMove","stop"],"mappings":";;;AAAA;AACA;AACA;;AAEAA,MAAEC,EAAF,CAAKC,MAAL,CAAYC,GAAZ,CAAgB,WAAhB,EAA6B,aAA7B,EAA4C;AACxCC,cAAM,cAASC,CAAT,EAAYJ,EAAZ,EAAgB;AAClB,gBAAIK,WAAWN,EAAE,IAAF,EAAQO,IAAR,CAAa,WAAb,CAAf;AACAC,yBAAaF,SAASG,OAAtB;AACA,gBAAIC,IAAIT,GAAGU,OAAX;AACA,gBAAIC,UAAUN,SAASM,OAAvB;AACA,gBAAIC,QAAQH,EAAEG,KAAd;AACA,gBAAIC,YAAYD,MAAME,QAAN,EAAhB;AACA,gBAAIC,UAAUH,MAAMI,KAAN,EAAd;AACA,gBAAIC,UAAUL,MAAMM,MAAN,EAAd;AACA,gBAAIC,WAAWP,MAAMQ,MAAN,EAAf;AACA,gBAAIC,aAAaF,SAASH,KAAT,EAAjB;AACA,gBAAIM,aAAaH,SAASD,MAAT,EAAjB;AACA,gBAAIK,YAAYZ,QAAQK,KAAR,EAAhB;AACA,gBAAIQ,YAAYb,QAAQO,MAAR,EAAhB;AACA,gBAAIO,QAAQ,KAAZ;AACA,gBAAIC,aAAa,CAAjB;AACA,gBAAIC,QAAQ,EAAZ;;AAEA,gBAAI;AACJC,sBAAU,EAAEb,UAAUM,UAAZ,CADV;;AAGA,gBAAIQ,UAAU,EAAEZ,UAAUK,UAAZ,CAAd;AACA,gBAAIQ,UAAU,CAAd;AACA,gBAAIC,UAAU,CAAd;;AAEA,gBAAI;AACJC,wBAAY,CAACnB,UAAUoB,IADvB;;AAGA,gBAAIC,YAAYF,YAAYX,UAA5B;AACA,gBAAIc,YAAY,CAACtB,UAAUuB,GAA3B;AACA,gBAAIC,YAAYF,YAAYb,UAA5B;;AAEA,gBAAI;AACJgB,sBAAUtC,GAAGc,QAAH,CAAYmB,IAAZ,GAAmB5B,SAASkC,MAAT,CAAgBC,KAAhB,CAAsBP,IADnD;;AAGAQ,sBAAUzC,GAAGc,QAAH,CAAYsB,GAAZ,GAAkB/B,SAASkC,MAAT,CAAgBC,KAAhB,CAAsBJ,GAAlD;AACA;AACA,gBAAIvB,UAAUoB,IAAV,GAAiBH,OAAjB,IAA4BQ,UAAUZ,UAAV,GAAuBM,SAAvD,EAAkE;AAC9D,oBAAIU,IAAIC,KAAKC,GAAL,CAASjB,KAAT,EAAgBG,UAAUjB,UAAUoB,IAApC,CAAR;AACArB,sBAAMiC,GAAN,CAAU,MAAV,EAAkBhC,UAAUoB,IAAV,GAAiBS,CAAnC;AACAjB,wBAAQ,IAAR;AACApB,yBAASkC,MAAT,CAAgBnB,MAAhB,CAAuBa,IAAvB,IAA+BS,CAA/B;AACA1C,mBAAGc,QAAH,CAAYmB,IAAZ,IAAoBS,CAApB;AACH;AACD,gBAAI,CAACjB,KAAD,IAAUZ,UAAUoB,IAAV,GAAiBL,OAA3B,IAAsCU,UAAUZ,UAAV,GAAuBQ,SAAjE,EAA4E;AACxE,oBAAIQ,IAAIC,KAAKC,GAAL,CAASjB,KAAT,EAAgBd,UAAUoB,IAAV,GAAiBL,OAAjC,CAAR;AACAhB,sBAAMiC,GAAN,CAAU,MAAV,EAAkBhC,UAAUoB,IAAV,GAAiBS,CAAnC;AACAjB,wBAAQ,IAAR;AACApB,yBAASkC,MAAT,CAAgBnB,MAAhB,CAAuBa,IAAvB,IAA+BS,CAA/B;AACA1C,mBAAGc,QAAH,CAAYmB,IAAZ,IAAoBS,CAApB;AACH;AACD,gBAAI,CAACjB,KAAD,IAAUZ,UAAUuB,GAAV,GAAgBL,OAA1B,IAAqCU,UAAUf,UAAV,GAAuBS,SAAhE,EAA2E;AACvE,oBAAIO,IAAIC,KAAKC,GAAL,CAASjB,KAAT,EAAgBI,UAAUlB,UAAUuB,GAApC,CAAR;AACAxB,sBAAMiC,GAAN,CAAU,KAAV,EAAiBhC,UAAUuB,GAAV,GAAgBM,CAAjC;AACA;AACA,oBAAII,eAAelC,MAAME,QAAN,GAAiBsB,GAAjB,GAAuBvB,UAAUuB,GAApD;AACA/B,yBAASkC,MAAT,CAAgBnB,MAAhB,CAAuBgB,GAAvB,IAA8BU,YAA9B;AACA9C,mBAAGc,QAAH,CAAYsB,GAAZ,IAAmBU,YAAnB;AACArB,wBAAQ,IAAR;AACH;AACD,gBAAI,CAACA,KAAD,IAAUZ,UAAUuB,GAAV,GAAgBP,OAA1B,IAAqCY,UAAUf,UAAV,GAAuBW,SAAhE,EAA2E;AACvE,oBAAIK,IAAIC,KAAKC,GAAL,CAASjB,KAAT,EAAgBd,UAAUuB,GAAV,GAAgBR,OAAhC,CAAR;AACAhB,sBAAMiC,GAAN,CAAU,KAAV,EAAoBhC,UAAUuB,GAAV,GAAgBM,CAApC;AACA;AACA,oBAAII,eAAejC,UAAUuB,GAAV,GAAgBxB,MAAME,QAAN,GAAiBsB,GAApD;AACA/B,yBAASkC,MAAT,CAAgBnB,MAAhB,CAAuBgB,GAAvB,IAA8BU,YAA9B;AACA9C,mBAAGc,QAAH,CAAYsB,GAAZ,IAAmBU,YAAnB;AACArB,wBAAQ,IAAR;AACH;AACD;AACAzB,eAAGc,QAAH,CAAYmB,IAAZ,GAAmBU,KAAKI,GAAL,CAAS/C,GAAGc,QAAH,CAAYmB,IAArB,EAA2B,CAA3B,CAAnB;AACAjC,eAAGc,QAAH,CAAYsB,GAAZ,GAAkBO,KAAKI,GAAL,CAAS/C,GAAGc,QAAH,CAAYsB,GAArB,EAA0B,CAA1B,CAAlB;AACApC,eAAGc,QAAH,CAAYmB,IAAZ,GAAmBU,KAAKC,GAAL,CAAS5C,GAAGc,QAAH,CAAYmB,IAArB,EAA2BlB,UAAUQ,SAArC,CAAnB;AACAvB,eAAGc,QAAH,CAAYsB,GAAZ,GAAkBO,KAAKC,GAAL,CAAS5C,GAAGc,QAAH,CAAYsB,GAArB,EAA0BnB,UAAUO,SAApC,CAAlB;AACA;AACA,gBAAIC,KAAJ,EAAW;AACP1B,kBAAEC,EAAF,CAAKgD,SAAL,CAAeC,cAAf,CAA8B5C,QAA9B,EAAwCD,CAAxC;AACH;AACD;AACA,gBAAIqB,KAAJ,EAAW;AACPpB,yBAAS6C,KAAT,GAAiB9C,CAAjB;AACAC,yBAASG,OAAT,GAAmB2C,WAAW,YAAM;AAChC9C,6BAAS+C,SAAT,CAAmBhD,CAAnB;AACH,iBAFkB,EAEhB,EAFgB,CAAnB;AAGH;AACJ,SAtFuC;AAuFxCiD,cAAM,cAASjD,CAAT,EAAYJ,EAAZ,EAAgB;AAClB,gBAAIK,WAAWN,EAAE,IAAF,EAAQO,IAAR,CAAa,WAAb,CAAf;AACAC,yBAAaF,SAASG,OAAtB;AACH;AA1FuC,KAA5C","file":"../../scripts/ui/scroll-panel.js","sourcesContent":["// This is an extension to jQuery UI draggable\n// When dragging move the parent element (\"panel\") relative to its parent\n// (\"viewport\") so that the draggable is always visible.\n\n$.ui.plugin.add(\"draggable\", \"scrollPanel\", {\n    drag: function(e, ui) {\n        var instance = $(this).data(\"draggable\");\n        clearTimeout(instance.timeout);\n        var o = ui.options;\n        var element = instance.element;\n        var panel = o.panel;\n        var panel_pos = panel.position();\n        var panel_w = panel.width();\n        var panel_h = panel.height();\n        var viewport = panel.parent();\n        var viewport_w = viewport.width();\n        var viewport_h = viewport.height();\n        var element_w = element.width();\n        var element_h = element.height();\n        var moved = false;\n        var close_dist = 5;\n        var nudge = 23;\n\n        var // Legal panel range\n        p_min_x = -(panel_w - viewport_w);\n\n        var p_min_y = -(panel_h - viewport_h);\n        var p_max_x = 0;\n        var p_max_y = 0;\n\n        var // Visible\n        min_vis_x = -panel_pos.left;\n\n        var max_vis_x = min_vis_x + viewport_w;\n        var min_vis_y = -panel_pos.top;\n        var max_vis_y = min_vis_y + viewport_h;\n\n        var // Mouse\n        mouse_x = ui.position.left + instance.offset.click.left;\n\n        mouse_y = ui.position.top + instance.offset.click.top;\n        // Move it\n        if (panel_pos.left < p_max_x && mouse_x - close_dist < min_vis_x) {\n            var t = Math.min(nudge, p_max_x - panel_pos.left);\n            panel.css(\"left\", panel_pos.left + t);\n            moved = true;\n            instance.offset.parent.left += t;\n            ui.position.left -= t;\n        }\n        if (!moved && panel_pos.left > p_min_x && mouse_x + close_dist > max_vis_x) {\n            var t = Math.min(nudge, panel_pos.left - p_min_x);\n            panel.css(\"left\", panel_pos.left - t);\n            moved = true;\n            instance.offset.parent.left -= t;\n            ui.position.left += t;\n        }\n        if (!moved && panel_pos.top < p_max_y && mouse_y - close_dist < min_vis_y) {\n            var t = Math.min(nudge, p_max_y - panel_pos.top);\n            panel.css(\"top\", panel_pos.top + t);\n            // Firefox sometimes moves by less, so we need to check. Yuck.\n            var amount_moved = panel.position().top - panel_pos.top;\n            instance.offset.parent.top += amount_moved;\n            ui.position.top -= amount_moved;\n            moved = true;\n        }\n        if (!moved && panel_pos.top > p_min_y && mouse_y + close_dist > max_vis_y) {\n            var t = Math.min(nudge, panel_pos.top - p_min_x);\n            panel.css(\"top\", `${panel_pos.top - t}px`);\n            // Firefox sometimes moves by less, so we need to check. Yuck.\n            var amount_moved = panel_pos.top - panel.position().top;\n            instance.offset.parent.top -= amount_moved;\n            ui.position.top += amount_moved;\n            moved = true;\n        }\n        // Still contain in panel\n        ui.position.left = Math.max(ui.position.left, 0);\n        ui.position.top = Math.max(ui.position.top, 0);\n        ui.position.left = Math.min(ui.position.left, panel_w - element_w);\n        ui.position.top = Math.min(ui.position.top, panel_h - element_h);\n        // Update offsets\n        if (moved) {\n            $.ui.ddmanager.prepareOffsets(instance, e);\n        }\n        // Keep moving even if mouse doesn't move\n        if (moved) {\n            instance.old_e = e;\n            instance.timeout = setTimeout(() => {\n                instance.mouseMove(e);\n            }, 50);\n        }\n    },\n    stop: function(e, ui) {\n        var instance = $(this).data(\"draggable\");\n        clearTimeout(instance.timeout);\n    }\n});\n"]}
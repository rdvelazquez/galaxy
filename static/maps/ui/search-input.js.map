{"version":3,"sources":["ui/search-input.js"],"names":["$","_l","window","s","searchInput","parentNode","options","KEYCODE_ESC","KEYCODE_RETURN","$parentNode","firstSearch","defaults","initialVal","name","placeholder","classes","onclear","onfirstsearch","onsearch","inputVal","minSearchLen","escWillClear","oninit","clearSearchInput","event","$input","parent","children","val","trigger","blur","search","searchTerms","inputTemplate","join","focus","select","keyup","preventDefault","stopPropagation","which","call","length","$clearBtn","tooltip","placement","click","$loadingIndicator","hide","toggleLoadingIndicator","find","toggle","type","extend","addClass","prepend","fn","$searchInput","each"],"mappings":"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","file":"../../scripts/ui/search-input.js","sourcesContent":["import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\nvar _l = window._l || (s => s);\n\n//TODO: consolidate with tool menu functionality, use there\n\n/** searchInput: (jQuery plugin)\n *      Creates a search input, a clear button, and loading indicator\n *      within the selected node.\n *\n *      When the user either presses return or enters some minimal number\n *      of characters, a callback is called. Pressing ESC when the input\n *      is focused will clear the input and call a separate callback.\n */\nfunction searchInput(parentNode, options) {\n    var KEYCODE_ESC = 27;\n    var KEYCODE_RETURN = 13;\n    var $parentNode = $(parentNode);\n    var firstSearch = true;\n\n    var defaults = {\n        initialVal: \"\",\n        name: \"search\",\n        placeholder: \"search\",\n        classes: \"\",\n        onclear: function() {},\n        onfirstsearch: null,\n        onsearch: function(inputVal) {},\n        minSearchLen: 0,\n        escWillClear: true,\n        oninit: function() {}\n    };\n\n    // .................................................................... input rendering and events\n    // visually clear the search, trigger an event, and call the callback\n    function clearSearchInput(event) {\n        var $input = $(this)\n            .parent()\n            .children(\"input\");\n        $input\n            .val(\"\")\n            .trigger(\"searchInput.clear\")\n            .blur();\n        options.onclear();\n    }\n\n    // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n    function search(event, searchTerms) {\n        if (!searchTerms) {\n            return clearSearchInput();\n        }\n        $(this).trigger(\"search.search\", searchTerms);\n        if (typeof options.onfirstsearch === \"function\" && firstSearch) {\n            firstSearch = false;\n            options.onfirstsearch(searchTerms);\n        } else {\n            options.onsearch(searchTerms);\n        }\n    }\n\n    // .................................................................... input rendering and events\n    function inputTemplate() {\n        // class search-query is bootstrap 2.3 style that now lives in base.less\n        return [\n            '<input type=\"text\" name=\"',\n            options.name,\n            '\" placeholder=\"',\n            options.placeholder,\n            '\" ',\n            'class=\"search-query ',\n            options.classes,\n            '\" ',\n            \"/>\"\n        ].join(\"\");\n    }\n\n    // the search input that responds to keyboard events and displays the search value\n    function $input() {\n        return (\n            $(inputTemplate())\n                // select all text on a focus\n                .focus(function(event) {\n                    $(this).select();\n                })\n                // attach behaviors to esc, return if desired, search on some min len string\n                .keyup(function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n\n                    // esc key will clear if desired\n                    if (event.which === KEYCODE_ESC && options.escWillClear) {\n                        clearSearchInput.call(this, event);\n                    } else {\n                        var searchTerms = $(this).val();\n                        // return key or the search string len > minSearchLen (if not 0) triggers search\n                        if (\n                            event.which === KEYCODE_RETURN ||\n                            (options.minSearchLen && searchTerms.length >= options.minSearchLen)\n                        ) {\n                            search.call(this, event, searchTerms);\n                        }\n                    }\n                })\n                .val(options.initialVal)\n        );\n    }\n\n    // .................................................................... clear button rendering and events\n    // a button for clearing the search bar, placed on the right hand side\n    function $clearBtn() {\n        return $(\n            ['<span class=\"search-clear fa fa-times-circle\" ', 'title=\"', _l(\"clear search (esc)\"), '\"></span>'].join(\n                \"\"\n            )\n        )\n            .tooltip({ placement: \"bottom\" })\n            .click(function(event) {\n                clearSearchInput.call(this, event);\n            });\n    }\n\n    // .................................................................... loadingIndicator rendering\n    // a button for clearing the search bar, placed on the right hand side\n    function $loadingIndicator() {\n        return $(\n            ['<span class=\"search-loading fa fa-spinner fa-spin\" ', 'title=\"', _l(\"loading...\"), '\"></span>'].join(\"\")\n        )\n            .hide()\n            .tooltip({ placement: \"bottom\" });\n    }\n\n    // .................................................................... commands\n    // visually swap the load, clear buttons\n    function toggleLoadingIndicator() {\n        $parentNode.find(\".search-loading\").toggle();\n        $parentNode.find(\".search-clear\").toggle();\n    }\n\n    // .................................................................... init\n    // string command (not constructor)\n    if (jQuery.type(options) === \"string\") {\n        if (options === \"toggle-loading\") {\n            toggleLoadingIndicator();\n        }\n        return $parentNode;\n    }\n\n    // initial render\n    if (jQuery.type(options) === \"object\") {\n        options = jQuery.extend(true, {}, defaults, options);\n    }\n    //NOTE: prepended\n    return $parentNode.addClass(\"search-input\").prepend([$input(), $clearBtn(), $loadingIndicator()]);\n}\n\n// as jq plugin\njQuery.fn.extend({\n    searchInput: function $searchInput(options) {\n        return this.each(function() {\n            return searchInput(this, options);\n        });\n    }\n});\n"]}
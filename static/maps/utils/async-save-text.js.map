{"version":3,"sources":["utils/async-save-text.js"],"names":["$","async_save_text","click_to_edit_elt","text_elt_id","save_url","text_parm_name","num_cols","use_textarea","num_rows","on_start","on_finish","undefined","click","length","text_elt","old_text","text","t","attr","rows","cols","trim","value","size","blur","remove","show","keyup","e","keyCode","trigger","ajax_data","val","ajax","url","data","error","alert","success","processed_text","html","hide","insertAfter","focus","select"],"mappings":";;;;;;;;;;;;;;;AACC,gBAAD;;AAEA,QAAIA,oBAAJ;AACA;AACA;;;AAGA,aAASC,eAAT,CACIC,iBADJ,EAEIC,WAFJ,EAGIC,QAHJ,EAIIC,cAJJ,EAKIC,QALJ,EAMIC,YANJ,EAOIC,QAPJ,EAQIC,QARJ,EASIC,SATJ,EAUE;AACE;AACA,YAAIJ,aAAaK,SAAjB,EAA4B;AACxBL,uBAAW,EAAX;AACH;AACD,YAAIE,aAAaG,SAAjB,EAA4B;AACxBH,uBAAW,CAAX;AACH;;AAED;AACAR,gBAAME,iBAAN,EAA2BU,KAA3B,CAAiC,YAAM;AACnC;AACA,gBAAIZ,EAAE,kBAAF,EAAsBa,MAAtB,GAA+B,CAAnC,EAAsC;AAClC;AACH;AACD,gBAAIC,WAAWd,QAAMG,WAAN,CAAf;AACA,gBAAIY,WAAWD,SAASE,IAAT,EAAf;AACA,gBAAIC,CAAJ;;AAEA,gBAAIV,YAAJ,EAAkB;AACdU,oBAAIjB,EAAE,uBAAF,EACCkB,IADD,CACM,EAAEC,MAAMX,QAAR,EAAkBY,MAAMd,QAAxB,EADN,EAECU,IAFD,CAEMhB,EAAEqB,IAAF,CAAON,QAAP,CAFN,CAAJ;AAGH,aAJD,MAIO;AACHE,oBAAIjB,EAAE,6BAAF,EAAiCkB,IAAjC,CAAsC;AACtCI,2BAAOtB,EAAEqB,IAAF,CAAON,QAAP,CAD+B;AAEtCQ,0BAAMjB;AAFgC,iBAAtC,CAAJ;AAIH;AACDW,cAAEC,IAAF,CAAO,IAAP,EAAa,iBAAb;AACAD,cAAEO,IAAF,CAAO,YAAW;AACdxB,kBAAE,IAAF,EAAQyB,MAAR;AACAX,yBAASY,IAAT;AACA,oBAAIhB,SAAJ,EAAe;AACXA,8BAAUO,CAAV;AACH;AACJ,aAND;AAOAA,cAAEU,KAAF,CAAQ,UAASC,CAAT,EAAY;AAChB,oBAAIA,EAAEC,OAAF,KAAc,EAAlB,EAAsB;AAClB;AACA7B,sBAAE,IAAF,EAAQ8B,OAAR,CAAgB,MAAhB;AACH,iBAHD,MAGO,IAAIF,EAAEC,OAAF,KAAc,EAAlB,EAAsB;AACzB;AACA,wBAAIE,YAAY,EAAhB;AACAA,8BAAU1B,cAAV,IAA4BL,EAAE,IAAF,EAAQgC,GAAR,EAA5B;AACAhC,sBAAE,IAAF,EAAQ8B,OAAR,CAAgB,MAAhB;AACA9B,sBAAEiC,IAAF,CAAO;AACHC,6BAAK9B,QADF;AAEH+B,8BAAMJ,SAFH;AAGHK,+BAAO,iBAAW;AACdC,4DAA8BlC,WAA9B;AACA;AACH,yBANE;AAOHmC,iCAAS,iBAASC,cAAT,EAAyB;AAC9B;AACA,gCAAIA,mBAAmB,EAAvB,EAA2B;AACvBzB,yCAASE,IAAT,CAAcuB,cAAd;AACH,6BAFD,MAEO;AACHzB,yCAAS0B,IAAT,CAAc,eAAd;AACH;AACD,gCAAI9B,SAAJ,EAAe;AACXA,0CAAUO,CAAV;AACH;AACJ;AAjBE,qBAAP;AAmBH;AACJ,aA7BD;;AA+BA,gBAAIR,QAAJ,EAAc;AACVA,yBAASQ,CAAT;AACH;AACD;AACAH,qBAAS2B,IAAT;AACAxB,cAAEyB,WAAF,CAAc5B,QAAd;AACAG,cAAE0B,KAAF;AACA1B,cAAE2B,MAAF;;AAEA;AACH,SApED;AAqEH;;AAED;sBACe3C,e","file":"../../scripts/utils/async-save-text.js","sourcesContent":["import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n// ============================================================================\n/**\n * Edit and save text asynchronously.\n */\nfunction async_save_text(\n    click_to_edit_elt,\n    text_elt_id,\n    save_url,\n    text_parm_name,\n    num_cols,\n    use_textarea,\n    num_rows,\n    on_start,\n    on_finish\n) {\n    // Set defaults if necessary.\n    if (num_cols === undefined) {\n        num_cols = 30;\n    }\n    if (num_rows === undefined) {\n        num_rows = 4;\n    }\n\n    // Set up input element.\n    $(`#${click_to_edit_elt}`).click(() => {\n        // Check if this is already active\n        if ($(\"#renaming-active\").length > 0) {\n            return;\n        }\n        var text_elt = $(`#${text_elt_id}`);\n        var old_text = text_elt.text();\n        var t;\n\n        if (use_textarea) {\n            t = $(\"<textarea></textarea>\")\n                .attr({ rows: num_rows, cols: num_cols })\n                .text($.trim(old_text));\n        } else {\n            t = $(\"<input type='text'></input>\").attr({\n                value: $.trim(old_text),\n                size: num_cols\n            });\n        }\n        t.attr(\"id\", \"renaming-active\");\n        t.blur(function() {\n            $(this).remove();\n            text_elt.show();\n            if (on_finish) {\n                on_finish(t);\n            }\n        });\n        t.keyup(function(e) {\n            if (e.keyCode === 27) {\n                // Escape key\n                $(this).trigger(\"blur\");\n            } else if (e.keyCode === 13) {\n                // Enter key submits\n                var ajax_data = {};\n                ajax_data[text_parm_name] = $(this).val();\n                $(this).trigger(\"blur\");\n                $.ajax({\n                    url: save_url,\n                    data: ajax_data,\n                    error: function() {\n                        alert(`Text editing for elt ${text_elt_id} failed`);\n                        // TODO: call finish or no? For now, let's not because error occurred.\n                    },\n                    success: function(processed_text) {\n                        // Set new text and call finish method.\n                        if (processed_text !== \"\") {\n                            text_elt.text(processed_text);\n                        } else {\n                            text_elt.html(\"<em>None</em>\");\n                        }\n                        if (on_finish) {\n                            on_finish(t);\n                        }\n                    }\n                });\n            }\n        });\n\n        if (on_start) {\n            on_start(t);\n        }\n        // Replace text with input object and focus & select.\n        text_elt.hide();\n        t.insertAfter(text_elt);\n        t.focus();\n        t.select();\n\n        return;\n    });\n}\n\n// ============================================================================\nexport default async_save_text;\n"]}